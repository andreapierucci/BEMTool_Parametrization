---
title: "BEMTool data preparation"
author: "Andrea Pierucci and Isabella Bitetto"
date: '2022-03-25'
output:
  #bookdown::pdf_book:
  pdf_document: default
  #html_document: default
header-includes:
    - \usepackage{ragged2e}
    - \usepackage{multirow}
    - \usepackage{setspace}\doublespacing
---
\begin{singlespace}

BEMTool needs at least the following files in C:
  
\begin{enumerate}
     \item PREPARATION INPUT (folders)
         \begin{enumerate}
             \item ALADYM (folders)
                  \begin{enumerate}
                        \item SPECIES-1 (folder)
                              \begin{enumerate}
                                  \item aladym-Species-1.csv
                                  \item M.csv
                                  \item Recruitment.csv
                                  \item Selectivity.csv
                                  \item Z.csv
                                  \item Discard-Reverse-Ogive.csv
                                  \item Discard.csv
                                  \item Aladym-landings-obligations.csv
                              \end{enumerate}
                        \item SPECIES-2 (folder)\\
                        note: same type of files of SPECIES-1
                        \item SPECIES-3 (folder)\\
                         note: same type of files of SPECIES-1 and 2
                  \end{enumerate}     
             \item EFFORT (folders)
                  \begin{enumerate}
                        \item average-GT.csv
                        \item average-kw.csv
                        \item number-of-vessels.csv
                        \item days-at-sea.csv
                  \end{enumerate}
             \item LANDINGS (folders)
                  \begin{enumerate}
                        \item landings-Species-1.csv
                        \item landings-Species-2.csv
                        \item landings-Species-3.csv
                  \end{enumerate}
             \item SCENARIOS (folders)
                  \begin{enumerate}
                        \item SCENARIO-1
                            \begin{enumerate}
                               \item grid-Eq-sim-Species-1.csv
                               \item grid-Eq-sim-Species-2.csv
                               \item grid-Eq-sim-Species-3.csv
                               \item monthly-data-sea-days.csv
                               \item vessels.csv
                               \item bmt-config-Forecast.csv
                            \end{enumerate}
                        \item SCENARIO-2\\
                            note: same type of files of SCENARIO-1
                  \end{enumerate}
             \item bmt-config-Simulation.csv (unique file)
             \item Economic-Time-Series.csv
         \end{enumerate}
     \item INPUT (folders)
\end{enumerate}

\end{singlespace}


<!--\setlength{\parindent}{4em}
\vspace{4cm}-->
\newpage
\textbf{A. aladym-Species-1.csv }

MANUAL 

\textbf{B. M.csv }

READY
```{r include=F}
ts<-c(2004:2020)
#spe="A_ANT"


library(tidyverse)
library(data.table)


#please define your species
SPECIES_1<-"A_ANT"
SPECIES_2<-"A_FOL"
SPECIES_3<-"M_BAR9"
SPECIES_4<-"M_BAR10"
SPECIES_5<-"M_MER"
SPECIES_6<-"N_NOR"
SPECIES_7<-"P_LOG"

#please define your scenarios

SCENARIO_1<-"SQ"
SCENARIO_2<-"TAC_ARA"
SCENARIO_3<-"TAC_ARA_MONTLY"
SCENARIO_4<-"TAC_ARA_REV"
SCENARIO_5<-"TAC_ARA_REV_MONTLY"
SCENARIO_6<-"TAC_ARS"
SCENARIO_7<-"TAC_ARS_MONTLY"
SCENARIO_8<-"TAC_ARS_REV"
SCENARIO_9<-"TAC_ARS_REV_MONTLY"


# Please, create your folders needed
dir="C:"
dir.create(file.path(dir,"INPUT"), recursive = T)
(dir1=paste("C:/INPUT"))
dir.create(file.path(dir1,"ALADYM"), recursive = T)
    (dir2=paste("C:/INPUT/ALADYM"))
          #please add the same amount of folders as for the number of species previously defined
          dir.create(file.path(dir2,SPECIES_1), recursive = T)
          dir.create(file.path(dir2,SPECIES_2), recursive = T)
          dir.create(file.path(dir2,SPECIES_3), recursive = T)
          dir.create(file.path(dir2,SPECIES_4), recursive = T)
          dir.create(file.path(dir2,SPECIES_5), recursive = T)
          dir.create(file.path(dir2,SPECIES_6), recursive = T)
          dir.create(file.path(dir2,SPECIES_7), recursive = T)

dir.create(file.path(dir1,"EFFORT"), recursive = T)
dir.create(file.path(dir1,"LANDINGS"), recursive = T)
dir.create(file.path(dir1,"SCENARIOS"), recursive = T)
    (dir3=paste("C:/INPUT/SCENARIOS"))
          #please add the same amount of folders as for the number of scenarios previously defined
          dir.create(file.path(dir3,SCENARIO_1), recursive = T)
          dir.create(file.path(dir3,SCENARIO_2), recursive = T)
          dir.create(file.path(dir3,SCENARIO_3), recursive = T)
          dir.create(file.path(dir3,SCENARIO_4), recursive = T)
          dir.create(file.path(dir3,SCENARIO_5), recursive = T)
          dir.create(file.path(dir3,SCENARIO_6), recursive = T)
          dir.create(file.path(dir3,SCENARIO_7), recursive = T)
          dir.create(file.path(dir3,SCENARIO_8), recursive = T)
          dir.create(file.path(dir3,SCENARIO_9), recursive = T)
 
dir.create(file.path(dir,"OUTPUT"), recursive = T)
(dir4=paste("C:/OUTPUT"))         
          
```

```{r}
##################### SOME NOTES  #########################

# [FIRST] check if in the assessment it is reported/used the MEAN SSB or the middle year SSB 
# "C:\OUTPUT\Diagnosis\Biological Pressure Impact\ALADYM - P. lon171819\Sim vs Obs\GSA171819 - Sim. vs Obs. Catch-Landing-Discard - P. lon171819.csv"

# [SECOND] check run the Bemtool in R and check the maturity and see if it is equal to the one used in the assessment. Pay attention because to convert the maturity from age to length and if it need correction change BTMconfing csv file 

# "C:\OUTPUT\Diagnosis\working files\BAS_5.Rdata"
# DF=data.frame(FMaturity=FMaturity,MMaturity=MMaturity)
# write.table(DF,"DF.csv",sep=";",row.names=F)

# [THIRD] Check what type of F you should use for (M calculation) the best fitting of BEMTool to the assessment (Fbar at age, Fmean or Fmax)

# [FOUR] Check the mean weight of the assessment if it is equal to the Bemtool one ( GP Linf, a, b values)
# DF=data.frame(MWeight=MWeight,FWeight=FWeight)
# write.table(DF,"DF_Mean_weight.csv",sep=";",row.names=F)

# some useful lines 


#linf=381
#k=0.28
#t0=-1.7

#  l2a conversion
# vbObj <- a4aGr(
#  grMod=~linf*(1-exp(-k*(t-t0))),
#  grInvMod=~t0-1/k*log(1-len/linf),
#  params=FLPar(linf=linf, k=k, t0=t0, units=c('mm','year-1','year')))

# Check the model and its inverse
# c(predict(vbObj, len=250))
# c(predict(vbObj, t=1))
#1/12

#a=0.00020
#b=3.11
#L=300
#W = a * L * b

#a * L * b

#[FIVE]
# check the selectivity 

#[six] 
#[Check F at age in Bemtool SRO ]
# write in SRO_5    Annual_F 
# and see if it is equal to the assessment one 

#[seven]
# change in tr
# check tr used in bemtool with the smallest size reported in discards length. Tr 1 (month)


```

```{r include=F}
# M
#(M_file=read.csv2("D:/Andrea/Desktop/script per parametrizzazione BEMTOOL/input formats/DPS/Natural_mortality_vector.csv", sep=";", header=TRUE, check.names=FALSE))

(age<-c("age","0","1", "2", "3")) # add here the correct number of ages
(natM<-c("nat",1.75,	0.938,	0.748,	0.673))
(M_file<-matrix(natM, 1, 5))
(M_file<-as.data.frame(M_file))
(colnames(M_file)<-age) 

tr=2  # in months, tr is the age of recruitment to the fishing ground 
lifespan=4 # Life span equal to n of ages
(age_month=seq(tr,lifespan*12,1))
(M=age_month)

for (r in 1:(length(age_month)-1)){
  age=trunc(age_month[r]/12,0)
  M[r]=M_file[1,age+2]
}

(M[length(age_month)]=M[length(age_month)-1])

(DF_M=data.frame(age_month=age_month,	M=M))

write.table(DF_M,paste(dir2,"/",SPECIES_5,"/M.csv",sep=""),sep=";",row.names=F)  

```


\textbf{C. Recruitment.csv }

READY

```{r include=F}
#RECRUITS
#(Rec_file=read.table("D:\\Andrea\\Desktop\\script per parametrizzazione BEMTOOL\\input formats\\DPS\\Recruits.csv",sep=";",header=T))

# Please, add you recruitments form the stock assessment

ts<-c(2004:2020)
(year<-c(2004:2020))

(R<-c(2026625,
1975589,
1833002,
1703895,
1619353,
1541422,
1438376,
1346085,
1348740,
1529795,
1947296,
2575489,
3221716,
3623722,
3708076,
3608000,
3459810




)) 

(Rec_file<-data.frame(year,R))
(Rec=Rec_file[Rec_file[,1] %in% ts,])

(DF_R=data.frame(year=ts,	seed= c(Rec[1,2],rep("",(length(ts)-1))),	Jan=Rec[,2],	Feb=Rec[,2],	Mar=Rec[,2],	Apr=Rec[,2],	May=Rec[,2],	Jun=Rec[,2],	Jul=Rec[,2],	Aug=Rec[,2],	Sep=Rec[,2],	Oct=Rec[,2],	Nov=Rec[,2],	Dec=Rec[,2]))
write.table(DF_R,paste(dir2,"/",SPECIES_1,"/Recruitment.csv",sep=""),sep=";",row.names=F)  

```

\textbf{E. Z.csv }

READY

```{r  include=F}
# Z

# ATTENTION!!!! RUN OR CASE 1 OR CASE 2!
#______________________________________________________

# CASE 1 - if you have F at age (stock assessment with age structured models)

#F_file=read.table(paste(path_input,"\\F_at_age.csv",sep=""),sep=";", header=T)

(Year_age<-ts)
(zero<-c(0.21,
0.22,
0.23,
0.23,
0.25,
0.26,
0.28,
0.3,
0.3,
0.29,
0.28,
0.28,
0.28,
0.3,
0.3,
0.3,
0.3

 
))
(one<-c(1.6,
1.68,
1.72,
1.76,
1.85,
1.99,
2.13,
2.23,
2.24,
2.18,
2.11,
2.1,
2.15,
2.22,
2.29,
2.3,
2.27
))

(two<-c(1.6,
1.68,
1.72,
1.76,
1.85,
1.99,
2.13,
2.23,
2.24,
2.18,
2.11,
2.1,
2.15,
2.22,
2.29,
2.3,
2.27
))

(three<-c(1.6,
1.68,
1.72,
1.76,
1.85,
1.99,
2.13,
2.23,
2.24,
2.18,
2.11,
2.1,
2.15,
2.22,
2.29,
2.3,
2.27
 
))




(F_file<-data.frame(Year_age,zero,one,two,three))
colnames(F_file)[2]<-"0"
colnames(F_file)[3]<-"1"
colnames(F_file)[4]<-"2"
colnames(F_file)[5]<-"3"
#colnames(F_file)[5]<-"4"
(Fish_mort=F_file[F_file[,1] %in% ts,])

(M_vector=read.table("C:/INPUT/DPS17-18-19/Natural_mortality_PAPELON FAIRSEA.csv",sep=";", header=T))

(mean_M=mean(as.numeric(M_vector[,2])))

(F_range=c(1,3))

(F_bar=data.frame(year=ts,Fbar=rowMeans(Fish_mort[,c((F_range[1]+2):(F_range[2]+2))])))

(Z_bar=F_bar)
(Z_bar[,2]=Z_bar[,2]+mean_M)


(DF_Z=data.frame(year=ts,	seed= c(Z_bar[1,2],rep("",(length(ts)-1))),	Jan=Z_bar[,2],	Feb=Z_bar[,2],	Mar=Z_bar[,2],	Apr=Z_bar[,2],	May=Z_bar[,2],	Jun=Z_bar[,2],	Jul=Z_bar[,2],	Aug=Z_bar[,2],	Sep=Z_bar[,2],	Oct=Z_bar[,2],	Nov=Z_bar[,2],	Dec=Z_bar[,2],sex="M"))
(DF_Z2=DF_Z)
(DF_Z2$sex="F")
(DF_Z=rbind(DF_Z,DF_Z2))

write.table(DF_Z,"C:/INPUT/DPS17-18-19/Zmean.csv",sep=";", row.names=F)
```

```{r  include=F}
# CASE 2 - if you have F mean (stock assessment with production models)

#F_file=read.table(paste(path_input,"\\F_mean.csv",sep=""),sep=";", header=T)

# please insert years and Fmean 
spe<-"SOL"
(Year_Age<-c(2004:2020))
ts<-Year_Age
(Fmean<-c(0.325507592,
0.481080823,
0.46272896,
0.446143368,
0.376239791,
0.794137749,
0.577544714,
0.55487867,
0.439292491,
0.267395521,
0.274605612,
0.337239734,
0.288492218,
0.376338758,
0.309156193,
0.295994286,
0.19355407
)) 

(F_file<-data.frame(Year_Age,Fmean))
write.table(F_file,"C:/INPUT/SOL17/Fmaen_used_for_M_calcualtion.csv",sep=";",row.names=F)  

(Fish_mort=F_file[F_file[,1] %in% ts,])
(M_vector=read.table("C:/INPUT/SOL17/M_SOL.csv", sep=";", header=T))
#(M_vector=read.table(paste("C:\\INPUT\\",spe,"17\\M_",spe,".csv",sep=""),sep=";", header=T))

(mean_M=mean(as.numeric(M_vector[,2])))
(Z_bar=Fish_mort)
(Z_bar[,2]=Z_bar[,2]+mean_M)

(DF_Z=data.frame(year=ts,	seed= c(Z_bar[1,2],rep("",(length(ts)-1))),	Jan=Z_bar[,2],	Feb=Z_bar[,2],	Mar=Z_bar[,2],	Apr=Z_bar[,2],	May=Z_bar[,2],	Jun=Z_bar[,2],	Jul=Z_bar[,2],	Aug=Z_bar[,2],	Sep=Z_bar[,2],	Oct=Z_bar[,2],	Nov=Z_bar[,2],	Dec=Z_bar[,2],sex="M"))
(DF_Z2=DF_Z)
(DF_Z2$sex="F")
(DF_Z=rbind(DF_Z,DF_Z2))

write.table(DF_Z,"C:/INPUT/SOL17/Zmean.csv",sep=";",row.names=F)  

```


\textbf{D. Selectivity.csv }

READY

```{r}
# please add you fleet segments lables

(Fleet_segments <-c("GSA9_DTS_VL0612_OTB_DEF",
                   "GSA9_DTS_VL1218_OTB_DEF",
                   "GSA9_DTS_VL1218_OTB_DWS",
                   "GSA9_DTS_VL1218_OTB_MDD",
                   "GSA9_DTS_VL1824_OTB_DEF",
                   "GSA9_DTS_VL1824_OTB_DWS",
                   "GSA9_DTS_VL1824_OTB_MDD",
                   "GSA9_DTS_VL2440_OTB_DEF",
                   "GSA9_DTS_VL2440_OTB_MDD",
                   "GSA9_PGP_VL0012",
                   "GSA9_PGP_VL1218",
                   
                   "GSA10_DTS_VL0612_OTB_DEF",
                   "GSA10_DTS_VL1218_OTB_DEF",
                   "GSA10_DTS_VL1218_OTB_DWS",
                   "GSA10_DTS_VL1218_OTB_MDD",
                   "GSA10_DTS_VL1824_OTB_DEF",
                   "GSA10_DTS_VL1824_OTB_DWS",
                   "GSA10_DTS_VL1824_OTB_MDD",
                   "GSA10_DTS_VL2440_OTB_DEF",
                   "GSA10_DTS_VL2440_OTB_DWS",
                   "GSA10_DTS_VL2440_OTB_MDD",
                   "GSA10_PGP_VL0006",
                   "GSA10_PGP_VL0612",
                   "GSA10_PGP_VL1218",
                   
                   "GSA11_DTS_VL0612_OTB_DEF",
                   "GSA11_DTS_VL1218_OTB_DEF",
                   "GSA11_DTS_VL1218_OTB_DWS",
                   "GSA11_DTS_VL1218_OTB_MDD",
                   "GSA11_DTS_VL1824_OTB_DEF",
                   "GSA11_DTS_VL1824_OTB_DWS",
                   "GSA11_DTS_VL1824_OTB_MDD",
                   "GSA11_DTS_VL2440_OTB_DEF",
                   "GSA11_DTS_VL2440_OTB_DWS",
                   "GSA11_DTS_VL2440_OTB_MDD",
                   "GSA11_PGP_VL0012",
                   "GSA11_PGP_VL1218"))


(Months=c("Jan",
         "Feb",
         "Mar",
         "Apr",
         "May",
         "Jun",
         "Jul",
         "Aug",
         "Set",
         "Oct",
         "Nov",
         "Dec"))



(month_vec=c("seed",rep(c(Months),length(ts))))
(month_vec=rep(month_vec,length(Fleet_segments)))
(y=1)
(year_vec=c("",rep(ts[y],12)))

for (y in 2:length(ts)){
year_vec2=c(year_vec,rep(ts[y],12))
year_vec=year_vec2
}
(year_vec=rep(year_vec,length(Fleet_segments)))

# Selectivity models:
# 1 classical ogive, 2 ogive with de-selection, 3 gaussian symmetric, 4 log-normal, 5 bi-normal, 6 norma asymmetric

# please add your selected model for each fleet segment
# in rep(2,36), 36 is the amount of fleet segments
models= rep(2,36)
param1=c(160,	180,	160,	180,	160,	160,	180,	160,	160,	180,	160,	160,	180,	160,	180,	160, 270, 270,160,	180,	160,	180,	160,	160,	180,	160,	160,	180,	160,	160,	180,	160,	180,	160, 270, 270)
param2=rep(20,36)
param3=c(330,	270,	330,	270,	290,	330,	270,	290,	330,	270,	290,	330,	270,	330,	270,	290, 370, 370,160,	180,	160,	180,	160,	160,	180,	160,	160,	180,	160,	160,	180,	160,	180,	160, 270, 270)
param4=rep(NA,36)
param5=rep(NA,36)
param6=rep(NA,36)

(x=length(ts)*12+1)
param1_vec=rep(param1[1],x)
for (fs in 2:length(Fleet_segments)){
param1_vec2= c(param1_vec,rep(param1[fs],x) )
param1_vec=  param1_vec2
}
param2_vec=rep(param2[1],x)
for (fs in 2:length(Fleet_segments)){
  param2_vec2= c(param2_vec,rep(param2[fs],x) )
  param2_vec=  param2_vec2
}
param3_vec=rep(param3[1],x)
for (fs in 2:length(Fleet_segments)){
  param3_vec2= c(param3_vec,rep(param3[fs],x) )
  param3_vec=  param3_vec2
}
param4_vec=rep(param4[1],x)
for (fs in 2:length(Fleet_segments)){
  param4_vec2= c(param4_vec,rep(param4[fs],x) )
  param4_vec=  param4_vec2
}
param5_vec=rep(param5[1],x)
for (fs in 2:length(Fleet_segments)){
  param5_vec2= c(param5_vec,rep(param5[fs],x) )
  param5_vec=  param5_vec2
}

sel_type_vec=rep(models[1],x)
for (fs in 2:length(Fleet_segments)){
  sel_type_vec2= c(sel_type_vec,rep(models[fs],x) )
  sel_type_vec=  sel_type_vec2
}

fleet_segment_vec=rep(Fleet_segments[1],x)
for (fs in 2:length(Fleet_segments)){
  fleet_segment_vec2= c(fleet_segment_vec,rep(Fleet_segments[fs],x) )
  fleet_segment_vec=  fleet_segment_vec2
}

(DF=data.frame(year=year_vec,	month=month_vec,	param1=param1_vec,	param2=param2_vec,	param3=param3_vec,	param4=param4_vec,	param5=param5_vec,	sel_type=sel_type_vec,	fleet_segment=fleet_segment_vec))

write.table(DF,paste(dir2,"/",SPECIES_1,"/Selectivity.csv",sep=""),sep=";",row.names=F)  
```


\textbf{F. Discard-Reverse-Ogive.csv }

READY

```{r}
# insert discards, L50 and L75_L25 the same time of the fleet segment amount.
(discard = c(rep("YES",36)))
(L50=c(rep(90,36)))
(L75_L25=c(rep(20,36)))

x<-12*length(Fleet_segments)*length(ts)

(discard_vec=(rep(discard[1],x+36))) #36 are the free seed space added relate to the amount of fleet segments. Please chenge this accordingly with your amount of fleet segments. 

# for (fs in 2:length(Fleet_segments)){
#   discard_vec_vec2= c(discard_vec,rep(discard[fs],x) )
#   discard_vec_vec=  discard_vec_vec2
# }

(L50_vec=rep(L50[1],x+36))#36 are the free seed space added relate to the amount of fleet segments. Please chenge this accordingly with your amount of fleet segments.   

# for (fs in 2:length(Fleet_segments)){
#   L50_vec2= c(L50_vec,rep(param1[fs],x) )
#   L50_vec=  L50_vec2
# }

(L75_L25_vec=rep(L75_L25[1],x+36))#36 are the free seed space added relate to the amount of fleet segments. Please chenge this accordingly with your amount of fleet segments.  

# for (fs in 2:length(Fleet_segments)){
#   L75_L25_vec2= c(L75_L25_vec,rep(L75_L25[fs],x) )
#   L75_L25_vec=  L75_L25_vec2
# }

(DF=data.frame(year=year_vec,	month=month_vec,	L50=L50_vec,	L75_L25=L75_L25_vec,	discard=discard_vec,	fleet_segment=fleet_segment_vec))

write.table(DF,paste(dir2,"/",SPECIES_1,"/Discard_reverse_ogive.csv",sep=""),sep=";",row.names=F)  


(month_vec=c(rep(c(Months),length(ts))))
(month_vec_obb=rep(month_vec,length(Fleet_segments)))
(year_vec=rep(ts,each=12))
(year_vec_obb=rep(year_vec,length(Fleet_segments)))
(landing_obligation<-rep("N",length(year_vec_obb)))
(fleet_segments<-rep(Fleet_segments, each=length(ts)*12))
(df<-data.frame(year_vec_obb,month_vec_obb,landing_obligation,fleet_segments))

write.table(df,paste(dir2,"/",SPECIES_1,"/ALADYM_landing_obligation.csv",sep=""),sep=";",row.names=F)  


```

\textbf{G. Discard.csv }

READY 

```{r split_discards, child='splitting_discards' , eval=F}
# Below the lines for the public FDI available data  
# You should first load the catch data for the available years.
# The example shows a splitting for 3 GSAs and one species

library(readxl)
library(tidyverse)
library(tidyr)

#select your directories 

dir<-"D:/Andrea/Desktop/NEW_BEMTool/FDI_catches_by_country.xlsx"

(Y2020<-read_xlsx(dir, sheet = 2))
(Y2019<-read_xlsx(dir, sheet = 3))
(Y2018<-read_xlsx(dir, sheet = 4))
(Y2017<-read_xlsx(dir, sheet = 5))
(Y2016<-read_xlsx(dir, sheet = 6))
(Y2015<-read_xlsx(dir, sheet = 7))
(Y2014<-read_xlsx(dir, sheet = 8))

head(Y2019)

catch<-rbind(Y2020,Y2019,Y2018,Y2017,Y2016,Y2015,Y2014)
rm(Y2020,Y2019,Y2018,Y2017,Y2016,Y2015,Y2014)
# some lable corrections below 
names(catch)[1]<-"country_code"
names(catch)[14]<-"sub_region"
names(catch)[6]<-"fishing_technique"
names(catch)[2]<-"country_name"
names(catch)[5]<-"vessel_length"
names(catch)[8]<-"Target_Assemblage" 
names(catch)[21]<-"total_live_weight_landed_tonnes"
names(catch)[22]<-"total_value_of_landings_euro"
names(catch)[23]<-"total_discards"
names(catch)[7]<- "gear_type"

# After you could select your country, GSAs and species

# DTS
(DTS<-catch%>%
  filter(country_name%in%c("Italy") & sub_region%in%c("GSA9","GSA10","GSA11") & species=="HKE" & fishing_technique=="DTS", gear_type=="OTB"))

(DTS$total_discards[DTS$total_discards=="NK"] <- 0.000001)
(DTS$total_discards<-as.numeric(DTS$total_discards))
(DTS$total_discards<-DTS$total_discards*1000 )# here I convert tons to kg (BEMTool needs kg)

(DTS1<-DTS%>%
    group_by(year,sub_region,country_code,fishing_technique,gear_type,Target_Assemblage,vessel_length,Quarter)%>%
    summarise(total_discards=sum(total_discards)))

(DTS1<-DTS1[,c(1,2,4,7,5,6,8,9)])
(DTS2<-DTS1%>%unite("FS",year:Quarter, remove = T, sep = "_"))
(DTS2<-DTS2%>%arrange(FS))

# some time there are missing reported data by quarters and you need to find what quarter is missing in what year. 
# you could first build a fake DF with all year and all metier and with a marge function see where the missing quarters are. 
#fake DF It should be built according to what you need in terms of number of GSA, years, and loa 

(year<-rep(c(2014:2020),each=36*3)) # here you repete ecah year the amount of fleet segments in all three GSAs ( 17-19)
(sub_region1<-rep("GSA9",36))
(sub_region2<-rep("GSA10",36))
(sub_region3<-rep("GSA11",36))
(sub_region<-c(sub_region1,sub_region2,sub_region3)) # this is for one year only 
(sub_region<-rep(sub_region,7)) # this is for the all time series (2014-2020)
(fishing_technique<-rep("DTS",length(sub_region)))
(vessel_length1<-rep("VL0612",4)) # DEF only and 4 quarters
(vessel_length2<-rep("VL1218",12)) # DEF, DWF, MDD each for the 4 quarters
(vessel_length3<-rep("VL1824",12)) # DEF, DWF, MDD each for the 4 quarters
(vessel_length4<-rep("VL2440",8)) # DEF and MDD only each for the 4 quarters
(vessel_length<-c(vessel_length1,vessel_length2,vessel_length3,vessel_length4))
(vessel_length<-rep(vessel_length,3))# for the three GSAs
(vessel_length<-rep(vessel_length,7)) # for the time series (7 years 2014:2020)
(gear_type<-rep("OTB",length(vessel_length)))
(Target_Assemblage1<-rep("DEF",4))
(Target_Assemblage2<-rep(c("DEF","DWS","MDD"),each=4))
(Target_Assemblage3<-rep(c("DEF","DWS","MDD"),each=4))
(Target_Assemblage4<-rep(c("DEF","MDD"),each=4))
(Target_Assemblage<-c(Target_Assemblage1,Target_Assemblage2,Target_Assemblage3,Target_Assemblage4)) #for the all 4 LOAs
(Target_Assemblage<-rep(Target_Assemblage,3)) # for the 3 GSAs
(Target_Assemblage<-rep(Target_Assemblage,7)) # for the all time series 
(Quarter<-rep(c(1:4),length(vessel_length)/4))
(BASICDF<-data.frame(year,sub_region,fishing_technique,vessel_length,gear_type,Target_Assemblage,Quarter))
(BASICDF$total_discards<-0)
(BASICDF<-BASICDF%>%unite("FS",year:Quarter, remove = T, sep = "_"))
(BASICDF<-BASICDF%>%arrange(FS))

#Now you marge the two DF ( real and fake one ) with the scope of insert missing quarters where no data are available with 0 

(DTS_FULL<-merge(DTS2,BASICDF,  by.x ="FS", by.y="FS", all.x = F, all.y = T)) # check the difference in rows between DTS2 and BASICDF. BASICDF should be bigger or equal to DTS2 if this not your case. Check, there is a problem!
(DTS_FULL[is.na(DTS_FULL)] = 0.00001)
(DTS_FULL<-DTS_FULL[,c(1,2)])
colnames(DTS_FULL)[2]<-"total_discards"
# now check it again

# now you have the real data-frame with all quarters for each year and you can move from quarters to a months level
(DTS_FULL$TOTDISCNEW<-DTS_FULL$total_discards/3)
(DTS_FULL2<-rbind(DTS_FULL,DTS_FULL,DTS_FULL))
(DTS_FULL2<-DTS_FULL2%>%arrange(FS))
(DTS_FULL2$month<-rep(c(1:12), length(DTS_FULL2$FS)/12))

(DTS_FULL2<-DTS_FULL2[,c(1,4,3)])
colnames(DTS_FULL2)[3]<-"total_discards"

(DTS_FULL2<-separate(DTS_FULL2, col=FS, into=c("A","B","C","D","F","G","H"), sep="_"))
(DTS_FULL2<-DTS_FULL2%>%unite("fleet_segment",B:G, remove = T))
(DTS_FULL2<-DTS_FULL2[,c(1,2,4,5)])

# at this point you should repeat all the process for the PGP as you did for DTS above.
(PGP<-catch%>%
  filter(country_name=="Italy" & sub_region%in%c("GSA9","GSA10","GSA11") & species=="HKE" & fishing_technique=="PGP"))
(PGP$total_discards[PGP$total_discards=="NK"] <- 0.000001)
(PGP$total_discards<-as.numeric(PGP$total_discards))

(PGP$total_discards<-PGP$total_discards*1000 )# here I convert tons to kg (BEMTool needs kg)

(PGP1<-PGP%>%
    group_by(year,sub_region,country_code,fishing_technique,gear_type,Target_Assemblage,vessel_length,Quarter)%>%
    summarise(total_discards=sum(total_discards)))
(PGP1<-PGP1%>%arrange(year,sub_region,sub_region))

(PGP1<-PGP1[,c(1,2,4,7,8,9)])
(PGP1<-PGP1%>%unite("FS",year:vessel_length, remove = T, sep = "_"))


(PGP1<-PGP1%>%
  group_by(FS,Quarter)%>%
  summarise(total_discards=sum(total_discards)))
(PGP1<-PGP1%>%arrange(FS))

# you need a similar fake dataframe as above

(FS<-unique(PGP1$FS))
(FS<-rep(FS, each=4 ))
(Quarter<-rep(c(1:4),length(FS)/4))
(BASICDFPGP1<-data.frame(FS,Quarter))
(BASICDFPGP1$total_discards<-0)
(BASICDFPGP1<-BASICDFPGP1%>%arrange(FS))

(BASICDFPGP1<-BASICDFPGP1%>%unite("FS",FS:Quarter, remove = T, sep = "_"))

(PGP2<-PGP1%>%unite("FS",FS:Quarter, remove = T, sep = "_"))
(PGP2<-PGP2%>%arrange(FS))

(DTS_FULL_PGP<-merge(PGP2,BASICDFPGP1,  by.x ="FS", by.y="FS", all.x = F, all.y = T))
(DTS_FULL_PGP[is.na(DTS_FULL_PGP)] = 0.00001)
(DTS_FULL_PGP<-DTS_FULL_PGP[,c(1,2)])
colnames(DTS_FULL_PGP)[2]<-"total_discards"
# check "DTS_FULL_PGP" dataframe 

(DTS_FULL_PGP$TOTDISCNEW<-DTS_FULL_PGP$total_discards/3)
(DTS_FULL_PGP2<-rbind(DTS_FULL_PGP,DTS_FULL_PGP,DTS_FULL_PGP))
(DTS_FULL_PGP2<-DTS_FULL_PGP2%>%arrange(FS))
DTS_FULL_PGP2$month<-rep(c(1:12), length(DTS_FULL_PGP2$FS)/12)

(DTS_FULL_PGP2<-DTS_FULL_PGP2[,c(1,4,3)])
colnames(DTS_FULL_PGP2)[3]<-"total_discards"
# check if there are missing data for specific years or fleet segments

(DTS_FULL_PGP2<-separate(DTS_FULL_PGP2, col=FS, into=c("A","B","C","D","FF"), sep="_"))

# now you start to grouping and checking PGP by LOA
# maybe some LOA in some GSAs in specific Years are missing as under reported data. 
# in this case you can assume similar discards of colse available years 
# you could also aggregate some LOA if you need

(DTS_FULL_PGP2_1218<-DTS_FULL_PGP2%>%
    filter(D=="VL1218")%>%
    group_by(A,B,C,D,month)%>%
    summarise(total_discards=sum(as.numeric(total_discards))))

(DTS_FULL_PGP2_1218<-DTS_FULL_PGP2_1218%>%arrange(A,B,D))
# for VL1218 there is no missing  data 

(DTS_FULL_PGP2_1218<-DTS_FULL_PGP2_1218%>%unite("fleet_segment", B,C,D, remove = T))

# same as above pluse here I grouped VL0006 with VL0012
(DTS_FULL_PGP2_VL0006<-DTS_FULL_PGP2%>%
    filter(D=="VL0006"))
#check if there are some missing data in "DTS_FULL_PGP2_VL0006"

(DTS_FULL_PGP2_VL0612<-DTS_FULL_PGP2%>%
    filter(D=="VL0612"))
#check if there are some missing data in "DTS_FULL_PGP2_VL0612"

DTS_FULL_PGP2_VL0012<-rbind(DTS_FULL_PGP2_VL0006,DTS_FULL_PGP2_VL0612)
(DTS_FULL_PGP2_VL0012<-DTS_FULL_PGP2_VL0012%>%
    group_by(A,B,C,month)%>%
    summarise(total_discards=sum(as.numeric(total_discards))))
(DTS_FULL_PGP2_VL0012$D<-"VL0012")

(DTS_FULL_PGP2_VL0012<-DTS_FULL_PGP2_VL0012%>%unite("fleet_segment", B,C,D, remove = T))

#Now you finally have your data frame with all months, metiers and LOA needed

(UPDATE_FULL_DF<-rbind(DTS_FULL2, DTS_FULL_PGP2_VL0012,DTS_FULL_PGP2_1218))

colnames(UPDATE_FULL_DF)[1]<-"year"
(UPDATE_FULL_DF<-UPDATE_FULL_DF%>%arrange(year,fleet_segment))

# a final check of "UPDATE_FULL_DF" is needed 

# if you do not have the last year as some time happen in DCF data (in my case for 2021) 
# you could just copy the last available year with the following few lines 

(DTS_NEW2021<-UPDATE_FULL_DF%>%filter(year=="2020"))
(DTS_NEW2021[,1]<-rep(2021,length(DTS_NEW2021$year)))
(NEW_DF<-rbind(UPDATE_FULL_DF,DTS_NEW2021))
(NEW_DF<-NEW_DF%>%arrange(year,fleet_segment))
# from here it should be finished the part with recent data 2014 to 2021 (2012 copied from 2020 data)

# 2014 proportion evalutation if need for estimation back in time 
# If you do not have data older than 2014 by quarters and metiers you may to calculate the portions (% by metiers and LOA) in 2014 and apply those portion back in time 
(UPDATE_FULL_DF_2014<-NEW_DF%>%
  filter(year=="2014"))
(UPDATE_FULL_DF_2014$PERC<-UPDATE_FULL_DF_2014$total_discards/sum(UPDATE_FULL_DF_2014$total_discards))

# In this example we applied the % of the last available year (2014). However, if you like you could also load a personal data frame with specific %. You could calculate the mean % of the last two or more years (2014,2015)
# (DISC<-read.csv("...../mean_per_Discard_data.csv",sep=";"))

# NB at this point you have an example of FDI discards data frame with % for three GSAs and five LOAs splitted by metiers and months in the last available year (2014) 
# Just as example we will create below a (fake) data frame with Discards data for the previous year 2006-2013.
# Next we will use the % FDI data frame in 2014 to split the older (fake) discard data frame (2006-2013) by GSA, LOA, metiers, Quarter and Month. 
# Please, create this (fake) second data frame using the same labels present in the 2014 % FDI data frame. 
# The two data frame Old (2006-2013) and new (2014-2021) should have the same structure and Fleet segments labels.

# Step 1) Create the "basic_DF" with discard data before 2014 
# Please, fill in the data frame with your discard data from 2006 to 2013 for your GSAs ( Three in this example ) and fishing technique (DTS and PGP in this example)


N<-8 # here insert the missing years you need (2006-2013)
NN<-2 # fishing technique (DTS and PGP)
NGSA<-3 # GSA 10, GSA 9, GSA 11
Nmetier<-3 # amount of metiers (DEF,DWS,MDD)

(year<-rep(c(2006:2013), each=NN))
(year<-rep(year,NGSA))
(sub_region_all<-rep(c("GSA10","GSA9","GSA11"), each= N*NN) )# 2 is are the two fishing fishing technique (DTS and PGP
(Fishing_Technique<-rep(c("DTS","PGP"), length(sub_region_all)/NN))
(Total_discards<-c(GSA10_DTS_2006<-80, # 80 kg is just an example value. Please add your actual values in kg. These can be found, for exampe, in the official stock assessment reports. 
                   GSA10_PGP_2006<-80,
                   GSA10_DTS_2007<-80,
                   GSA10_PGP_2007<-80,
                   GSA10_DTS_2008<-80,
                   GSA10_PGP_2008<-80,
                   GSA10_DTS_2009<-80,
                   GSA10_PGP_2009<-80,  
                   GSA10_DTS_2010<-80,
                   GSA10_PGP_2010<-80,
                   GSA10_DTS_2011<-80,
                   GSA10_PGP_2011<-80,
                   GSA10_DTS_2012<-80,
                   GSA10_PGP_2012<-80,
                   GSA10_DTS_2013<-80,
                   GSA10_PGP_2013<-80,
                   
                   GSA9_DTS_2006<-50, # 50 kg is just an example value. Please add your values in kg. 
                   GSA9_PGP_2006<-50,
                   GSA9_DTS_2007<-50,
                   GSA9_PGP_2007<-50,
                   GSA9_DTS_2008<-50,
                   GSA9_PGP_2008<-50,
                   GSA9_DTS_2009<-50,
                   GSA9_PGP_2009<-50,  
                   GSA9_DTS_2010<-50,
                   GSA9_PGP_2010<-50,
                   GSA9_DTS_2011<-50,
                   GSA9_PGP_2011<-50,
                   GSA9_DTS_2012<-50,
                   GSA9_PGP_2012<-50,
                   GSA9_DTS_2013<-50,
                   GSA9_PGP_2013<-50,
                   
                   GSA11_DTS_2006<-30, # 30 kg is just an example value. Please add your values in kg. 
                   GSA11_PGP_2006<-30,
                   GSA11_DTS_2007<-30,
                   GSA11_PGP_2007<-30,
                   GSA11_DTS_2008<-30,
                   GSA11_PGP_2008<-30,
                   GSA11_DTS_2009<-30,
                   GSA11_PGP_2009<-30,  
                   GSA11_DTS_2010<-30,
                   GSA11_PGP_2010<-30,
                   GSA11_DTS_2011<-30,
                   GSA11_PGP_2011<-30,
                   GSA11_DTS_2012<-30,
                   GSA11_PGP_2012<-30,
                   GSA11_DTS_2013<-30,
                   GSA11_PGP_2013<-30))

(basicDF<-data.frame(year,sub_region_all,Fishing_Technique,Total_discards)) # this is the data base with your data that will be splitted. 

# Next, you need a total discards value by each year for all GSAs grouped. 
# It is not a problem to bind the all gsas due to the fact that those are the same GSas of the 2014 % data frame.
# Please be sure that the GSAs order in the two data frame ( 2006-2013 and 2014% ) are exactly the same. 

(basicD_2<-basicDF%>%
  group_by(year)%>%
  summarise(Total_discards=sum(Total_discards)))

(basicD_3<-basicD_2[rep(c(1:N), nrow(UPDATE_FULL_DF_2014)), ])
(basicD_3<-basicD_3%>%arrange(year))

(UPDATE_FULL_DF_2014_duplicated<-UPDATE_FULL_DF_2014[rep(c(1:nrow(UPDATE_FULL_DF_2014)),N),])
(BIG_NEW_DF<-cbind(UPDATE_FULL_DF_2014_duplicated,basicD_3))
(BIG_NEW_DF$new_discards<-BIG_NEW_DF$PERC*BIG_NEW_DF$Total_discards)

############## TEST ######################
# Please check if it is all right 
(test<-BIG_NEW_DF[c(1:nrow(UPDATE_FULL_DF_2014)),c(6,2,3,8)])
sum(test$new_discards) # The sum should be equal to the sum of your data grouped by the GSAs in the same year
#########################################

(BIG_NEW_DF<-BIG_NEW_DF[,c(6,2,3,8)])
colnames(BIG_NEW_DF)[4]<-"total_discards"
# Step 2) Finally you can bind the spitted old data frame created (2006-2013) with the recent discards data frame (2014-2021)

(DISCARD_DATA<-rbind(BIG_NEW_DF,NEW_DF))

(DISCARD_DATA<-DISCARD_DATA%>%arrange(year,fleet_segment))

# the following lines are used for create the final data frame structure as needed by BEMTool 
#BEMTool needs to change month labels 
(DISCARD_DATA$month<-c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Set", "Oct", "Nov", "Dec")) # please check if the months are in the correct orders
```


```{r split_discards, child='splitting_discards' , eval=F}
(df0 <- data.frame(matrix(nrow=0, ncol=4)))
(colnames(df0) <-c("year",	"month",	"total_discards",	"fleet_segment"))
(segs<-unique(DISCARD_DATA$fleet_segment))

for(n in 1 : length(segs)){ 
  (years <- min(DISCARD_DATA[DISCARD_DATA$fleet_segment==segs[n], "year"]))
  (appoggio <- data.frame(matrix(nrow=1, ncol=4)))
  (colnames(appoggio) <-c("year",	"month",	"total_discards",	"fleet_segment"))
  (appoggio[,2]<-"seed")
  (appoggio[,3]<-sum(DISCARD_DATA[DISCARD_DATA$fleet_segment==segs[n] & DISCARD_DATA$year==years,"total_discards"]))
  (appoggio[,4]<-segs[n])
  df0 <- rbind(df0,appoggio,DISCARD_DATA[DISCARD_DATA$fleet_segment==segs[n],])
}

(Discard_data<-df0)
# Please add your directory and save your file in csv format in your INPUT folder. 
# write.table(Discard_data,.../Discard data.csv",sep=";",row.names=F)  

```



\textbf{H. Aladym-landings-obligations.csv }

MANUALLY IN EXCEL FOR THE MOMENT

\textbf{(b) EFFORT} 


\textbf{i number-of-vessels.csv}

FDI_capacity_by_country.csv for data from 2014 to 2020.

STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment for data from 2006 to 2013. 

```{r}
library(readxl)
library(tidyverse)
library(tidyr)

##################### 1 #############################################

(RECENTDATA2<-read.csv("D:/Andrea/Desktop/NEW_BEMTool/FDI_capacity_by_country.csv", sep = ";"))

# here I select my fleet segments and the GSA( I wnat to work with)
(GSA9_2_A<-RECENTDATA2%>% 
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & principal.sub.region=="GSA9"))


# i NEED TO GROUP pgp VL0006 WITH VL0612 AS VL0012
(GSA9_2_B1<-RECENTDATA2%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006","VL0612") & principal.sub.region=="GSA9")%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarise(total.vessels=sum(as.numeric(total.vessels))))
GSA9_2_B1$Vessel.Length.Category<-"VL0012"



(GSA9_2_B2<-RECENTDATA2%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL1218") & principal.sub.region=="GSA9"))

GSA9_2<-rbind(GSA9_2_A,GSA9_2_B1,GSA9_2_B2)

GSA9_2$Month<-0
GSA9_2$Unit<-"vess"
GSA9_2$Source<-"FDI_capacity_by_country"

head(GSA9_2)
(GSA9_2<-GSA9_2[,c(5,4,3,2,7,6,8,9)])

(GSA9_2<-GSA9_2%>%arrange(year,Fishing.Technique,Vessel.Length.Category))

########################## 2 ###############

#  Data from 2008 to 2013 where available in 08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx. The data are at a Country level only. Fleet segment and GSA detail are not presents. 
# If data in 2006 and 2007 are not present please assume those equal to 2008.

#  Calculate the % of your GSA respect to all the GSA in your country form the FDI data in 2014. After, I can apply this % to and use this proportion to STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment data

# here the extraction of data from 2008 to 2013

dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx"

(OLD_DATA<-read_xlsx(dir, sheet = 2))

# all the GSA 
(OLD_DATA_DTS<-OLD_DATA%>%
    select(country_code,supra_reg,year,fishing_tech,variable_code,vessel_length,variable_code,value,unit)%>%
    filter(country_code=="ITA", variable_code=="totves" & fishing_tech=="DTS" & supra_reg =="AREA37" & vessel_length%in%c("VL0612" ,"VL1218", "VL1824", "VL2440")))

(OLD_DATA_PGP<-OLD_DATA%>%
   select(country_code,supra_reg,year,fishing_tech,variable_code,vessel_length,value,unit)%>%
    filter(country_code=="ITA", variable_code=="totves" & fishing_tech=="PGP" & supra_reg =="AREA37" & vessel_length%in%c("VL0612" ,"VL1218")))
# here we do not need to merge the VL0006 and VL0612
OLD_DATA_PGP$vessel_length[OLD_DATA_PGP$vessel_length=="VL0612"]<-"VL0012"

OLD_DATA<-rbind(OLD_DATA_DTS,OLD_DATA_PGP)

#this is the old data i need
(OLD_DATA_2<-OLD_DATA%>%arrange(year,fishing_tech,vessel_length))

# RECENT DATA ALL
(GSAITA_TOT_RECENTDATA_DTS<-RECENTDATA2%>%
   select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
   filter(Country.name=="Italy" &  Fishing.Technique=="DTS" & principal.sub.region%in%c("GSA17","GSA18","GSA19","GSA16","GSA10","GSA9","GSA11")))
(GSAITA_TOT_RECENTDATA_DTS<-GSAITA_TOT_RECENTDATA_DTS%>%filter(Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440")))


(GSAITA_TOT_RECENTDATA_PGP1<-RECENTDATA2%>%
   select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
   filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & principal.sub.region%in%c("GSA17","GSA18","GSA19","GSA16","GSA10","GSA9","GSA11")))
  
 (GSAITA_TOT_RECENTDATA_PGP1<-GSAITA_TOT_RECENTDATA_PGP1%>%
   filter(Vessel.Length.Category%in%c("VL0006" ,"VL0612"))%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarize(total.vessels=sum(as.numeric(total.vessels))))
GSAITA_TOT_RECENTDATA_PGP1$Vessel.Length.Category<-"VL0012"

(GSAITA_TOT_RECENTDATA_PGP2<-RECENTDATA2%>%
   select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.vessels)%>%
   filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & principal.sub.region%in%c("GSA17","GSA18","GSA19","GSA16","GSA10","GSA9","GSA11")))
(GSAITA_TOT_RECENTDATA_PGP2<-GSAITA_TOT_RECENTDATA_PGP2%>%filter(Vessel.Length.Category=="VL1218"))

(GSAITA_TOT_RECENTDATA<-rbind(GSAITA_TOT_RECENTDATA_DTS,GSAITA_TOT_RECENTDATA_PGP1,GSAITA_TOT_RECENTDATA_PGP2))

(GSAITA_TOT_RECENTDATA2<-GSAITA_TOT_RECENTDATA%>%arrange(year,Fishing.Technique,Vessel.Length.Category))

(GSAITA_TOT_RECENT_2014_DTS<-GSAITA_TOT_RECENTDATA2%>%
    filter(year =="2014"& Fishing.Technique=="DTS")%>%
    group_by(Country.name,year ,Fishing.Technique,Vessel.Length.Category)%>%
    summarise(total.vessels=sum(as.numeric(total.vessels))))

(GSAITA_TOT_RECENT_2014_PGP<-GSAITA_TOT_RECENTDATA2%>%
    filter(year =="2014"& Fishing.Technique=="PGP")%>%
    group_by(Country.name,year ,Fishing.Technique,Vessel.Length.Category)%>%
    summarise(total.vessels=sum(as.numeric(total.vessels))))

 
(GSAITA_TOT_RECENT_2014<-rbind(GSAITA_TOT_RECENT_2014_DTS,GSAITA_TOT_RECENT_2014_PGP))

# calculate the % 
(GSA9_3<-GSA9_2%>%filter(year=="2014"))
(GSA9_3<-GSA9_3%>%arrange(year,Fishing.Technique,Vessel.Length.Category))

(GSA9_3$PROP<-GSA9_3$total.vessels/GSAITA_TOT_RECENT_2014$total.vessels)

# go back to the old data set
(OLD_DATA_3<-OLD_DATA_2%>%filter(supra_reg=="AREA37" & year%in%c("2008","2009","2010","2011","2012","2013")))

(OLD_DATA_3<-OLD_DATA_3%>%arrange(year,fishing_tech,vessel_length))

# create a df of the same size 
(newDF<-rbind(GSA9_3,GSA9_3,GSA9_3,GSA9_3,GSA9_3,GSA9_3))
(OLD_DATA_3$new_vessel<-newDF$PROP*OLD_DATA_3$value)

################################## 3 ####################

# past all old + recent data frame
# OLD
head(OLD_DATA_3)
OLD_DATA_3$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment"
OLD_DATA_3$GSA<-"GSA9"
OLD_DATA_3$Month<-0 
OLD_DATA_3$Unit<-"vess"

(OLD_DATA_4<-OLD_DATA_3[,c(11,4,6,3,12,9,8,10)])
colnames(OLD_DATA_4)[6]<-"Vess"

# now you need to create the absent 2006 and 2007 data equal to 2008 
(OLD_DATA_2006<-OLD_DATA_4%>%filter(year=="2008"))
OLD_DATA_2006[,4]<-c(rep("2006",6))

(OLD_DATA_2007<-OLD_DATA_4%>%filter(year=="2008"))
(OLD_DATA_2007[,4]<-c(rep("2007",6)))
# merge all the old data set 

(OLD_DATA_4<-rbind(OLD_DATA_2006,OLD_DATA_2007,OLD_DATA_4))

#RECENT
colnames(GSA9_2)[1]<-"GSA"
colnames(GSA9_2)[2]<-"fishing_tech"
colnames(GSA9_2)[3]<-"vessel_length"

colnames(GSA9_2)[6]<-"Vess"

names(OLD_DATA_4)
names(GSA9_2)

names(OLD_DATA_4)[7]<-"Unit"
(BIGDF<-rbind(OLD_DATA_4,GSA9_2))
(BIGDF<-BIGDF%>%arrange(year,fishing_tech,vessel_length))

################################## 4 ####################
# For some fleet segments ("VL1218", "VL1824", "VL2440") you need to duplicate vessels for the three metiers DEF, DWS and MDD

(BIGDFDUP<-BIGDF%>%filter(vessel_length!="VL0612" & fishing_tech!="PGP")) #segment to be duplicated

(BIGDFNODUP_DTS<-BIGDF%>%filter(vessel_length=="VL0612" & fishing_tech=="DTS"))#segment ok

(BIGDFNODUP_PGP<-BIGDF%>%filter(fishing_tech=="PGP" & vessel_length%in%c("VL0012","VL1218")))


(BIGDFDUP_DEF<-BIGDFDUP_DWS<-BIGDFDUP_MDD<-BIGDFDUP)
(BIGDFDUP_DEF$Metier<-"DEF")
(BIGDFDUP_DWS$Metier<-"DWS")
(BIGDFDUP_MDD$Metier<-"MDD")


(BIGDFDUPLICATED<-rbind(BIGDFDUP_DEF,BIGDFDUP_DWS,BIGDFDUP_MDD)) # I duplicate the line of the three vessels lenght for the three metiers
BIGDFNODUP_DTS$Metier<-"DEF"
BIGDFNODUP_DTS$gear<-"OTB"
(BIGDFDUPLICATED$gear<-"OTB")
(BIGDFNODUP_DTS<-BIGDFNODUP_DTS[,c(1,2,3,10,9,4,5,6,7,8)])
(BIGDFDUPLICATED<-BIGDFDUPLICATED[,c(1,2,3,10,9,4,5,6,7,8)])

(BIGDFNODUP_DTS<-BIGDFNODUP_DTS%>%unite("FS",c(GSA:Metier), remove = T))
(BIGDFDUPLICATED<-BIGDFDUPLICATED%>%unite("FS",c(GSA:Metier), remove = T))
(BIGDFNODUP_PGP<-BIGDFNODUP_PGP%>%unite("FS",c(GSA:vessel_length), remove = T))

(FINALDF<-rbind(BIGDFNODUP_DTS,BIGDFDUPLICATED,BIGDFNODUP_PGP))

(FINALDF<-FINALDF%>%arrange(year,FS))

colnames(FINALDF)[2]<-"Year"

FINALDF$Vess<-round(FINALDF$Vess)
FINALDF

(FINALDF<-FINALDF%>%filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))	
write.csv(FINALDF,"D:/Andrea/Desktop/NEW_BEMTool/FINALDF_VESSEL.csv",sep=";",row.names=F) 

#################################### 5 #############################################################
# run the loop and create the Bemtool input csv file

ts<-c(2006:2021)

trans_year=c(2021)

#VESSELS
(Vess_data=FINALDF)
Fleet_segments <-  unique(FINALDF$FS) 

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

# Fleet_segments[1]
(Vess_data_temp=Vess_data[Vess_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Vess_data_temp)){
  
 year=Vess_data_temp$Year[rr] 
 month=Vess_data_temp$Month[rr]
 #unit=Vess_data_temp$Unit[rr]
 
 if (month!=0){
 DF1[rownames(DF1)==month,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
 } else if (month==0){
     DF1[,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
   }  
   
 }
 
DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)]

for (fs in Fleet_segments[-1]){

print(fs,quote=F)
DF_next=matrix(0,nrow=12,ncol=length(ts))
colnames(DF_next)=ts
rownames(DF_next)=seq(1,12,1)

# Fleet_segments[1]
Vess_data_temp=Vess_data[Vess_data$FS==fs,]

for (rr in 1:nrow(Vess_data_temp)){
  
  year=Vess_data_temp$Year[rr] 
  month=Vess_data_temp$Month[rr]
  unit=Vess_data_temp$Unit[rr]
  
  if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
    
  } else if (month==0){
    
        DF_next[,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
    }  
    
}
DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]

DF1=cbind(DF1,DF_next)

} # ciclo FS

for (f in 1:length(Fleet_segments)){
  print(Fleet_segments[f])
  ini=1 +(f-1)*length(ts)
  fin=(f)*length(ts)
  if (length(DF1[,ini:fin][which(DF1[,ini:fin]==0)])>0){
  DF1[,ini:fin][which(DF1[,ini:fin]==0)] = mean(DF1[,ini:fin][which(DF1[,ini:fin]!=0)]) 
  }
}

#FirstRow=t(data.frame(rep(ts,length(Fleet_segments))))
#FirstRow=c("Units: kg",FirstRow)

SecondRow=t(data.frame(rep(Fleet_segments[1],length(ts)))  )

for (fs in Fleet_segments[-1]){
  print(fs)
  SecondRow2=t(data.frame(rep(fs,length(ts))))
  
  SecondRow=cbind(SecondRow,SecondRow2) 
 
}

empty_row=t(data.frame(rep("",length(SecondRow))))

DF_final=(rbind(SecondRow,empty_row,empty_row))

DF_final=rbind(DF_final,as.matrix(DF1))

DF_final= cbind(c(   "casestudy.fleetsegmentcode",
                       "casestudy.fishingtechnique",
                       "casestudy.loa",
                       "casestudy.month1",
                       "casestudy.month2",
                       "casestudy.month3",
                       "casestudy.month4",
                       "casestudy.month5",
                       "casestudy.month6",
                       "casestudy.month7",
                       "casestudy.month8",
                       "casestudy.month9",
                       "casestudy.month10",
                       "casestudy.month11",
                       "casestudy.month12"),DF_final)

colnames(DF_final)[1]="Units: number"

write.table(DF_final,"D:/Andrea/Desktop/NEW_BEMTool/number-of-vessels.csv",row.names=F) 

```


\textbf{ii average-GT.csv}

For data from 2014-2020 use FDI_capacity_by_country.csv

For data from 2008-2013 use STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.cs

Then calculate the % of the 2014 year of  FDI_capacity_by_country.csv respect to the all ITALIAN or COUNTRY GSA and applay this % to the data from 2008-2020. 2006 and 2007 = to 2008. 

GT needs to be just duplicate by the metiers (3 times in this case)

```{r}
library(readxl)
library(tidyverse)
(RECENTDATA2<-read.csv("D:/Andrea/Desktop/NEW_BEMTool/FDI_capacity_by_country.csv", sep = ";"))

# here I select my fleet segments and the GSA( I want to work with)
(GSA9_2_A_GT<-RECENTDATA2%>% 
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & principal.sub.region=="GSA9"))

# i NEED TO GROUP the VL0006 WITH VL0612 AS VL0012
(GSA9_2_B1_GT<-RECENTDATA2%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006","VL0612") & principal.sub.region=="GSA9")%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarise(total.GT=sum(as.numeric(total.GT))))
GSA9_2_B1_GT$Vessel.Length.Category<-"VL0012"

(GSA9_2_B2_GT<-RECENTDATA2%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL1218") & principal.sub.region=="GSA9"))

GSA9_2_GT<-rbind(GSA9_2_A_GT,GSA9_2_B1_GT,GSA9_2_B2_GT)

GSA9_2_GT$Month<-0
GSA9_2_GT$Unit<-"vess"
GSA9_2_GT$Source<-"FDI_capacity_by_country"

head(GSA9_2_GT)
(GSA9_2_GT<-GSA9_2_GT[,c(5,4,3,2,7,6,8,9)])

(GSA9_2_GT<-GSA9_2_GT%>%arrange(year,Fishing.Technique,Vessel.Length.Category))

(GSA9_GT_2014_0612_DTS<-GSA9_2_GT%>%filter(Fishing.Technique=="DTS" & Vessel.Length.Category=="VL0612")) # 1  DF
(GSA9_GT_2014_0612_DTS$metier<-"DEF")
GSA9_GT_2014_0612_DTS$OTB<-"OTB"

(GSA9_GT_2014_1240_DTS<-GSA9_2_GT%>%filter(Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL1218","VL1824","VL2440"))) # 2 DF
GSA9_GT_2014_1240_DTS$OTB<-"OTB"

(GSA9_GT_2014_0018_PGP<-GSA9_2_GT%>%filter(Fishing.Technique=="PGP")) # 3 DF


# new DF 2 
(NEWNEWDFGT<-rbind((GSA9_GT_2014_1240_DTS[rep(1,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(2,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(3,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(4,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(5,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(6,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(7,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(8,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(9,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(10,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(11,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(12,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(13,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(14,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(15,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(16,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(17,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(18,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(19,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(20,3),]),
                   (GSA9_GT_2014_1240_DTS[rep(21,3),]) ))
                   
  
 NEWNEWDFGT$metier<- rep(c("DEF","DWS","MDD"),21)
 NEWNEWDFGT$OTB<-"OTB"
 
 
(GSA9_GT_2014_0612_DTS<-GSA9_GT_2014_0612_DTS[,c(1,2,3,10,9,4,5,6,7,8)] %>%unite("FS",c(principal.sub.region:metier), remove = T))

(NEWNEWDFGT<-NEWNEWDFGT[,c(1,2,3,9,10,4,5,6,7,8)]%>%unite("FS",c(principal.sub.region:metier), remove = T))

 (GSA9_GT_2014_0018_PGP<-GSA9_GT_2014_0018_PGP%>%unite("FS",c(principal.sub.region:Vessel.Length.Category), remove = T))
 
 
(GSA9_GT<-rbind(GSA9_GT_2014_0612_DTS,NEWNEWDFGT,GSA9_GT_2014_0018_PGP)) # 1 + new DF 2 + 3
(GSA9_GT<-GSA9_GT%>%arrange(year,FS)) ### RECENT READY NOW I NEED JUST THE OLD ONE 
#################################################################################################################################################
 ###  2 #####################

# now take all the gsa of the 2014 and calculate the % of you GSA respect to the total for each fleet segment
(ALLGSAOTB<-RECENTDATA2%>%
   select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
   filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11")))
(ALLGSAOTB$BIGTOTAL<-sum(as.numeric(ALLGSAOTB$total.GT)))
ALLGSAOTB$PERC<-as.numeric(ALLGSAOTB$total.GT)/as.numeric(ALLGSAOTB$BIGTOTAL)
(ALLGSAOTB<-ALLGSAOTB%>%filter(principal.sub.region=="GSA9"))



# Two lines below if you need different Fishing technique like PGP_ 
(ALLGSAPGP_A<-RECENTDATA2%>%select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
    filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006" ,"VL0612") & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11"))%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarize(total.GT=sum(as.numeric(total.GT))))
ALLGSAPGP_A$Vessel.Length.Category<-"VL0012"
(ALLGSAPGP_A$BIGTOTAL<-sum(ALLGSAPGP_A$total.GT))
ALLGSAPGP_A$PERC<-as.numeric(ALLGSAPGP_A$total.GT)/as.numeric(ALLGSAPGP_A$BIGTOTAL)
(ALLGSAPGP_A<-ALLGSAPGP_A%>%filter(principal.sub.region=="GSA9"))


(ALLGSAPGP_B<-RECENTDATA2%>%select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,total.GT)%>%
    filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="PGP" & Vessel.Length.Category=="VL1218" & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11")))
(ALLGSAPGP_B$BIGTOTAL<-sum(as.numeric(ALLGSAPGP_B$total.GT)))
ALLGSAPGP_B$PERC<-as.numeric(ALLGSAPGP_B$total.GT)/as.numeric(ALLGSAPGP_B$BIGTOTAL)
(ALLGSAPGP_B<-ALLGSAPGP_B%>%filter(principal.sub.region=="GSA9"))

(ALLGSAPGP<-rbind(ALLGSAOTB,ALLGSAPGP_A,ALLGSAPGP_B))
(ALLGSAPGP<-ALLGSAPGP%>%arrange(year,Fishing.Technique,Vessel.Length.Category))  # HERE are the percentage I need to apply to the OLD data set where the GSA level is absent

################  step 2 ########
# here the extraction of data from 2008 to 2013
library(readxl)
dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx"

(OLD_DATA_GT<-read_xlsx(dir, sheet = 2))
unique(OLD_DATA_GT$variable_code)

# all the GSA. Please check if there are some missing years or fleets segments 
(OLD_DATA_GT_DTS<-OLD_DATA_GT%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totgt" & fishing_tech=="DTS" & supra_reg =="AREA37" & vessel_length%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") ))

(OLD_DATA_GT_PGP_1<-OLD_DATA_GT%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totgt" & fishing_tech=="PGP" & supra_reg =="AREA37" & vessel_length%in%c("VL0006" ,"VL0612"))%>%
    group_by(country_code,year,fishing_tech,variable_code,supra_reg)%>%
    summarise(value=sum(as.numeric(value))))
(OLD_DATA_GT_PGP_1$vessel_length<-"VL0012")

(OLD_DATA_GT_PGP_2<-OLD_DATA_GT%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totgt" & fishing_tech=="PGP" & supra_reg =="AREA37" & vessel_length=="VL1218"))

(OLD_DATA_GT<-rbind(OLD_DATA_GT_DTS,OLD_DATA_GT_PGP_1,OLD_DATA_GT_PGP_2))
  
(OLD_DATA_GT<-OLD_DATA_GT%>%arrange(year,fishing_tech,vessel_length))

(OLD_DATA_GT$PERC<-rep(ALLGSAPGP$PERC,9))
(OLD_DATA_GT$GT<-OLD_DATA_GT$value*OLD_DATA_GT$PERC) # THIS is almost ready I need to add the copied 2006 and 2007 form 2008 and duplicate the DTS of all time series for the 3 metiers DEF DWS MDD 

# merge "VL1012" with "VL0612"

(OLD_DATA_GT2<-OLD_DATA_GT%>%filter(year%in%c("2008","2009","2010","2011","2012","2013")))
#check if something is missing

(OLD_DATA_GT2<-OLD_DATA_GT2%>%arrange(year,vessel_length))


(OLD_DATA_GT3<-OLD_DATA_GT2[,c(2,3,4,5,9)])

# in this case in 2008 the data of VL2440 is missing we add the same amount of 2009 

# now you need to create the absent 2006 and 2007 data equal to 2008 
(OLD_DATA_GT3_2006<-OLD_DATA_GT3%>%filter(year=="2008"))
(OLD_DATA_GT3_2006[,1]<-c(rep("2006",6)))

(OLD_DATA_GT3_2007<-OLD_DATA_GT3%>%filter(year=="2008"))
(OLD_DATA_GT3_2007[,1]<-c(rep("2007",6)))
# merge all the old data set 

(OLD_DATA_GT4<-rbind(OLD_DATA_GT3_2006,OLD_DATA_GT3_2007,OLD_DATA_GT3))
(OLD_DATA_GT4<-OLD_DATA_GT4%>%arrange(year,fishing_tech,vessel_length))

# For some fleet segments ("VL1218", "VL1824", "VL2440") you need to duplicate vessels for the three metiers DEF, DWS and MDD


(OLD_DATA_GT4DUP_DTS<-OLD_DATA_GT4%>%filter(fishing_tech=="DTS" & vessel_length!="VL0612"))


(OLD_DATA_GT4NODU_DTS<-OLD_DATA_GT4%>%filter(fishing_tech=="DTS" &vessel_length=="VL0612"))
(OLD_DATA_GT4NODU_PGP<-OLD_DATA_GT4%>%filter(fishing_tech=="PGP" & vessel_length%in%c("VL0012","VL1218")))


(OLD_DATA_GT4DUP_DEFGT<-OLD_DATA_GT4DUP_DWSGT<-OLD_DATA_GT4DUP_MDDGT<-OLD_DATA_GT4DUP_DTS)
(OLD_DATA_GT4DUP_DEFGT$Metier<-"DEF")
(OLD_DATA_GT4DUP_DWSGT$Metier<-"DWS")
(OLD_DATA_GT4DUP_MDDGT$Metier<-"MDD")
(OLD_DATADUPLICATEDGT<-rbind(OLD_DATA_GT4DUP_DEFGT,OLD_DATA_GT4DUP_DWSGT,OLD_DATA_GT4DUP_MDDGT)) # I duplicate the line of the three vessels length for the three metiers
OLD_DATA_GT4NODU_DTS$Metier<-"DEF"


(OLD_DATA_GT4NODU_DTS$gear<-"OTB")
(OLD_DATA_GT4NODU_DTS$GSA<-"GSA9")
(OLD_DATA_GT4NODU_DTS$Month<-0)
(OLD_DATA_GT4NODU_DTS$Unit<-"TotalGT")
(OLD_DATA_GT4NODU_DTS$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATADUPLICATEDGT$gear<-"OTB")
(OLD_DATADUPLICATEDGT$GSA<-"GSA9")
(OLD_DATADUPLICATEDGT$Month<-0)
(OLD_DATADUPLICATEDGT$Unit<-"TotalGT")
(OLD_DATADUPLICATEDGT$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATA_GT4NODU_PGP$GSA<-"GSA9")
(OLD_DATA_GT4NODU_PGP$Month<-0)
(OLD_DATA_GT4NODU_PGP$Unit<-"TotalGT")
(OLD_DATA_GT4NODU_PGP$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATA_GT4NODU_DTS<-OLD_DATA_GT4NODU_DTS[,c(8,2,3,7,6,1,9,5,10,11)]%>%unite("FS",c(GSA:Metier), remove = T))
(OLD_DATADUPLICATEDGT<-OLD_DATADUPLICATEDGT[,c(8,2,3,7,6,1,9,5,10,11)]%>%unite("FS",c(GSA:Metier), remove = T))
(OLD_DATA_GT4NODU_PGP<-OLD_DATA_GT4NODU_PGP[,c(6,2,3,1,7,5,8,9)]%>%unite("FS",c(GSA:vessel_length), remove = T))

(FINALGTX<-rbind(OLD_DATA_GT4NODU_DTS,OLD_DATADUPLICATEDGT,OLD_DATA_GT4NODU_PGP))

colnames(FINALGTX)[2]<-"Year"
(FINALGTX<-FINALGTX%>%arrange(Year,FS))

# RECENT + OLD 
colnames(GSA9_GT)[2]<-"Year"
colnames(GSA9_GT)[4]<-"GT"

(BIGDFGT<-rbind(FINALGTX,GSA9_GT))

(BIGDFGT$Year<-as.numeric(BIGDFGT$Year))
(BIGDFGT$GT<-as.numeric(BIGDFGT$GT))
(BIGDFGT$GT<-round(BIGDFGT$GT))
BIGDFGT$FS<-as.character(BIGDFGT$FS)

#check the size and rows of the two data base 

(BIGDFGT<-BIGDFGT%>%filter(!FS%in%c("GSA9_DTS_VL0612_OTB_MDD","GSA9_DTS_VL0612_OTB_DWS","GSA9_DTS_VL2440_OTB_DWS"))) 

Fleet_segments<-unique(BIGDFGT$FS)
```


```{r}
#dir.create("BMT_INPUT")

ts<-c(2006:2021)
trans_year=c(2021)

#GT
#(GT_data=read.table("C:/Users/andre/OneDrive/Desktop/COISPA/BEMTOOL/MUT17/input formats/gt_mut_last_17_18.csv", sep=",", header=T))
GT_data=BIGDFGT
(GT_data=GT_data[GT_data$Year %in% ts & GT_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

# Fleet_segments[1]
(GT_data_temp=GT_data[GT_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(GT_data_temp)){
  
 year=GT_data_temp$Year[rr] 
 month=GT_data_temp$Month[rr]
 #unit=GT_data_temp$Unit[rr]
 
 if (month!=0){
 DF1[rownames(DF1)==month,colnames(DF1)==year]=GT_data_temp$GT[rr]
 } else if (month==0){
     DF1[,colnames(DF1)==year]=GT_data_temp$GT[rr]
   }  
   
 }
 
(DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)])

for (fs in Fleet_segments[-1]){

print(fs,quote=F)
DF_next=matrix(0,nrow=12,ncol=length(ts))
colnames(DF_next)=ts
rownames(DF_next)=seq(1,12,1)

# Fleet_segments[1]
GT_data_temp=GT_data[GT_data$FS==fs,]

for (rr in 1:nrow(GT_data_temp)){
  
  year=GT_data_temp$Year[rr] 
  month=GT_data_temp$Month[rr]
  unit=GT_data_temp$Unit[rr]
  
  if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=GT_data_temp$GT[rr]  
    
  } else if (month==0){
    
        DF_next[,colnames(DF_next)==year]=GT_data_temp$GT[rr]  
    }  
    
}

DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]

DF1=cbind(DF1,DF_next)

} # ciclo FS

(GT=DF1)

#VESSELS
#(Vess_data=read.table("C:/Users/andre/OneDrive/Desktop/COISPA/BEMTOOL/MUT17/input formats/Vess_data_17_18.csv",sep=";", header=T))
(Vess_data=FINALDF )# FROM VESSEL SCRIPT

(Vess_data=Vess_data[Vess_data$Year %in% ts & Vess_data$FS %in% Fleet_segments,])

DF1=matrix(0,nrow=12,ncol=length(ts))
colnames(DF1)=ts
rownames(DF1)=seq(1,12,1)

# Fleet_segments[1]
(Vess_data_temp=Vess_data[Vess_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Vess_data_temp)){
  
  year=Vess_data_temp$Year[rr] 
  month=Vess_data_temp$Month[rr]
  #unit=Vess_data_temp$Unit[rr]
  
  if (month!=0){
    DF1[rownames(DF1)==month,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  } else if (month==0){
    DF1[,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  }  
  
}

DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)]

for (fs in Fleet_segments[-1]){
  
  print(fs,quote=F)
  DF_next=matrix(0,nrow=12,ncol=length(ts))
  colnames(DF_next)=ts
  rownames(DF_next)=seq(1,12,1)
  
  # Fleet_segments[1]
  Vess_data_temp=Vess_data[Vess_data$FS==fs,]
  
  for (rr in 1:nrow(Vess_data_temp)){
    
    year=Vess_data_temp$Year[rr] 
    month=Vess_data_temp$Month[rr]
    unit=Vess_data_temp$Unit[rr]
    
    if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
      
    } else if (month==0){
      
      DF_next[,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
    }  
    
  }
  DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]
  
  DF1=cbind(DF1,DF_next)
  
} # ciclo FS


(Vess=DF1)


(Avg_GT=GT/Vess)

for (f in 1:length(Fleet_segments)){
ini=1+(f-1)*length(ts)
fin=(f)*length(ts)
if (length(Vess[,ini:fin][which(Vess[,ini:fin]==0)])>0){
Avg_GT[,ini:fin][Vess[,ini:fin]==0] = mean(Avg_GT[,ini:fin][Vess[,ini:fin]!=0],na.rm=T )  
}
}

# 
# for (f in 1:length(Fleet_segments)){
#   print(Fleet_segments[f])
#   ini=1 +(f-1)*length(ts)
#   fin=(f)*length(ts)
#   if (length(DF1[,ini:fin][which(DF1[,ini:fin]==0)])>0){
#     DF1[,ini:fin][which(DF1[,ini:fin]==0)] = mean(DF1[,ini:fin][which(DF1[,ini:fin]!=0)]) 
#   }
# }

#FirstRow=t(data.frame(rep(ts,length(Fleet_segments))))
#FirstRow=c("Units: kg",FirstRow)

SecondRow=t(data.frame(rep(Fleet_segments[1],length(ts)))  )

for (fs in Fleet_segments[-1]){
  print(fs)
  SecondRow2=t(data.frame(rep(fs,length(ts))))
  
  SecondRow=cbind(SecondRow,SecondRow2) 
 
}

empty_row=t(data.frame(rep("",length(SecondRow))))

DF_final=(rbind(SecondRow,empty_row,empty_row))

DF_final=rbind(DF_final,as.matrix(Avg_GT))

DF_final= cbind(c(     "casestudy.fleetsegmentcode",
                       "casestudy.fishingtechnique",
                       "casestudy.loa",
                       "casestudy.month1",
                       "casestudy.month2",
                       "casestudy.month3",
                       "casestudy.month4",
                       "casestudy.month5",
                       "casestudy.month6",
                       "casestudy.month7",
                       "casestudy.month8",
                       "casestudy.month9",
                       "casestudy.month10",
                       "casestudy.month11",
                       "casestudy.month12"),DF_final)

colnames(DF_final)[1]="Units: GT"

write.table(DF_final,"D:/Andrea/Desktop/NEW_BEMTool/GT_TEST.csv",sep=";",row.names=F)      

```

\textbf{iii average-kw.csv} 

```{r}
library(readxl)
# Script to create days files by month for BMT
(RECENTDATAKW<-read.csv("D:/Andrea/Desktop/NEW_BEMTool/FDI_capacity_by_country.csv", sep = ";"))

# here I select my fleet segments and the GSA or GSas I want to work with
# we maintain the GSA 9 as example

(GSA9_2_A_KW<-RECENTDATAKW%>% 
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & principal.sub.region=="GSA9"))

# I NEED TO GROUP the VL0006 WITH VL0612 AS VL0012
(GSA9_2_B1_KW<-RECENTDATAKW%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006","VL0612") & principal.sub.region=="GSA9")%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarise(Total.total.kW=sum(as.numeric(Total.total.kW))))
GSA9_2_B1_KW$Vessel.Length.Category<-"VL0012"

(GSA9_2_B2_KW<-RECENTDATAKW%>%
    select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
    filter(Country.name=="Italy" &  Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL1218") & principal.sub.region=="GSA9"))

GSA9_2_KW<-rbind(GSA9_2_A_KW,GSA9_2_B1_KW,GSA9_2_B2_KW)

GSA9_2_KW$Month<-0
GSA9_2_KW$Unit<-"vess"
GSA9_2_KW$Source<-"FDI_capacity_by_country"

head(GSA9_2_KW)
(GSA9_2_KW<-GSA9_2_KW[,c(5,4,3,2,7,6,8,9)])

(GSA9_2_KW<-GSA9_2_KW%>%arrange(year,Fishing.Technique,Vessel.Length.Category))

(GSA9_KW_2014_0612_DTS<-GSA9_2_KW%>%filter(Fishing.Technique=="DTS" & Vessel.Length.Category=="VL0612")) # 1  DF
(GSA9_KW_2014_0612_DTS$metier<-"DEF")
GSA9_KW_2014_0612_DTS$OTB<-"OTB"

(GSA9_KW_2014_1240_DTS<-GSA9_2_KW%>%filter(Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL1218","VL1824","VL2440"))) # 2 DF
GSA9_KW_2014_1240_DTS$OTB<-"OTB"


(GSA9_KW_2014_0018_PGP<-GSA9_2_KW%>%filter(Fishing.Technique=="PGP")) # 3 DF


# new DF 2 
(NEWNEWDFKW<-rbind((GSA9_KW_2014_1240_DTS[rep(1,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(2,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(3,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(4,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(5,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(6,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(7,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(8,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(9,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(10,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(11,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(12,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(13,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(14,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(15,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(16,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(17,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(18,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(19,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(20,3),]),
                   (GSA9_KW_2014_1240_DTS[rep(21,3),]) ))
                   
 NEWNEWDFKW$OTB<-"OTB" 
 NEWNEWDFKW$metier<- rep(c("DEF","DWS","MDD"),21)
 
(GSA9_KW_2014_0612_DTS<-GSA9_KW_2014_0612_DTS[,c(1,2,3,10,9,4,5,6,7,8)] %>%unite("FS",c(principal.sub.region:metier), remove = T))
(NEWNEWDFKW<-NEWNEWDFKW[,c(1,2,3,9,10,4,5,6,7,8)]%>%unite("FS",c(principal.sub.region:metier), remove = T))
(GSA9_KW_2014_0018_PGP<-GSA9_KW_2014_0018_PGP%>%unite("FS",c(principal.sub.region:Vessel.Length.Category), remove = T))
(GSA9_KW<-rbind(GSA9_KW_2014_0612_DTS,NEWNEWDFKW,GSA9_KW_2014_0018_PGP)) # 1 + new DF 2 + 3
(GSA9_KW<-GSA9_KW%>%arrange(year,FS)) ### RECENT READY NOW I NEED JUST THE OLD ONE 
#################################################################################################################################################
 ###  2 #####################

# now take all the gsa of the 2014 and calculate the % of you GSA respect to the total for each fleet segment
(ALLGSAOTB<-RECENTDATAKW%>%
   select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
   filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="DTS" & Vessel.Length.Category%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11")))
(ALLGSAOTB$BIGTOTAL<-sum(as.numeric(ALLGSAOTB$Total.total.kW)))
ALLGSAOTB$PERC<-as.numeric(ALLGSAOTB$Total.total.kW)/as.numeric(ALLGSAOTB$BIGTOTAL)
(ALLGSAOTB<-ALLGSAOTB%>%filter(principal.sub.region=="GSA9"))


# Two lines below if you need different Fishing technique like PGP_ 
(ALLGSAPGP_A<-RECENTDATAKW%>%select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
    filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006" ,"VL0612") & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11"))%>%
    group_by(Country.name,year,Fishing.Technique,principal.sub.region)%>%
    summarize(Total.total.kW=sum(as.numeric(Total.total.kW))))
ALLGSAPGP_A$Vessel.Length.Category<-"VL0012"
(ALLGSAPGP_A$BIGTOTAL<-sum(ALLGSAPGP_A$Total.total.kW))
ALLGSAPGP_A$PERC<-as.numeric(ALLGSAPGP_A$Total.total.kW)/as.numeric(ALLGSAPGP_A$BIGTOTAL)
(ALLGSAPGP_A<-ALLGSAPGP_A%>%filter(principal.sub.region=="GSA9"))

(ALLGSAPGP_B<-RECENTDATAKW%>%select(Country.name,year,Vessel.Length.Category,Fishing.Technique,principal.sub.region,Total.total.kW)%>%
    filter(Country.name=="Italy" & year=="2014" & Fishing.Technique=="PGP" & Vessel.Length.Category=="VL1218" & principal.sub.region%in%c("GSA9","GSA17","GSA18","GSA19","GSA16","GSA10","GSA11")))
(ALLGSAPGP_B$BIGTOTAL<-sum(as.numeric(ALLGSAPGP_B$Total.total.kW)))
ALLGSAPGP_B$PERC<-as.numeric(ALLGSAPGP_B$Total.total.kW)/as.numeric(ALLGSAPGP_B$BIGTOTAL)
(ALLGSAPGP_B<-ALLGSAPGP_B%>%filter(principal.sub.region=="GSA9"))
(ALLGSAPGP<-rbind(ALLGSAOTB,ALLGSAPGP_A,ALLGSAPGP_B))
(ALLGSAPGP<-ALLGSAPGP%>%arrange(year,Fishing.Technique,Vessel.Length.Category))  # HERE are the percentage I need to apply to the OLD data set where the GSA level is absent

################  step 2 ########
# here the extraction of data from 2008 to 2013
library(readxl)
dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx"

(OLD_DATA_KW<-read_xlsx(dir, sheet = 2))
unique(OLD_DATA_KW$variable_code)

# all the GSA. Please check if there are some missing years or fleets segments 
(OLD_DATA_KW_DTS<-OLD_DATA_KW%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totkw" & fishing_tech=="DTS" & supra_reg =="AREA37" & vessel_length%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") ))

(OLD_DATA_KW_PGP_1<-OLD_DATA_KW%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totkw" & fishing_tech=="PGP" & supra_reg =="AREA37" & vessel_length%in%c("VL0006" ,"VL0612"))%>%
    group_by(country_code,year,fishing_tech,variable_code,supra_reg)%>%
    summarise(value=sum(as.numeric(value))))
(OLD_DATA_KW_PGP_1$vessel_length<-"VL0012")

(OLD_DATA_KW_PGP_2<-OLD_DATA_KW%>%
    select(country_code,year,fishing_tech,vessel_length,variable_code,value,supra_reg)%>%
    filter(country_code=="ITA", variable_code=="totkw" & fishing_tech=="PGP" & supra_reg =="AREA37" & vessel_length=="VL1218"))

(OLD_DATA_KW<-rbind(OLD_DATA_KW_DTS,OLD_DATA_KW_PGP_1,OLD_DATA_KW_PGP_2))
(OLD_DATA_KW<-OLD_DATA_KW%>%arrange(year,fishing_tech,vessel_length))
(OLD_DATA_KW$PERC<-rep(ALLGSAPGP$PERC,9))
(OLD_DATA_KW$KW<-OLD_DATA_KW$value*OLD_DATA_KW$PERC) # THIS is almost ready I need to add the copied 2006 and 2007 form 2008 and duplicate the DTS of all time series for the 3 metiers DEF DWS MDD 

# merge "VL1012" with "VL0612"

(OLD_DATA_KW2<-OLD_DATA_KW%>%filter(year%in%c("2008","2009","2010","2011","2012","2013")))
#check if something is missing

(OLD_DATA_KW2<-OLD_DATA_KW2%>%arrange(year,vessel_length))
(OLD_DATA_KW3<-OLD_DATA_KW2[,c(2,3,4,5,9)])
# in this case in 2008 the data of VL2440 is missing we add the same amount of 2009 

# now you need to create the absent 2006 and 2007 data equal to 2008 
(OLD_DATA_KW3_2006<-OLD_DATA_KW3%>%filter(year=="2008"))
(OLD_DATA_KW3_2006[,1]<-c(rep("2006",6)))

(OLD_DATA_KW3_2007<-OLD_DATA_KW3%>%filter(year=="2008"))
(OLD_DATA_KW3_2007[,1]<-c(rep("2007",6)))
# merge all the old data set 

(OLD_DATA_KW4<-rbind(OLD_DATA_KW3_2006,OLD_DATA_KW3_2007,OLD_DATA_KW3))
(OLD_DATA_KW4<-OLD_DATA_KW4%>%arrange(year,fishing_tech,vessel_length))

# For some fleet segments ("VL1218", "VL1824", "VL2440") you need to duplicate vessels for the three metiers DEF, DWS and MDD

(OLD_DATA_KW4DUP_DTS<-OLD_DATA_KW4%>%filter(fishing_tech=="DTS" & vessel_length!="VL0612"))
(OLD_DATA_KW4NODU_DTS<-OLD_DATA_KW4%>%filter(fishing_tech=="DTS" &vessel_length=="VL0612"))
(OLD_DATA_KW4NODU_PGP<-OLD_DATA_KW4%>%filter(fishing_tech=="PGP" & vessel_length%in%c("VL0012","VL1218")))
(OLD_DATA_KW4DUP_DEFKW<-OLD_DATA_KW4DUP_DWSKW<-OLD_DATA_KW4DUP_MDDKW<-OLD_DATA_KW4DUP_DTS)
(OLD_DATA_KW4DUP_DEFKW$Metier<-"DEF")
(OLD_DATA_KW4DUP_DWSKW$Metier<-"DWS")
(OLD_DATA_KW4DUP_MDDKW$Metier<-"MDD")
(OLD_DATADUPLICATEDKW<-rbind(OLD_DATA_KW4DUP_DEFKW,OLD_DATA_KW4DUP_DWSKW,OLD_DATA_KW4DUP_MDDKW)) # I duplicate the line of the three vessels length for the three metiers
OLD_DATA_KW4NODU_DTS$Metier<-"DEF"
(OLD_DATA_KW4NODU_DTS$gear<-"OTB")
(OLD_DATA_KW4NODU_DTS$GSA<-"GSA9")
(OLD_DATA_KW4NODU_DTS$Month<-0)
(OLD_DATA_KW4NODU_DTS$Unit<-"TotalKW")
(OLD_DATA_KW4NODU_DTS$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATADUPLICATEDKW$gear<-"OTB")
(OLD_DATADUPLICATEDKW$GSA<-"GSA9")
(OLD_DATADUPLICATEDKW$Month<-0)
(OLD_DATADUPLICATEDKW$Unit<-"TotalKW")
(OLD_DATADUPLICATEDKW$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATA_KW4NODU_PGP$GSA<-"GSA9")
(OLD_DATA_KW4NODU_PGP$Month<-0)
(OLD_DATA_KW4NODU_PGP$Unit<-"TotalKW")
(OLD_DATA_KW4NODU_PGP$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx")

(OLD_DATA_KW4NODU_DTS<-OLD_DATA_KW4NODU_DTS[,c(8,2,3,7,6,1,9,5,10,11)]%>%unite("FS",c(GSA:Metier), remove = T))
(OLD_DATADUPLICATEDKW<-OLD_DATADUPLICATEDKW[,c(8,2,3,7,6,1,9,5,10,11)]%>%unite("FS",c(GSA:Metier), remove = T))
(OLD_DATA_KW4NODU_PGP<-OLD_DATA_KW4NODU_PGP[,c(6,2,3,1,7,5,8,9)]%>%unite("FS",c(GSA:vessel_length), remove = T))

(FINALKWX<-rbind(OLD_DATA_KW4NODU_DTS,OLD_DATADUPLICATEDKW,OLD_DATA_KW4NODU_PGP))
colnames(FINALKWX)[2]<-"Year"
(FINALKWX<-FINALKWX%>%arrange(Year,FS))

# RECENT + OLD 
colnames(GSA9_KW)[2]<-"Year"
colnames(GSA9_KW)[4]<-"KW"

(BIGDFKW<-rbind(FINALKWX,GSA9_KW))

(BIGDFKW$Year<-as.numeric(BIGDFKW$Year))
(BIGDFKW$KW<-as.numeric(BIGDFKW$KW))
(BIGDFKW$KW<-round(BIGDFKW$KW))
BIGDFKW$FS<-as.character(BIGDFKW$FS)

#check the size and rows of the two data base 

#check the size and rows of the two data base 

(BIGDFKW<-BIGDFKW%>%filter(!FS%in%c("GSA9_DTS_VL0612_OTB_MDD","GSA9_DTS_VL0612_OTB_DWS","GSA9_DTS_VL2440_OTB_DWS"))) 

Fleet_segments<-unique(BIGDFKW$FS)

#dir.create("BMT_INPUT")

ts<-c(2006:2021)

trans_year=c(2021)

#KW
(KW_data=BIGDFKW)

#library(tidyverse)
#pollo<-Days_data%>%group_by(FS)%>%summarise(Days =sum(Days      ))
#pollo$FS

(KW_data=KW_data[KW_data$Year %in% ts & KW_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

# Fleet_segments[1]
(KW_data_temp=KW_data[KW_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(KW_data_temp)){
  
 year=KW_data_temp$Year[rr] 
 month=KW_data_temp$Month[rr]
 #unit=KW_data_temp$Unit[rr]
 
 if (month!=0){
 DF1[rownames(DF1)==month,colnames(DF1)==year]=KW_data_temp$KW[rr]
 } else if (month==0){
     DF1[,colnames(DF1)==year]=KW_data_temp$KW[rr]
   }  
   
 }
 
(DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)])

for (fs in Fleet_segments[-1]){

print(fs,quote=F)
DF_next=matrix(0,nrow=12,ncol=length(ts))
colnames(DF_next)=ts
rownames(DF_next)=seq(1,12,1)

# Fleet_segments[1]
KW_data_temp=KW_data[KW_data$FS==fs,]

for (rr in 1:nrow(KW_data_temp)){
  
  year=KW_data_temp$Year[rr] 
  month=KW_data_temp$Month[rr]
  unit=KW_data_temp$Unit[rr]
  
  if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=KW_data_temp$KW[rr]  
    
  } else if (month==0){
    
        DF_next[,colnames(DF_next)==year]=KW_data_temp$KW[rr]  
    }  
    
}

DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]

DF1=cbind(DF1,DF_next)

} # ciclo FS

KW=DF1

#VESSELS
(Vess_data=FINALDF) # FROM VESSEL SCRIPT 

(Vess_data=Vess_data[Vess_data$Year %in% ts & Vess_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

# Fleet_segments[1]
(Vess_data_temp=Vess_data[Vess_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Vess_data_temp)){
  
  year=Vess_data_temp$Year[rr] 
  month=Vess_data_temp$Month[rr]
  #unit=Vess_data_temp$Unit[rr]
  
  if (month!=0){
    DF1[rownames(DF1)==month,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  } else if (month==0){
    DF1[,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  }  
  
}



(DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)])

for (fs in Fleet_segments[-1]){
  
  print(fs,quote=F)
  DF_next=matrix(0,nrow=12,ncol=length(ts))
  colnames(DF_next)=ts
  rownames(DF_next)=seq(1,12,1)
  
  # Fleet_segments[1]
  Vess_data_temp=Vess_data[Vess_data$FS==fs,]
  
  for (rr in 1:nrow(Vess_data_temp)){
    
    year=Vess_data_temp$Year[rr] 
    month=Vess_data_temp$Month[rr]
    unit=Vess_data_temp$Unit[rr]
    
    if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
      
    } else if (month==0){
      
      DF_next[,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
    }  
    
  }
  DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]
  
  DF1=cbind(DF1,DF_next)
  
} # ciclo FS

(Vess=DF1)

(Avg_KW=KW/Vess)

for (f in 1:length(Fleet_segments)){
ini=1+(f-1)*length(ts)
fin=(f)*length(ts)
if (length(Vess[,ini:fin][which(Vess[,ini:fin]==0)])>0){
Avg_KW[,ini:fin][Vess[,ini:fin]==0] = mean(Avg_KW[,ini:fin][Vess[,ini:fin]!=0],na.rm=T )  
}
}

# 
# for (f in 1:lenKWh(Fleet_segments)){
#   print(Fleet_segments[f])
#   ini=1 +(f-1)*lenKWh(ts)
#   fin=(f)*lenKWh(ts)
#   if (lenKWh(DF1[,ini:fin][which(DF1[,ini:fin]==0)])>0){
#     DF1[,ini:fin][which(DF1[,ini:fin]==0)] = mean(DF1[,ini:fin][which(DF1[,ini:fin]!=0)]) 
#   }
# }

#FirstRow=t(data.frame(rep(ts,lenKWh(Fleet_segments))))
#FirstRow=c("Units: kg",FirstRow)

(SecondRow=t(data.frame(rep(Fleet_segments[1],length(ts)))  ))

for (fs in Fleet_segments[-1]){
  print(fs)
  SecondRow2=t(data.frame(rep(fs,length(ts))))
  
  SecondRow=cbind(SecondRow,SecondRow2) 
 
}

empty_row=t(data.frame(rep("",length(SecondRow))))

(DF_final=(rbind(SecondRow,empty_row,empty_row)))

(DF_final=rbind(DF_final,as.matrix(Avg_KW)))

DF_final= cbind(c(
                       "casestudy.fleetsegmentcode",
                       "casestudy.fishinKWechnique",
                       "casestudy.loa",
                       "casestudy.month1",
                       "casestudy.month2",
                       "casestudy.month3",
                       "casestudy.month4",
                       "casestudy.month5",
                       "casestudy.month6",
                       "casestudy.month7",
                       "casestudy.month8",
                       "casestudy.month9",
                       "casestudy.month10",
                       "casestudy.month11",
                       "casestudy.month12"),DF_final)

colnames(DF_final)[1]="Units: KW"

write.table(DF_final,"D:/Andrea/Desktop/NEW_BEMTool/KW_TEST.csv", sep=";",row.names=F)    
```

\textbf{iv days-at-sea.csv} 

FDI_effort_by_country.csv for data from 2014 to 2020

2018-07_STECF_18-07-EU_Fleet_Effort_FAO_Gear_levels_final.xlsx for data from 2008 - 2013
```{r}
library(readxl)
library(tidyverse)
library(tidyr)

# Script to create days files by month for BMT
(RECENTDATADAY<-read.csv("D:/Andrea/Desktop/NEW_BEMTool/FDI_effort_by_country.csv", sep = ";"))

(GSA9_DAY_A<-RECENTDATADAY%>% 
    select(country_name,year,Vessel_Length,Fishing_Technique,Sub_region,Total_days_at_sea)%>%
    filter(country_name=="Italy" &  Fishing_Technique=="DTS" & Vessel_Length%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & Sub_region=="GSA9"))


# If you need to group length vessels follow below. I NEEDED TO GROUP PGP VL0006 WITH VL0612 AS VL0012
(GSA9_DAY_B1<-RECENTDATADAY%>%
    select(country_name,year,Vessel_Length,Fishing_Technique,Sub_region,Total_days_at_sea)%>%
    filter(country_name=="Italy" &  Fishing_Technique=="PGP" & Vessel_Length%in%c("VL0006","VL0612") & Sub_region=="GSA9")%>%
    group_by(country_name,year,Fishing_Technique,Sub_region)%>%
    summarise(Total_days_at_sea=sum(as.numeric(Total_days_at_sea))))
GSA9_DAY_B1$Vessel_Length<-"VL0012"

(GSA9_DAY_B2<-RECENTDATADAY%>%
    select(country_name,year,Vessel_Length,Fishing_Technique,Sub_region,Total_days_at_sea)%>%
    filter(country_name=="Italy" &  Fishing_Technique=="PGP" & Vessel_Length%in%c("VL1218") & Sub_region=="GSA9"))

GSA9_DAY<-rbind(GSA9_DAY_A,GSA9_DAY_B1,GSA9_DAY_B2)
GSA9_DAY$Month<-0
GSA9_DAY$Unit<-"Days"
GSA9_DAY$Source<-"FDI_capacity_by_country"
(GSA9_DAY<-GSA9_DAY[,c(5,4,3,2,7,6,8,9)])

(GSA9_DAY<-GSA9_DAY%>%
    arrange(year,Fishing_Technique,Vessel_Length)%>%
    group_by(Sub_region,Fishing_Technique,Vessel_Length,year,Month,Unit,Source)%>%
    summarise(Total_days_at_sea=sum(as.numeric(Total_days_at_sea))))

(GSA9_DAY<-GSA9_DAY%>%arrange(year,Fishing_Technique,Vessel_Length))


#RECENT
colnames(GSA9_DAY)[1]<-"GSA"
colnames(GSA9_DAY)[2]<-"fishing_tech"
colnames(GSA9_DAY)[3]<-"vessel_length"
colnames(GSA9_DAY)[8]<-"value"
colnames(GSA9_DAY)[6]<-"unit"

########################## 2 ###############
# here the extraction of data from 2008 to 2013

dir<-"D:/Andrea/Desktop/NEW_BEMTool/2018-07_STECF_18-07-EU_Fleet_Effort_FAO_Gear_levels_final.xlsx"

(OLD_DATA_DAYS<-read_xlsx(dir, sheet = 2))
unique(OLD_DATA_DAYS$variable_code)
# all the GSA 

(OLD_DATA_DAYS_DTS<-OLD_DATA_DAYS%>%
    select(country_code,year,fishing_tech,variable_code,sub_reg,vessel_length,value,unit)%>%
    filter(country_code=="ITA", variable_code=="totseadays" & fishing_tech=="DTS"  & vessel_length%in%c("VL0612" ,"VL1218", "VL1824", "VL2440") & sub_reg=="sa 9"))

(OLD_DATA_DAYS_PGP_1<-OLD_DATA_DAYS%>%
    select(country_code,year,fishing_tech,variable_code,sub_reg,vessel_length,value,unit)%>%
    filter(country_code=="ITA", variable_code=="totseadays" & fishing_tech=="PGP" & vessel_length%in%c("VL0006","VL0612") & sub_reg=="sa 9")%>%
    group_by(country_code,year,fishing_tech,variable_code,sub_reg,unit)%>%
    summarise(value=sum(as.numeric(value))))
OLD_DATA_DAYS_PGP_1$vessel_length<-"VL0012"

(OLD_DATA_DAYS_PGP_2<-OLD_DATA_DAYS%>%
    select(country_code,year,fishing_tech,variable_code,sub_reg,vessel_length,value,unit)%>%
    filter(country_code=="ITA", variable_code=="totseadays" & fishing_tech=="PGP" & vessel_length=="VL1218" & sub_reg=="sa 9"))

(OLD_DATA_DAYS<-rbind(OLD_DATA_DAYS_DTS,OLD_DATA_DAYS_PGP_1,OLD_DATA_DAYS_PGP_2))
(OLD_DATA_DAYS<-OLD_DATA_DAYS%>%arrange(year,fishing_tech,vessel_length))
OLD_DATA_DAYX<-OLD_DATA_DAYS[9,]
OLD_DATA_DAYX$year[OLD_DATA_DAYX$year=="2009"]<-"2008"
(OLD_DATA_DAYS<-rbind(OLD_DATA_DAYX,OLD_DATA_DAYS))
(OLD_DATA_DAYS<-OLD_DATA_DAYS%>%arrange(year,fishing_tech,vessel_length))

#this is the old data i need

(OLD_DATA_3<-OLD_DATA_DAYS%>%filter(year%in%c("2008","2009","2010","2011","2012","2013")))
#check if something is missing

(OLD_DATA_3<-OLD_DATA_3%>%arrange(year,fishing_tech,vessel_length))

# now you need to create the absent 2006 and 2007 data equal to 2008 
(OLD_DATA_2006<-OLD_DATA_3%>%filter(year=="2008"))
(OLD_DATA_2006[,2]<-c(rep("2006",6)))

(OLD_DATA_2007<-OLD_DATA_3%>%filter(year=="2008"))
(OLD_DATA_2007[,2]<-c(rep("2007",6)))
# merge all the old data set 
(OLD_DATA_4<-rbind(OLD_DATA_2006,OLD_DATA_2007,OLD_DATA_3))


OLD_DATA_4$Source<-"STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment"
OLD_DATA_4$GSA<-"GSA9"
OLD_DATA_4$Month<-0 
OLD_DATA_4$unit<-"Days"


(OLD_DATA_4<-OLD_DATA_4[,c(10,3,6,2,11,7,8,9)])

(BIGDF<-rbind(OLD_DATA_4,GSA9_DAY))
(BIGDF<-BIGDF%>%arrange(year,fishing_tech,vessel_length))


(BIGDFDUP<-BIGDF%>%filter(vessel_length!="VL0612" & fishing_tech!="PGP")) #segment to be duplicated

(BIGDFNODUP_DTS<-BIGDF%>%filter(vessel_length=="VL0612" & fishing_tech=="DTS"))#segment ok

(BIGDFNODUP_PGP<-BIGDF%>%filter(fishing_tech=="PGP" & vessel_length%in%c("VL0012","VL1218")))

(BIGDFDUP_DEF<-BIGDFDUP_DWS<-BIGDFDUP_MDD<-BIGDFDUP)
(BIGDFDUP_DEF$Metier<-"DEF")
(BIGDFDUP_DWS$Metier<-"DWS")
(BIGDFDUP_MDD$Metier<-"MDD")

(BIGDFDUPLICATED<-rbind(BIGDFDUP_DEF,BIGDFDUP_DWS,BIGDFDUP_MDD)) # I duplicate the line of the three vessels lenght for the three metiers
BIGDFNODUP_DTS$Metier<-"DEF"
BIGDFNODUP_DTS$gear<-"OTB"
(BIGDFDUPLICATED$gear<-"OTB")
(BIGDFNODUP_DTS<-BIGDFNODUP_DTS[,c(1,2,3,10,9,4,5,6,7,8)])
(BIGDFDUPLICATED<-BIGDFDUPLICATED[,c(1,2,3,10,9,4,5,6,7,8)])

(BIGDFNODUP_DTS<-BIGDFNODUP_DTS%>%unite("FS",c(GSA:Metier), remove = T))
(BIGDFDUPLICATED<-BIGDFDUPLICATED%>%unite("FS",c(GSA:Metier), remove = T))
(BIGDFNODUP_PGP<-BIGDFNODUP_PGP%>%unite("FS",c(GSA:vessel_length), remove = T))

(FINALDFDAY<-rbind(BIGDFNODUP_DTS,BIGDFDUPLICATED,BIGDFNODUP_PGP))
(FINALDFDAY<-FINALDFDAY%>%arrange(year,FS))

colnames(FINALDFDAY)[2]<-"Year"
colnames(FINALDFDAY)[4]<-"Days"
colnames(FINALDFDAY)[5]<-"Unit"
(FINALDFDAY$Days<-round(as.numeric(FINALDFDAY$Days)))

FINALDFDAY

# For some fleet segments ("VL1218", "VL1824", "VL2440") you need to duplicate vessels for the three metiers DEF, DWS and MDD

(FINALDFDAY<-FINALDFDAY%>%filter(!FS%in%c("GSA9_DTS_VL0612_OTB_MDD","GSA9_DTS_VL0612_OTB_DWS","GSA9_DTS_VL2440_OTB_DWS")))

write.table(FINALDFDAY,"D:/Andrea/Desktop/NEW_BEMTool/FINALDFDAY.csv",sep=";",row.names=F)      

Fleet_segments<-unique(FINALDFDAY$FS) 

ts<-c(2006:2021)

trans_year=c(2021)

#Days
#(Days_data=read.table("C:/Users/andre/OneDrive/Desktop/COISPA/BEMTOOL/MUT17/input formats/days17_18.csv",sep=";", header=T))

#library(tidyverse)
Days_data<-FINALDFDAY

#(Days_data=Days_data[Days_data$Year %in% ts & Days_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

(Days_data_temp=Days_data[Days_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Days_data_temp)){
  
 year=Days_data_temp$Year[rr] 
 month=Days_data_temp$Month[rr]
 #unit=Days_data_temp$Unit[rr]
 
 if (month!=0){
 DF1[rownames(DF1)==month,colnames(DF1)==year]=Days_data_temp$Days[rr]
 } else if (month==0){
     DF1[,colnames(DF1)==year]=Days_data_temp$Days[rr]/12
   }  
   
 }
 
(DF1[,colnames(DF1) %in% trans_year]=DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)])

for (fs in Fleet_segments[-1]){

print(fs,quote=F)
DF_next=matrix(0,nrow=12,ncol=length(ts))
colnames(DF_next)=ts
rownames(DF_next)=seq(1,12,1)

# Fleet_segments[1]
Days_data_temp=Days_data[Days_data$FS==fs,]

for (rr in 1:nrow(Days_data_temp)){
  
  year=Days_data_temp$Year[rr] 
  month=Days_data_temp$Month[rr]
  unit=Days_data_temp$Unit[rr]
  
  if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Days_data_temp$Days[rr]  
    
  } else if (month==0){
    
        DF_next[,colnames(DF_next)==year]=Days_data_temp$Days[rr]/12  
    }  
    
}

(DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)])

DF1=cbind(DF1,DF_next)

} # ciclo FS

Days=DF1

#VESSELS

(Vess_data=FINALDF)

(Vess_data=Vess_data[Vess_data$Year %in% ts & Vess_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

 #Fleet_segments[1]
(Vess_data_temp=Vess_data[Vess_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Vess_data_temp)){
  
  year=Vess_data_temp$Year[rr] 
  month=Vess_data_temp$Month[rr]
  #unit=Vess_data_temp$Unit[rr]
  
  if (month!=0){
    DF1[rownames(DF1)==month,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  } else if (month==0){
    DF1[,colnames(DF1)==year]=Vess_data_temp$Vess[rr]
  }  
  
}

(DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)])

for (fs in Fleet_segments[-1]){
  
  print(fs,quote=F)
  DF_next=matrix(0,nrow=12,ncol=length(ts))
  colnames(DF_next)=ts
  rownames(DF_next)=seq(1,12,1)
  
  # Fleet_segments[1]
  Vess_data_temp=Vess_data[Vess_data$FS==fs,]
  
  for (rr in 1:nrow(Vess_data_temp)){
    
    year=Vess_data_temp$Year[rr] 
    month=Vess_data_temp$Month[rr]
    unit=Vess_data_temp$Unit[rr]
    
    if (month!=0){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
      
    } else if (month==0){
      
      DF_next[,colnames(DF_next)==year]=Vess_data_temp$Vess[rr]  
    }  
    
  }
  DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]
  
  DF1=cbind(DF1,DF_next)
  
} # ciclo FS

(Vess=DF1)

for (f in 1:length(Fleet_segments)){
  ini=1+(f-1)*length(ts)
  fin=(f)*length(ts)
  Vess[which(Days==0)][ini:fin] = mean(Vess[,ini:fin],na.rm=T )  
}

(Avg_days=round(Days/Vess))

#FirstRow=t(data.frame(rep(ts,length(Fleet_segments))))
#FirstRow=c("Units: kg",FirstRow)

(SecondRow=t(data.frame(rep(Fleet_segments[1],length(ts)))  ))

for (fs in Fleet_segments[-1]){
  print(fs)
  SecondRow2=t(data.frame(rep(fs,length(ts))))
  
  SecondRow=cbind(SecondRow,SecondRow2) 
 
}

(empty_row=t(data.frame(rep("",length(SecondRow)))))

(DF_final=(rbind(SecondRow,empty_row,empty_row)))

(DF_final=rbind(DF_final,as.matrix(Avg_days)))

DF_final= cbind(c(     "casestudy.fleetsegmentcode",
                       "casestudy.fishingtechnique",
                       "casestudy.loa",
                       "casestudy.month1",
                       "casestudy.month2",
                       "casestudy.month3",
                       "casestudy.month4",
                       "casestudy.month5",
                       "casestudy.month6",
                       "casestudy.month7",
                       "casestudy.month8",
                       "casestudy.month9",
                       "casestudy.month10",
                       "casestudy.month11",
                       "casestudy.month12"
                        ),DF_final)

colnames(DF_final)[1]="Units: days"
write.table(DF_final,"D:/Andrea/Desktop/NEW_BEMTool/TEST_DAYS.csv",sep=";",row.names=F)      

```

\textbf{(c) LANDINGS} 

```{r}
library(tidyverse)
library(readxl)
library(tidyr)
# below we present how to prepare the data frame of landing. Below this first preparation it is explain hot ot built a landings csv file by each single species. 
#LANDINGS
(Landing=read.table("D:/Andrea/Desktop/FISH Stock Assessment/STECF 2022/EFFORT REGIME/FEB/BEMTOOL_EWG_21_13_AND/landings_preparation/LND_GSA9_10_11_2004_2020.csv",sep=";", header=T))
(colnames(Landing)[1] <- "Year")
(colnames(Landing)[4] <- "FS")

# 
trans_year=c(2021)
ts<-(2006:2021)

(Landing_A<-separate(Landing, col=FS, into=c("A","B","C","D","F"), sep="_"))
(Landing_A<-Landing_A%>%
  filter(A %in% c("OTB", "LLS", "GNS" , "GTR" , "LLD" )))

(Landing_A<-Landing_A[ ,c(1,2,3,4,5,9,10,11)])
(Landing_A$GSAX<-"GSA")
(Landing_A<-Landing_A[ ,c(1,2,9,3,4,5,6,7,8)])

#  OTB 
(Landing_1<-Landing_A%>%filter(A=="OTB"))
(Landing_1$DTS<-"DTS")
(Landing_1<-Landing_1%>%
    unite("FS",GSAX:GSA, remove = T,sep = ""))
(Landing_1<-Landing_1[,c(1,2,3,9,4,5,6,7,8)])
(Landing_1<-Landing_1%>%filter(Year%in%c(2006:2020)))
(Landing_1["B"][Landing_1["B"] == "DES"] <- "DEF")
(Landing_1<-Landing_1[,c(3,4,7,5,6,1,2,8,9)])

(Landing_1<-Landing_1%>%
    unite("FS",FS:B, remove = T))

# we do not include some LOAs and we decided to remove these. 
# it is up to you. 
(Landing_1<-Landing_1%>%
    filter(!FS%in%c("GSA9_DTS_VL0612_OTB_DWS",
                    "GSA10_DTS_VL0612_OTB_MDD", 
                    "GSA9_DTS_VL0612_OTB_MDD", 
                    "GSA11_DTS_VL0612_OTB_MDD",
                    "GSA10_DTS_VL0612_OTB_DWS",
                    "GSA10_DTS_VL40XX_OTB_MDD",
                    "GSA10_DTS_VL40XX_OTB_DEF",
                    "GSA9_DTS_VL2440_OTB_DWS",
                    "GSA10_DTS_VL2440_OTB_DWS",
                    "GSA11_DTS_VL2440_OTB_DWS")))
unique(Landing_1$FS)

# PGP 
(Landing_2<-Landing_A%>%filter(A %in% c("LLS", "GNS" , "GTR" , "LLD" )))
(Landing_2$X<-"PGP")
(Landing_2<-Landing_2[,c(3,4,10,7,1,2,8,9)])
(Landing_2<-Landing_2%>%
    unite("FS",GSAX:GSA, remove = T,sep = ""))

(Landing_2<-Landing_2%>%filter(Year%in%c(2006:2020)))

# clean PGP you do not need or marge them 
# for GSA 9 marge "VL0006","VL0612" to  VL0012
(Landing_3<-Landing_2%>%
   filter(VESSEL_length %in% c("VL0006","VL0612"))%>%
   group_by( FS, X, Year, MESE , SPECIES)%>%
   summarise(WEIGHT=sum(WEIGHT)))

(Landing_3$VESSEL_length<-"VL0012")
(Landing_3<-Landing_3[,c(1,2,7,3,4,5,6)])

(Landing_4<-Landing_2%>%
  filter(VESSEL_length %in% c("VL1218")))
(Landing_34<-rbind(Landing_3,Landing_4)) # the two DF PGP
(Landing_34<-Landing_34%>%unite("FS",FS:VESSEL_length, remove = T))

# ALL DF 

(Landing_all<-rbind(Landing_1,Landing_34))

#########################################################################
######   FULL DF WITH ALL SEGMENTS 

Fleet_segments <-c(sort(unique(Landing_all$FS)))

(time<-c(2006:2020))
(Fleet_seg1 <-c(sort(unique(Landing_all$FS)))) # 33 are the number of basic segments 
(Fleet_seg2 <-rep(Fleet_seg1, each=12)) # 12 are the months
 # the three GSAs 10, 11, 9 
(Fleet_segments <-rep(Fleet_seg2, length(time)))
(YEAR<-rep(c(2006:2020), each=(length(Fleet_seg2))))
(MESE<-rep(c(1:12),length(YEAR)/12)) 
(NULLDF<-data.frame(YEAR,MESE,Fleet_segments))
(NULLDF$SPECIES<-0)
(NULLDF$WEIGHT<-0.0001)

```


\textbf{i. landings-Species-1.csv (HKE)}

```{r}
(HKE<-Landing_all%>%
    filter(SPECIES=="HKE")%>%
   group_by(Year,MESE, FS, SPECIES)%>%
   summarise(WEIGHT=sum(WEIGHT)))


(HKE_2<-HKE%>%
    unite("FS",Year:FS, remove = T))

(NULLDF_2<-NULLDF%>%
    unite("FS",YEAR:Fleet_segments, remove = T))

(PLUTO<-merge(NULLDF_2,HKE_2, by.x = "FS", by.y = "FS", all.x = T , all.y =  F ))


(PLUTO<-PLUTO[,c(1,5)])
(PLUTO[is.na(PLUTO)] = 0.00001)

(PLUTO<-separate(PLUTO, col=FS, into=c("A","B","C","D","FF","G","H"), sep="_"))

(PLUTODTS<-PLUTO%>%filter(D=="DTS"))
(PLUTODTS<-PLUTODTS[,c(3,4,5,6,7,1,2,8)]%>%unite("FS",C:H, remove = T))

(PLUTOPGP<-PLUTO%>%filter(D=="PGP"))
(PLUTOPGP<-PLUTOPGP[,c(3,4,5,1,2,8)]%>%unite("FS",C:FF, remove = T))

(PLUTOALL<-rbind(PLUTODTS,PLUTOPGP))

```


```{r}
colnames(PLUTOALL)[2]<-"Year"
colnames(PLUTOALL)[3]<-"Month"
colnames(PLUTOALL)[4]<-"Land"
PLUTOALL$Unit<-"kg"
PLUTOALL$Source<-"DCF"

```


```{r}
Landing_data<-PLUTOALL
(Fleet_segments<-unique(Landing_data$FS))
# write.csv(PLUTO,"C:/Users/andre/OneDrive/Desktop/Landing_data.csv", row.names = F)

# (Landing_data=read.csv("C:/Users/andre/OneDrive/Desktop/Landing_data_hke.csv",sep=",", header=T))

#Landing_data[which(!unique(Landing_data$FS)%in%unique(Fleet_segments)),]

unique(Landing_data$Year)
unique(Landing_data$Month)
unique(Landing_data$FS)


#(Landing_data=Landing_data[Landing_data$Year %in% ts & Landing_data$FS %in% Fleet_segments,])

(DF1=matrix(0,nrow=12,ncol=length(ts)))
(colnames(DF1)=ts)
(rownames(DF1)=seq(1,12,1))

# Fleet_segments[1]
(Landing_data_temp=Landing_data[Landing_data$FS==Fleet_segments[1],])

for (rr in 1:nrow(Landing_data_temp)){
  
( year=Landing_data_temp$Year[rr] )
 (month=Landing_data_temp$Month[rr])
 (unit=Landing_data_temp$Unit[rr])
 
 if (month!=0){
 if (unit=="tons"){
( DF1[rownames(DF1)==month,colnames(DF1)==year]=Landing_data_temp$Land[rr])
 } else if (unit=="kg"){
  ( DF1[rownames(DF1)==month,colnames(DF1)==year]=Landing_data_temp$Land[rr]  )
 }
  
 } else if (month==0){
   
   if (unit=="tons"){
     (DF1[,colnames(DF1)==year]=Landing_data_temp$Land[rr])
   } else if (unit=="kg"){
     DF1[,colnames(DF1)==year]=Landing_data_temp$Land[rr] 
   }  
   
 }
 
}

DF1[,colnames(DF1) %in% trans_year]= DF1[,as.numeric(colnames(DF1)) == (trans_year[1]-1)]

for (fs in Fleet_segments[-1]){

print(fs,quote=F)
DF_next=matrix(0,nrow=12,ncol=length(ts))
colnames(DF_next)=ts
rownames(DF_next)=seq(1,12,1)

# Fleet_segments[1]
Landing_data_temp=Landing_data[Landing_data$FS==fs,]

for (rr in 1:nrow(Landing_data_temp)){
  
  year=Landing_data_temp$Year[rr] 
  month=Landing_data_temp$Month[rr]
  unit=Landing_data_temp$Unit[rr]
  
  if (month!=0){
    if (unit=="tons"){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Landing_data_temp$Land[rr]
    } else if (unit=="kg"){
      DF_next[rownames(DF_next)==month,colnames(DF_next)==year]=Landing_data_temp$Land[rr]  
    }
    
  } else if (month==0){
    
    if (unit=="tons"){
      DF_next[,colnames(DF_next)==year]=Landing_data_temp$Land[rr]
    } else if (unit=="kg"){
      DF_next[,colnames(DF_next)==year]=Landing_data_temp$Land[rr]  
    }  
    
  }
  
}
DF_next[,colnames(DF_next) %in% trans_year]= DF_next[,as.numeric(colnames(DF_next)) == (trans_year[1]-1)]

DF1=cbind(DF1,DF_next)

} # ciclo FS


#FirstRow=t(data.frame(rep(ts,length(Fleet_segments))))
#FirstRow=c("Units: kg",FirstRow)

SecondRow=t(data.frame(rep(Fleet_segments[1],length(ts)))  )

for (fs in Fleet_segments[-1]){
  print(fs)
  SecondRow2=t(data.frame(rep(fs,length(ts))))
  
  SecondRow=cbind(SecondRow,SecondRow2) 
 
}

empty_row=t(data.frame(rep("",length(SecondRow))))

DF_final=(rbind(SecondRow,empty_row,empty_row))

DF_final=rbind(DF_final,as.matrix(DF1))

DF_final= cbind(c(     "casestudy.fleetsegmentcode",
                       "casestudy.fishingtechnique",
                       "casestudy.loa",
                       "casestudy.month1",
                       "casestudy.month2",
                       "casestudy.month3",
                       "casestudy.month4",
                       "casestudy.month5",
                       "casestudy.month6",
                       "casestudy.month7",
                       "casestudy.month8",
                       "casestudy.month9",
                       "casestudy.month10",
                       "casestudy.month11",
                       "casestudy.month12"),DF_final)

colnames(DF_final)[1]="Units: kg"

write.table(DF_final, "D:/Andrea/Desktop/NEW_BEMTool/Landing_data_HKE_TEST.csv",  sep=";", row.names = F)

```

\textbf{ii.landings-Species-2.csv (MUT9)}

```{r}

# as above
```

\textbf{iii. landings-Species-3.csv (MUT10)}

```{r}

# as above
```

\textbf{iv. landings-Species-4.csv (DPS9_10_11)}

```{r}
# as above
```

\textbf{v. landings-Species-5.csv (ARS9_10_11)}
```{r}
# as above
```

\textbf{vi. landings-Species-6.csv (NEP 9_10_11)}

```{r}
# as above

```

\textbf{vii. landings-Species-7.csv (ARA9_10_11)}


```{r}
# as above

```

\textbf{(d) SCENARIOS} 

\textbf{SCENARIO-1}

\textbf{grid-Eq-sim-Species-1.csv}
There is a script that should be updated by ISA

\textbf{monthly-data-sea-days.csv}
There is a script that should be updated by ISA

\textbf{Economic-Time-Series.csv}

There is an new R script ready that should just be checked and added here.

```{r}
library(tidyverse)
library(data.table)
library(readxl)

dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx" #this for data from 2008 to 2013 

(dataXX<-read_xlsx(dir, sheet = 2)) # Maxseadays follows National rools and are equal in all GSAs. So we do not need to have this data at a GSA level of detail. We use the national value and duplicate it for the three metiers DEF DWS MDD. 
##################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
#-------------------------------------------------------Maxseadays-----------------------------------------------------------
maxseadays<-dataXX

(maxseadays<-maxseadays%>%
    filter(country_code=="ITA" & variable_code=="maxseadays" & supra_reg=="AREA37"))

(maxseadays2008<-maxseadays%>%filter(year=="2008"))
(maxseadays2006<-maxseadays2007<-maxseadays2008)
maxseadays2006$year<-"2006"
maxseadays2007$year<-"2007"
(maxseadays<-rbind(maxseadays2006,maxseadays2007,maxseadays))

(maxseadaysOTB0612<-maxseadays%>%
    filter(fishing_tech=="DTS" & vessel_length=="VL0612"))
maxseadaysOTB0612$metier<-"DEF"


(maxseadaysOTBDUP<-maxseadays%>%
    filter(fishing_tech=="DTS" & vessel_length%in%c("VL1218","VL1824","VL2440")))

(maxseadaysOTBDUP_DEF<-maxseadaysOTBDUP_DWS<-maxseadaysOTBDUP_MDD<-maxseadaysOTBDUP)
maxseadaysOTBDUP_DEF$metier<-"DEF"
maxseadaysOTBDUP_DWS$metier<-"DWS"
maxseadaysOTBDUP_MDD$metier<-"MDD"
maxseadays2<-rbind(maxseadaysOTBDUP_DEF,maxseadaysOTBDUP_DWS,maxseadaysOTBDUP_MDD)
maxseadays3<-rbind(maxseadays2,maxseadaysOTB0612)

unique(maxseadays$vessel_length)

(maxseadaysPGP1<-maxseadays%>%
    select(country_code,year,supra_reg,fishing_tech,vessel_length,value,unit)%>%
    filter(fishing_tech=="PGP"& supra_reg=="AREA37"& vessel_length=="VL1218"))

(maxseadaysPGP2<-maxseadays%>%
    select(country_code,year,supra_reg,fishing_tech,vessel_length,value,unit)%>%
    filter(fishing_tech=="PGP"& supra_reg=="AREA37"& vessel_length%in%c("VL0006","VL0612"))%>%
    group_by(country_code,year,supra_reg,fishing_tech,unit)%>%
    summarise(value=sum(value)))
maxseadaysPGP2$vessel_length<-"VL0012"
(maxseadaysPGP3<-rbind(maxseadaysPGP2,maxseadaysPGP1))
#add THE gSA YOU NEED 
maxseadaysPGP3$gSA<-"GSA9"
(maxseadaysPGP3<-maxseadaysPGP3[,c(8,4,7,2,6,5)])
(maxseadaysPGP4<-maxseadaysPGP3%>%unite("FS",c(gSA:vessel_length), remove = T))

(maxseadays3<-maxseadays3[,c(3,4,6,7,14,15,19)])
(maxseadays3<-maxseadays3%>%filter(year%in%c("2006":"2013")))
maxseadays3$GSA<-"GSA9"
maxseadays3$OTB<-"OTB"
(maxseadays4<-maxseadays3[,c(8,3,4,9,7,2,5,6)])
(maxseadays4<-maxseadays4%>%unite("FS",c(GSA:metier), remove = T))


(maxseadays4<-rbind(maxseadays4,maxseadaysPGP4))
(maxseadaysDF<-maxseadays4%>%arrange(year,FS))


### DATA FROM 2014 to 2020
(RECENTDATA2<-read.csv("D:/Andrea/Desktop/NEW_BEMTool/FDI_capacity_by_country.csv", sep = ";"))

(RECENTDATA2<-RECENTDATA2%>%filter(Country.name=="Italy" &  principal.sub.region=="GSA9"))

(RECENTDATAOTB0612<-RECENTDATA2%>%
    filter(Country.name=="Italy" & Fishing.Technique=="DTS" & Vessel.Length.Category=="VL0612"))
RECENTDATAOTB0612$metier<-"DEF"
(RECENTDATAOTBDUP<-RECENTDATA2%>%
    filter(Country.name=="Italy" & Fishing.Technique=="DTS" & Vessel.Length.Category%in%c( "VL1218", "VL1824","VL2440")))

(RECENTDATAOTB_DEF<-RECENTDATAOTB_DWS<-RECENTDATAOTB_MDD<-RECENTDATAOTBDUP)
RECENTDATAOTB_DEF$metier<-"DEF"
RECENTDATAOTB_DWS$metier<-"DWS"
RECENTDATAOTB_MDD$metier<-"MDD"
RECENTDATAOTBDUP<-rbind(RECENTDATAOTB_DEF,RECENTDATAOTB_DWS,RECENTDATAOTB_MDD)
RECENTDATAOTB<-rbind(RECENTDATAOTB0612,RECENTDATAOTBDUP)
RECENTDATAOTB$OTB<-"OTB"

(RECENTDATAOTB<-RECENTDATAOTB%>%
  select(principal.sub.region,Fishing.Technique,Vessel.Length.Category,OTB,metier,year,maximum.sea.days)%>%
  arrange(year,Vessel.Length.Category))
(RECENTDATAOTB<-RECENTDATAOTB%>%unite("FS",c(principal.sub.region:metier), remove = T))

(RECENTDATAPGP2<-RECENTDATA2%>%
    filter(Country.name=="Italy" & Fishing.Technique=="PGP" & Vessel.Length.Category=="VL1218")%>%
    select(principal.sub.region,Fishing.Technique,Vessel.Length.Category,year,maximum.sea.days))
RECENTDATAPGP2$maximum.sea.days<-as.numeric(RECENTDATAPGP2$maximum.sea.days)


(RECENTDATAPGP1<-RECENTDATA2%>%
    filter(Country.name=="Italy" & Fishing.Technique=="PGP" & Vessel.Length.Category%in%c("VL0006","VL0612")))
RECENTDATAPGP1$maximum.sea.days <-as.numeric(RECENTDATAPGP1$maximum.sea.days)
  
  (RECENTDATAPGP1<-RECENTDATAPGP1%>%
    select(principal.sub.region,year,Fishing.Technique,maximum.sea.days)%>%
    group_by(principal.sub.region,year,Fishing.Technique)%>%
    summarise(maximum.sea.days=sum(as.numeric(maximum.sea.days))))
RECENTDATAPGP1$Vessel.Length.Category<-"VL0012"

RECENTDATAPGP<-rbind(RECENTDATAPGP1,RECENTDATAPGP2)
(RECENTDATAPGP<-RECENTDATAPGP[,c(1,3,5,2,4)])
(RECENTDATAPGP<-RECENTDATAPGP%>%unite("FS",c(principal.sub.region:Vessel.Length.Category), remove = T))

RECENTDATAFD<-rbind(RECENTDATAOTB,RECENTDATAPGP)
#all df 2006- 2020 
maxseadaysDF<-maxseadaysDF[,c(1,2,3)]
colnames(RECENTDATAFD)[3]<-"value"
(ALLDATAFD<-rbind( maxseadaysDF,  RECENTDATAFD))
(ALLDATAFD<-ALLDATAFD%>%arrange(year,FS))
##################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
#-------------------------------------------------------------------Total_landings--ALL species---------------------------------------------------------
# First I need to calculate the proportion of each metier by length vessel from the FDI data. After I will apply this data to AER values that does not have a metier level of details.

library(tidyverse)
library(data.table)
library(readxl)
dir<-"D:/Andrea/Desktop/NEW_BEMTool/FDI_catches_by_country.xlsx"

(Y2020<-read_xlsx(dir, sheet = 2))
(Y2019<-read_xlsx(dir, sheet = 3))
(Y2018<-read_xlsx(dir, sheet = 4))
(Y2017<-read_xlsx(dir, sheet = 5))
(Y2016<-read_xlsx(dir, sheet = 6))
(Y2015<-read_xlsx(dir, sheet = 7))
(Y2014<-read_xlsx(dir, sheet = 8))

head(Y2019)


#colnames(Y2020)=colnames(Y2019)=colnames(Y2018)=colnames(Y2017)=colnames(Y2016)=colnames(Y2015)
catch<-rbind(Y2020,Y2019,Y2018,Y2017,Y2016,Y2015,Y2014)

rm(Y2020,Y2019,Y2018,Y2017,Y2016,Y2015,Y2014)

names(catch)[1]<-"country_code"
names(catch)[14]<-"sub_region"
names(catch)[6]<-"fishing_technique"
names(catch)[2]<-"country_name"
names(catch)[5]<-"vessel_length"
names(catch)[8]<-"Target_Assemblage" 
names(catch)[21]<-"total_live_weight_landed_tonnes"
names(catch)[22]<-"total_value_of_landings_euro"
names(catch)[23]<-"total_discards"
names(catch)[7]<- "gear_type"
#After you could select your country, GSA and species

# Here the data extraction for data from 2020 to 2014
#  MUT GSA 9 

# NB for the DTS there are no problem in GSA 9 for Italy and data are available from 2020 to 2014 however in the same area for PGP we found data from 2016 to 2014 only 
(DTS<-catch%>%
   select(country_name,year,vessel_length,fishing_technique,gear_type,Target_Assemblage,sub_region,species,total_live_weight_landed_tonnes,total_value_of_landings_euro)%>%
  filter(country_name=="Italy" & sub_region=="GSA9" & fishing_technique=="DTS"& gear_type=="OTB"))

# PGP data from 2016 to 2014 

(PGP<-catch%>%
     select(country_name,year,vessel_length,fishing_technique,gear_type,Target_Assemblage,sub_region,species,total_live_weight_landed_tonnes,total_value_of_landings_euro)%>%
    filter(country_name=="Italy" & sub_region=="GSA9" & fishing_technique=="PGP"))
# please check if there are all fleet segments in all the year or if thewre are some missing data

(PGP<-PGP%>%
    select(year,vessel_length,sub_region,species,total_live_weight_landed_tonnes,gear_type,fishing_technique,Target_Assemblage,total_value_of_landings_euro)%>%
    group_by(year,vessel_length,sub_region,species,gear_type,fishing_technique,Target_Assemblage)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(PGP<-PGP[,c(3,6,2,1,4,8,9)])

(PGP1<-PGP%>%
  filter(vessel_length%in%c("VL0006","VL0612"))%>%
  group_by(sub_region,fishing_technique,year,species)%>%
  summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))
(PGP1$vessel_length<-"VL0012")
(PGP1<-PGP1[,c(1,2,7,3,4,5,6)])

(PGP2<-PGP%>%
  filter(vessel_length==("VL1218"))%>%
    group_by(sub_region,fishing_technique,vessel_length,year,species)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(PGP3<-rbind(PGP1,PGP2))
(PGP4<-PGP3%>%unite("FS",c(sub_region:vessel_length), remove = T))

# cleaned and conversion data from tons to KG
(DTS$total_live_weight_landed_tonnes[DTS$total_live_weight_landed_tonnes=="NK"] <- 0.000001)
(DTS$total_live_weight_landed_tonnes<-as.numeric(DTS$total_live_weight_landed_tonnes))
(DTS$total_live_weight_landed_tonnes<-DTS$total_live_weight_landed_tonnes*1000 )# here I convert tons to kg (BEMTool needs kg)

(PGP$total_live_weight_landed_tonnes[PGP$total_live_weight_landed_tonnes=="NK"] <- 0.000001)
(PGP$total_live_weight_landed_tonnes<-as.numeric(PGP$total_live_weight_landed_tonnes))
(PGP$total_live_weight_landed_tonnes<-PGP$total_live_weight_landed_tonnes*1000 )# here I convert tons to kg (BEMTool needs kg)

(DTS<-DTS%>%
    select(year,vessel_length,sub_region,fishing_technique,species,total_live_weight_landed_tonnes,gear_type,Target_Assemblage,total_value_of_landings_euro)%>%
    group_by(year,vessel_length,sub_region,fishing_technique,species,gear_type,Target_Assemblage)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(DTS<-DTS[,c(3,4,2,6,7,1,5,8,9)])

(DTSFUL<-DTS%>%unite("FS",c(sub_region:Target_Assemblage), remove = T))

(FULLDF<-rbind(DTSFUL,PGP4))

(FULLDF_totland_totrev<-FULLDF %>%
   group_by(FS,year)%>%
   summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
             total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%arrange(year,FS))
(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%filter( FS!="GSA9_DTS_VL2440_OTB_DWS")) # THIS IS Ready the DF of RECENT DATA 
# please check if there are all the fleet segments you need in all the years and if there are some missing data. 

# in 2017 there are amissing data and in 2019 there are some fleet segments that should be removed 
# cleaning 
(FULLDF_totland_totrev_miss<-FULLDF_totland_totrev%>%filter(year=="2016" & FS=="GSA9_DTS_VL1218_OTB_DWS"))
(FULLDF_totland_totrev_miss$year<-2017)
(FULLDF_totland_totrev<-rbind(FULLDF_totland_totrev_miss,FULLDF_totland_totrev))

(FULLDF_totland_totrev_miss2<-FULLDF_totland_totrev%>%filter(year=="2016" & FS=="GSA9_DTS_VL1824_OTB_DWS"))
(FULLDF_totland_totrev_miss$year<-2017)
(FULLDF_totland_totrev<-rbind(FULLDF_totland_totrev_miss2,FULLDF_totland_totrev))

(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%filter(!FS%in%c("GSA9_DTS_VL0612_OTB_DWS","GSA9_DTS_VL0612_OTB_MDD")))
(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%arrange(year,FS))

(FULLDF_totland_totrev_2014<-FULLDF_totland_totrev%>%filter(year=="2014"))
# below the proportion for the 2014 data. I will use this proportion for splitting the STECF 21-08 EU data landing


############ TOTAL_REVENUE  ##########
(FULLDF_2014_A<-FULLDF_totland_totrev_2014[,c(1,2,4)])

(FULLDF_2014_A_NOT_DUP<-FULLDF_2014_A%>%filter(FS%in%"GSA9_DTS_VL0612_OTB_DEF"))

(FULLDF_2014_A_DUP_1218<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL1218_OTB_DEF","GSA9_DTS_VL1218_OTB_DWS","GSA9_DTS_VL1218_OTB_MDD")))

(FULLDF_2014_A_DUP_1824<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL1824_OTB_DEF","GSA9_DTS_VL1824_OTB_DWS","GSA9_DTS_VL1824_OTB_MDD")))

(FULLDF_2014_A_DUP_2440<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_MDD")))

(FULLDF_2014_A_PGP<-FULLDF_2014_A%>%filter(FS%in%c("GSA9_PGP_VL0012","GSA9_PGP_VL1218")))

(FULLDF_2014_A_NOT_DUP$PROP<-1)

(FULLDF_2014_A_DUP_1218$tot<-sum(as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_1218$PROP<-as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_1218$tot))
(FULLDF_2014_A_DUP_1218<-FULLDF_2014_A_DUP_1218[,c(1,2,3,5)])

(FULLDF_2014_A_DUP_1824$tot<-sum(as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_1824$PROP<-as.numeric(FULLDF_2014_A_DUP_1824$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_1824$tot))
(FULLDF_2014_A_DUP_1824<-FULLDF_2014_A_DUP_1824[,c(1,2,3,5)])

(FULLDF_2014_A_DUP_2440$tot<-sum(as.numeric(FULLDF_2014_A_DUP_2440$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_2440$PROP<-as.numeric(FULLDF_2014_A_DUP_2440$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_2440$tot))
(FULLDF_2014_A_DUP_2440<-FULLDF_2014_A_DUP_2440[,c(1,2,3,5)])

(FULLDF_2014_A_PGP$PROP<-1)

(FULLDF_2014_A_REV<-rbind (FULLDF_2014_A_NOT_DUP,FULLDF_2014_A_DUP_1218,FULLDF_2014_A_DUP_1824,FULLDF_2014_A_DUP_2440,FULLDF_2014_A_PGP))

################# TOTAL_LANDINGS ####################

(FULLDF_2014_B<-FULLDF_totland_totrev_2014[,c(1,2,3)])
   
(FULLDF_2014_B_NOT_DUP<-FULLDF_2014_B%>%filter(FS%in%"GSA9_DTS_VL0612_OTB_DEF"))

(FULLDF_2014_B_DUP_1218<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL1218_OTB_DEF","GSA9_DTS_VL1218_OTB_DWS","GSA9_DTS_VL1218_OTB_MDD")))

(FULLDF_2014_B_DUP_1824<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL1824_OTB_DEF","GSA9_DTS_VL1824_OTB_DWS","GSA9_DTS_VL1824_OTB_MDD")))

(FULLDF_2014_B_DUP_2440<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_MDD")))

(FULLDF_2014_B_PGP<-FULLDF_2014_B%>%filter(FS%in%c("GSA9_PGP_VL0012","GSA9_PGP_VL1218")))
  
(FULLDF_2014_B_NOT_DUP$PROP<-1)

(FULLDF_2014_B_DUP_1218$tot<-sum(as.numeric(FULLDF_2014_B_DUP_1218$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_1218$PROP<-as.numeric(FULLDF_2014_B_DUP_1218$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_1218$tot))
(FULLDF_2014_B_DUP_1218<-FULLDF_2014_B_DUP_1218[,c(1,2,3,5)])

(FULLDF_2014_B_DUP_1824$tot<-sum(as.numeric(FULLDF_2014_B_DUP_1824$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_1824$PROP<-as.numeric(FULLDF_2014_B_DUP_1824$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_1824$tot))
(FULLDF_2014_B_DUP_1824<-FULLDF_2014_B_DUP_1824[,c(1,2,3,5)])

(FULLDF_2014_B_DUP_2440$tot<-sum(as.numeric(FULLDF_2014_B_DUP_2440$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_2440$PROP<-as.numeric(FULLDF_2014_B_DUP_2440$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_2440$tot))
(FULLDF_2014_B_DUP_2440<-FULLDF_2014_B_DUP_2440[,c(1,2,3,5)])

(FULLDF_2014_B_PGP$PROP<-1)

(FULLDF_2014_B_LANDINGS<-rbind(FULLDF_2014_B_NOT_DUP,FULLDF_2014_B_DUP_1218,FULLDF_2014_B_DUP_1824,FULLDF_2014_B_DUP_2440,FULLDF_2014_B_PGP))

# now the two DF with the proportion by metier are ready

#below the data extraction from 2006 to 2013

dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx" #this for data from 2008 to 2013 

(dataYY2008_2011<-read_xlsx(dir, sheet = 9))
(dataYY2012_2016<-read.csv2("D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment_2.csv",sep=";", header=T)) #there where some problems in the extraction of the excel so Y saved separately the second sheet I needed
#prepare the two data set 
(dataYY2008_2011<-dataYY2008_2011%>%select(country_code,year,supra_reg,fishing_tech,vessel_length,variable_code,value,unit,species_code,sub_reg))
(dataYY2012_2016<-dataYY2012_2016%>%select(country_code,year,supra_reg,fishing_tech,vessel_length,variable_code,value,unit,species_code,sub_reg))
data<-rbind(dataYY2008_2011,dataYY2012_2016)

(dataDTS_not_DUP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37" & fishing_tech=="DTS" & sub_reg=="sa 9" & vessel_length=="VL0612" ))

(dataDTS_DUP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37" & fishing_tech=="DTS" & sub_reg=="sa 9"& vessel_length%in%c("VL1218","VL1824","VL2440")))
  
(dataDTS_PGP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37"& fishing_tech=="PGP"& sub_reg=="sa 9"& vessel_length%in%c("VL0006","VL0612","VL1218")))

(DATA_STECF<-rbind(dataDTS_not_DUP,dataDTS_DUP,dataDTS_PGP))

# for consistency I shell remove all the species present in STECF data frame that are not present in FDI data frame
# some check :
# length(unique(DATA_FDI$species))
# length(unique(DATA_STECF$species_code))

# here a brief check of the number of species in each year in the FDI data set VS STECF data set 

# DATA_FDI   # 2014
# DATA_STECF # 2008 - 2016
# 
# speciesFDI<-sort(unique(DATA_FDI$species))          # 121
# speciesSTECF<-sort(unique(DATA_STECF$species_code)) # 147
# 
# (DATA1<-DATA_STECF%>%filter(year=="2008" & species_code%in%unique(DATA_FDI$species)))
# (DATA2<-DATA_STECF%>%filter(year=="2009" & species_code%in%unique(DATA_FDI$species)))
# (DATA3<-DATA_STECF%>%filter(year=="2010" & species_code%in%unique(DATA_FDI$species)))
# (DATA4<-DATA_STECF%>%filter(year=="2011" & species_code%in%unique(DATA_FDI$species)))
# (DATA5<-DATA_STECF%>%filter(year=="2012" & species_code%in%unique(DATA_FDI$species)))
# (DATA6<-DATA_STECF%>%filter(year=="2013" & species_code%in%unique(DATA_FDI$species)))
# (DATA7<-DATA_STECF%>%filter(year=="2014" & species_code%in%unique(DATA_FDI$species)))
# 
# # number of species 
# species1<-unique(DATA1$species_code) #117
# species2<-unique(DATA2$species_code) #117
# species3<-unique(DATA3$species_code) #113
# species4<-unique(DATA4$species_code) #112
# species5<-unique(DATA5$species_code) #114
# species6<-unique(DATA6$species_code) #113
# species7<-unique(DATA7$species_code) #121

(spec<-unique(FULLDF$species))

# below the total landing and total revenue by gsa and by LOA
(DATA_STECF_2<-DATA_STECF%>%
    filter(species_code%in%spec)%>%
             group_by(sub_reg,country_code,year,fishing_tech,vessel_length,variable_code,unit)%>%
             summarise(value=sum(as.numeric(value))))
##################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
 ################### ################### ################### ################### ################### ################### ################### ################### ###################
######################## TOTAL REVENUE ###################  ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################
(DATA_STECF_2_totrevenue<-DATA_STECF_2%>%filter(variable_code=="totvallandg"))
colnames(DATA_STECF_2_totrevenue)[8]<-"totrevenue"
(DATA_STECF_2_totrevenue<-DATA_STECF_2_totrevenue[,c(1,2,3,4,5,8)])

# below the filter split and duplication of the LOA that should be divided by METIERS 
###  DTS
(DATA_STECF_2_totrevenueDTS<-DATA_STECF_2_totrevenue%>%filter(fishing_tech%in%"DTS"))

(DATA_STECF_2_totrevenueDTS_NOTDUP<-DATA_STECF_2_totrevenueDTS%>%
  filter(vessel_length=="VL0612"))
DATA_STECF_2_totrevenueDTS_NOTDUP$metier<-"DEF"
DATA_STECF_2_totrevenueDTS_NOTDUP$OTB<-"OTB"
DATA_STECF_2_totrevenueDTS_NOTDUP$sub_reg<-"GSA9"

(DATA_STECF_2_totrevenueDTS_1218<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL1218"))

(DATA_STECF_2_totrevenueDTS_1824<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL1824"))

(DATA_STECF_2_totrevenueDTS_2440<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL2440"))

(DATA_STECF_2_totrevenueDTS_2440<-rbind(DATA_STECF_2_totrevenueDTS_2440[1,],DATA_STECF_2_totrevenueDTS_2440))
(DATA_STECF_2_totrevenueDTS_2440[1,3]<-2008)

(DATA_STECF_2_totrevenueDTS_DUPPLIC1218<-rbind(DATA_STECF_2_totrevenueDTS_1218,DATA_STECF_2_totrevenueDTS_1218,DATA_STECF_2_totrevenueDTS_1218))

(DATA_STECF_2_totrevenueDTS_DUPPLIC1824<-rbind(DATA_STECF_2_totrevenueDTS_1824,DATA_STECF_2_totrevenueDTS_1824,DATA_STECF_2_totrevenueDTS_1824))

(DATA_STECF_2_totrevenueDTS_DUPPLIC2440<-rbind(DATA_STECF_2_totrevenueDTS_2440,DATA_STECF_2_totrevenueDTS_2440,DATA_STECF_2_totrevenueDTS_2440))

(FULLDF_FINAL_DUPLIC<-rbind(DATA_STECF_2_totrevenueDTS_DUPPLIC1218,DATA_STECF_2_totrevenueDTS_DUPPLIC1824,DATA_STECF_2_totrevenueDTS_DUPPLIC2440))
FULLDF_FINAL_DUPLIC$sub_reg<-"GSA9"
(FULLDF_FINAL_DUPLIC<-FULLDF_FINAL_DUPLIC%>%arrange(year,vessel_length))
(FULLDF_FINAL_DUPLIC$metier<-rep(c("DEF","DWS","MDD"), 3*6))

(FULLDF_FINAL_DUPLIC$OTB<-"OTB")

(FULLDF_DUP_FINAL_FINAL<-rbind(DATA_STECF_2_totrevenueDTS_NOTDUP,FULLDF_FINAL_DUPLIC))
(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%arrange(year,vessel_length))

(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL[,c(1,4,5,8,7,3,6)])

(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%unite("FS",c(sub_reg:metier), remove = T))
(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%arrange(year,FS))

### PGP 
DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenue%>%filter(fishing_tech%in%"PGP")
(DATA_STECF_2_totrevenuePGP_NOTDUP<-DATA_STECF_2_totrevenuePGP%>%
  filter(vessel_length%in%c("VL0612","VL0006"))%>%
    group_by(sub_reg,country_code,fishing_tech,year)%>%
    summarise(totrevenue=sum(as.numeric(totrevenue))))

(DATA_STECF_2_totrevenuePGP_NOTDUP$vessel_length<-"VL0012")

(DATA_STECF_2_totrevenuePGP_NOTDUP_2<-DATA_STECF_2_totrevenuePGP%>%filter(vessel_length%in%"VL1218"))
(DATA_STECF_2_totrevenuePGP<-rbind(DATA_STECF_2_totrevenuePGP_NOTDUP,DATA_STECF_2_totrevenuePGP_NOTDUP_2))
DATA_STECF_2_totrevenuePGP$sub_reg<-"GSA9"
(DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenuePGP[,c(1,3,6,4,5)])
(DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenuePGP%>%unite("FS",c(sub_reg:vessel_length), remove = T))

(FINALOLDDF<-rbind( FULLDF_DUP_FINAL_FINAL,DATA_STECF_2_totrevenuePGP))
(FINALOLDDF%>%arrange(year,FS))
(FINALOLDDF<-FINALOLDDF%>%filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))
# FINALOLDDF<-rbind(FINALOLDDF,FINALOLDDF[65,]) # the pgp of 2013 are missing so I duplicated the 2012 data
# (FINALOLDDF[66,2]<-2013)

# now we can multiply the DF with the available proportion by metier in 2014

(FINALOLDDF$splittedvaluer<-FINALOLDDF$totrevenue*rep(FULLDF_2014_A_REV$PROP,6))

(FINALOLDDF<-FINALOLDDF[,c(1,2,4)]) # THE final old DF frame ready and splitted for metier for REVENUES

(REVENUE<-FULLDF_totland_totrev[,c(1,2,4)])
colnames(REVENUE)[3]<-"REV_EURO"
colnames(FINALOLDDF)[3]<-"REV_EURO"
 
(REV_TOTAL_DF<-rbind(FINALOLDDF,REVENUE)) 
(REV_TOTAL_DF_ALLSPEC<-REV_TOTAL_DF%>%arrange(year,FS))
#this is ready for the file time series

################## ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################
######################## TOTAL LANDINGS ######################## ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################

(DATA_STECF_2_totlandings<-DATA_STECF_2%>%filter(variable_code=="totwghtlandg"))
colnames(DATA_STECF_2_totlandings)[8]<-"totlandings"
(DATA_STECF_2_totlandings<-DATA_STECF_2_totlandings[,c(1,2,3,4,5,8)])

# below the fileter split and duplication of the LOA that should be divided by METIERS 
###  DTS
(DATA_STECF_2_totlandingsDTS<-DATA_STECF_2_totlandings%>%filter(fishing_tech%in%"DTS"))

(DATA_STECF_2_totlandingsDTS_NOTDUP<-DATA_STECF_2_totlandingsDTS%>%
  filter(vessel_length=="VL0612"))
DATA_STECF_2_totlandingsDTS_NOTDUP$metier<-"DEF"
DATA_STECF_2_totlandingsDTS_NOTDUP$OTB<-"OTB"
DATA_STECF_2_totlandingsDTS_NOTDUP$sub_reg<-"GSA9"

(DATA_STECF_2_totlandingsDTS_1218<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL1218"))

(DATA_STECF_2_totlandingsDTS_1824<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL1824"))

(DATA_STECF_2_totlandingsDTS_2440<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL2440"))
(DATA_STECF_2_totlandingsDTS_2440<-rbind(DATA_STECF_2_totlandingsDTS_2440[1,],DATA_STECF_2_totlandingsDTS_2440))
(DATA_STECF_2_totlandingsDTS_2440[1,3]<-2008)

(DATA_STECF_2_totlandingsDTS_DUPPLIC1218<-rbind(DATA_STECF_2_totlandingsDTS_1218,DATA_STECF_2_totlandingsDTS_1218,DATA_STECF_2_totlandingsDTS_1218))

(DATA_STECF_2_totlandingsDTS_DUPPLIC1824<-rbind(DATA_STECF_2_totlandingsDTS_1824,DATA_STECF_2_totlandingsDTS_1824,DATA_STECF_2_totlandingsDTS_1824))

(DATA_STECF_2_totlandingsDTS_DUPPLIC2440<-rbind(DATA_STECF_2_totlandingsDTS_2440,DATA_STECF_2_totlandingsDTS_2440,DATA_STECF_2_totlandingsDTS_2440))

(FULLDF_FINAL_DUPLIC<-rbind(DATA_STECF_2_totlandingsDTS_DUPPLIC1218,DATA_STECF_2_totlandingsDTS_DUPPLIC1824,DATA_STECF_2_totlandingsDTS_DUPPLIC2440))
FULLDF_FINAL_DUPLIC$sub_reg<-"GSA9"
(FULLDF_FINAL_DUPLIC<-FULLDF_FINAL_DUPLIC%>%arrange(year,vessel_length))
(FULLDF_FINAL_DUPLIC$metier<-rep(c("DEF","DWS","MDD"),3*6))

FULLDF_FINAL_DUPLIC$OTB<-"OTB"

FULLDF_DUP_FINAL_FINALX<-rbind(DATA_STECF_2_totlandingsDTS_NOTDUP,FULLDF_FINAL_DUPLIC)
(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%arrange(year,vessel_length))

(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX[,c(1,4,5,8,7,3,6)])

(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%unite("FS",c(sub_reg:metier), remove = T))
(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%arrange(year,FS))

### PGP 
DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandings%>%filter(fishing_tech%in%"PGP")
(DATA_STECF_2_totlandingsPGPP_NOTDUP<-DATA_STECF_2_totlandingsPGP%>%
  filter(vessel_length%in%c("VL0612","VL0006"))%>%
    group_by(sub_reg,country_code,fishing_tech,year)%>%
    summarise(totlandings=sum(as.numeric(totlandings))))

(DATA_STECF_2_totlandingsPGPP_NOTDUP$vessel_length<-"VL0012")

(DATA_STECF_2_totlandingsPGP_NOTDUP_2<-DATA_STECF_2_totlandingsPGP%>%filter(vessel_length%in%"VL1218"))

(DATA_STECF_2_totlandingsPGP<-rbind(DATA_STECF_2_totlandingsPGPP_NOTDUP,DATA_STECF_2_totlandingsPGP_NOTDUP_2))

DATA_STECF_2_totlandingsPGP$sub_reg<-"GSA9"

(DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandingsPGP[,c(1,3,6,4,5)])
(DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandingsPGP%>%unite("FS",c(sub_reg:vessel_length), remove = T))

(FINALOLDDFX<-rbind( FULLDF_DUP_FINAL_FINALX,DATA_STECF_2_totlandingsPGP))
(FINALOLDDFX%>%arrange(year,FS))
(FINALOLDDFX<-FINALOLDDFX%>%filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))

# now we can multiply the DF with the available proportion by metier in 2014

(FINALOLDDFX$splittedvaluer<-FINALOLDDFX$totlandings*rep(FULLDF_2014_B_LANDINGS$PROP,6))
(FINALOLDDFX<-FINALOLDDFX[,c(1,2,4)])

(FINALOLDDFX<-FINALOLDDFX%>%arrange(year,FS)) # this is the file ready for the old data for landings
#NOW sum old plus new 

(LAND<-FULLDF_totland_totrev[,c(1,2,3)])
colnames(LAND)[3]<-"Landing_Kg"
colnames(FINALOLDDFX)[3]<-"Landing_Kg"

(LAND_TOTAL_DF_ALLSPEC<-rbind(FINALOLDDFX,LAND)) # this is ready for the file time series

# the final step is to sum up old landings with the new DF

################### ################### ################### ################### ################### ################### ################### ################### ################### ###################################### S1 ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################
# Here the data extraction for data from 2020 to 2014
#  MUT GSA 9 

# NB for the DTS there are no problem in GSA 9 for Italy and data are available from 2020 to 2014 however in the same area for PGP we found data from 2016 to 2014 only 
(DTS<-catch%>%
   select(country_name,year,vessel_length,fishing_technique,gear_type,Target_Assemblage,sub_region,species,total_live_weight_landed_tonnes,total_value_of_landings_euro)%>%
  filter(country_name=="Italy" & sub_region=="GSA9" & fishing_technique=="DTS" & gear_type=="OTB" & species=="MUT" ))

# PGP data from 2016 to 2014 

(PGP<-catch%>%
     select(country_name,year,vessel_length,fishing_technique,gear_type,Target_Assemblage,sub_region,species,total_live_weight_landed_tonnes,total_value_of_landings_euro)%>%
    filter(country_name=="Italy" & sub_region=="GSA9" & fishing_technique=="PGP" & species=="MUT" ))

(PGP<-PGP%>%
    select(year,vessel_length,sub_region,species,total_live_weight_landed_tonnes,gear_type,fishing_technique,Target_Assemblage,total_value_of_landings_euro)%>%
    group_by(year,vessel_length,sub_region,species,gear_type,fishing_technique,Target_Assemblage)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(PGP<-PGP[,c(3,6,2,1,4,8,9)])

(PGP1<-PGP%>%
  filter(vessel_length%in%c("VL0006","VL0612"))%>%
  group_by(sub_region,fishing_technique,year,species)%>%
  summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))
(PGP1$vessel_length<-"VL0012")
(PGP1<-PGP1[,c(1,2,7,3,4,5,6)])

(PGP2<-PGP%>%
  filter(vessel_length==("VL1218"))%>%
    group_by(sub_region,fishing_technique,vessel_length,year,species)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(PGP3<-rbind(PGP1,PGP2))
(PGP4<-PGP3%>%unite("FS",c(sub_region:vessel_length), remove = T))

# cleaned and conversion data from tons to KG
(DTS$total_live_weight_landed_tonnes[DTS$total_live_weight_landed_tonnes=="NK"] <- 0.000001)
(DTS$total_live_weight_landed_tonnes<-as.numeric(DTS$total_live_weight_landed_tonnes))
(DTS$total_live_weight_landed_tonnes<-DTS$total_live_weight_landed_tonnes*1000 )# here I convert tons to kg (BEMTool needs kg)

(PGP$total_live_weight_landed_tonnes[PGP$total_live_weight_landed_tonnes=="NK"] <- 0.000001)
(PGP$total_live_weight_landed_tonnes<-as.numeric(PGP$total_live_weight_landed_tonnes))
(PGP$total_live_weight_landed_tonnes<-PGP$total_live_weight_landed_tonnes*1000 )# here I convert tons to kg (BEMTool needs kg)

(DTS<-DTS%>%
    select(year,vessel_length,sub_region,fishing_technique,species,total_live_weight_landed_tonnes,gear_type,Target_Assemblage,total_value_of_landings_euro)%>%
    group_by(year,vessel_length,sub_region,fishing_technique,species,gear_type,Target_Assemblage)%>%
    summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
              total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(DTS<-DTS[,c(3,4,2,6,7,1,5,8,9)])

(DTSFUL<-DTS%>%unite("FS",c(sub_region:Target_Assemblage), remove = T))

(FULLDF<-rbind(DTSFUL,PGP4))

(FULLDF_totland_totrev<-FULLDF %>%
   group_by(FS,year)%>%
   summarise(total_live_weight_landed_tonnes=sum(as.numeric(total_live_weight_landed_tonnes)),
             total_value_of_landings_euro=sum(as.numeric(total_value_of_landings_euro))))

(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%arrange(year,FS))
(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%filter( FS!="GSA9_DTS_VL2440_OTB_DWS")) # THIS IS Ready the DF of RECENT DATA 


# please check if there is some missing data or fleet segments 
length(2014:2020)*11
# there is a missing in 2015 
(FULLDF_totland_totrevmissX<-FULLDF_totland_totrev%>%filter(year==2016 & FS=="GSA9_PGP_VL1218"))
(FULLDF_totland_totrevmissX$year<-2015)
(FULLDF_totland_totrev<-rbind(FULLDF_totland_totrevmissX,FULLDF_totland_totrev))

(FULLDF_totland_totrevmissX2<-FULLDF_totland_totrev%>%filter(year==2016 & FS=="GSA9_DTS_VL1218_OTB_DWS"))
(FULLDF_totland_totrevmissX2$year<-2017)
(FULLDF_totland_totrev<-rbind(FULLDF_totland_totrevmissX2,FULLDF_totland_totrev))

(FULLDF_totland_totrevmissX3<-FULLDF_totland_totrev%>%filter(year==2016 & FS=="GSA9_DTS_VL1824_OTB_DWS"))
(FULLDF_totland_totrevmissX3$year<-2017)
(FULLDF_totland_totrev<-rbind(FULLDF_totland_totrevmissX3,FULLDF_totland_totrev))

(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%filter(!FS%in%c("GSA9_DTS_VL0612_OTB_DWS","GSA9_DTS_VL0612_OTB_MDD")))
(FULLDF_totland_totrev<-FULLDF_totland_totrev%>%arrange(year,FS))


(FULLDF_totland_totrev_2014<-FULLDF_totland_totrev%>%filter(year=="2014"))

# below the proportion for the 2014 data. I will use this proportion for splitting the STECF 21-08 EU data landing

############ TOTAL_REVENUE  ##########
(FULLDF_2014_A<-FULLDF_totland_totrev_2014[,c(1,2,4)])

(FULLDF_2014_A_NOT_DUP<-FULLDF_2014_A%>%filter(FS%in%"GSA9_DTS_VL0612_OTB_DEF"))

(FULLDF_2014_A_DUP_1218<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL1218_OTB_DEF","GSA9_DTS_VL1218_OTB_DWS","GSA9_DTS_VL1218_OTB_MDD")))

(FULLDF_2014_A_DUP_1824<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL1824_OTB_DEF","GSA9_DTS_VL1824_OTB_DWS","GSA9_DTS_VL1824_OTB_MDD")))

(FULLDF_2014_A_DUP_2440<-FULLDF_2014_A%>%
  filter(FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_MDD")))

(FULLDF_2014_A_PGP<-FULLDF_2014_A%>%filter(FS%in%c("GSA9_PGP_VL0012","GSA9_PGP_VL1218")))

(FULLDF_2014_A_NOT_DUP$PROP<-1)

(FULLDF_2014_A_DUP_1218$tot<-sum(as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_1218$PROP<-as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_1218$tot))
(FULLDF_2014_A_DUP_1218<-FULLDF_2014_A_DUP_1218[,c(1,2,3,5)])

(FULLDF_2014_A_DUP_1824$tot<-sum(as.numeric(FULLDF_2014_A_DUP_1218$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_1824$PROP<-as.numeric(FULLDF_2014_A_DUP_1824$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_1824$tot))
(FULLDF_2014_A_DUP_1824<-FULLDF_2014_A_DUP_1824[,c(1,2,3,5)])

(FULLDF_2014_A_DUP_2440$tot<-sum(as.numeric(FULLDF_2014_A_DUP_2440$total_value_of_landings_euro)))
(FULLDF_2014_A_DUP_2440$PROP<-as.numeric(FULLDF_2014_A_DUP_2440$total_value_of_landings_euro)/as.numeric(FULLDF_2014_A_DUP_2440$tot))
(FULLDF_2014_A_DUP_2440<-FULLDF_2014_A_DUP_2440[,c(1,2,3,5)])

(FULLDF_2014_A_PGP$PROP<-1)

(FULLDF_2014_A_REV<-rbind (FULLDF_2014_A_NOT_DUP,FULLDF_2014_A_DUP_1218,FULLDF_2014_A_DUP_1824,FULLDF_2014_A_DUP_2440,FULLDF_2014_A_PGP))


################# TOTAL_LANDINGS ####################

(FULLDF_2014_B<-FULLDF_totland_totrev_2014[,c(1,2,3)])
   
(FULLDF_2014_B_NOT_DUP<-FULLDF_2014_B%>%filter(FS%in%"GSA9_DTS_VL0612_OTB_DEF"))

(FULLDF_2014_B_DUP_1218<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL1218_OTB_DEF","GSA9_DTS_VL1218_OTB_DWS","GSA9_DTS_VL1218_OTB_MDD")))

(FULLDF_2014_B_DUP_1824<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL1824_OTB_DEF","GSA9_DTS_VL1824_OTB_DWS","GSA9_DTS_VL1824_OTB_MDD")))

(FULLDF_2014_B_DUP_2440<-FULLDF_2014_B%>%
  filter(FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_MDD")))

(FULLDF_2014_B_PGP<-FULLDF_2014_B%>%filter(FS%in%c("GSA9_PGP_VL0012","GSA9_PGP_VL1218")))
  
(FULLDF_2014_B_NOT_DUP$PROP<-1)

(FULLDF_2014_B_DUP_1218$tot<-sum(as.numeric(FULLDF_2014_B_DUP_1218$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_1218$PROP<-as.numeric(FULLDF_2014_B_DUP_1218$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_1218$tot))
(FULLDF_2014_B_DUP_1218<-FULLDF_2014_B_DUP_1218[,c(1,2,3,5)])

(FULLDF_2014_B_DUP_1824$tot<-sum(as.numeric(FULLDF_2014_B_DUP_1824$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_1824$PROP<-as.numeric(FULLDF_2014_B_DUP_1824$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_1824$tot))
(FULLDF_2014_B_DUP_1824<-FULLDF_2014_B_DUP_1824[,c(1,2,3,5)])

(FULLDF_2014_B_DUP_2440$tot<-sum(as.numeric(FULLDF_2014_B_DUP_2440$total_live_weight_landed_tonnes)))
(FULLDF_2014_B_DUP_2440$PROP<-as.numeric(FULLDF_2014_B_DUP_2440$total_live_weight_landed_tonnes)/as.numeric(FULLDF_2014_B_DUP_2440$tot))
(FULLDF_2014_B_DUP_2440<-FULLDF_2014_B_DUP_2440[,c(1,2,3,5)])

(FULLDF_2014_B_PGP$PROP<-1)

(FULLDF_2014_B_LANDINGS<-rbind(FULLDF_2014_B_NOT_DUP,FULLDF_2014_B_DUP_1218,FULLDF_2014_B_DUP_1824,FULLDF_2014_B_DUP_2440,FULLDF_2014_B_PGP))

# now the two DF with the proportion by metier are ready

#below the data extraction from 2006 to 2013

dir<-"D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment.xlsx" #this for data from 2008 to 2013 

(dataYY2008_2011<-read_xlsx(dir, sheet = 9))
(dataYY2012_2016<-read.csv2("D:/Andrea/Desktop/NEW_BEMTool/STECF_21-08_EU_Fleet_Economic_and_Transversal_data_fleet_segment_2.csv",sep=";", header=T)) #there where some problems in the extraction of the excel so Y saved separately the second sheet I needed
#prepare the two data set 
(dataYY2008_2011<-dataYY2008_2011%>%select(country_code,year,supra_reg,fishing_tech,vessel_length,variable_code,value,unit,species_code,sub_reg))
(dataYY2012_2016<-dataYY2012_2016%>%select(country_code,year,supra_reg,fishing_tech,vessel_length,variable_code,value,unit,species_code,sub_reg))
data<-rbind(dataYY2008_2011,dataYY2012_2016)

(dataDTS_not_DUP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37" & fishing_tech=="DTS" & sub_reg=="sa 9" & vessel_length=="VL0612" & species_code=="MUT"))

(dataDTS_DUP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37" & fishing_tech=="DTS" & sub_reg=="sa 9"& vessel_length%in%c("VL1218","VL1824","VL2440") & species_code=="MUT"))
  
(dataDTS_PGP<-data%>%
    filter(country_code=="ITA" & year%in%c(2008:2013) & supra_reg=="AREA37"& fishing_tech=="PGP"& sub_reg=="sa 9"& vessel_length%in%c("VL0006","VL0612","VL1218") & species_code=="MUT"))

(DATA_STECF<-rbind(dataDTS_not_DUP,dataDTS_DUP,dataDTS_PGP))

# for consistency I shell remove all the species present in STECF data frame that are not present in FDI data frame
# some check :
# length(unique(DATA_FDI$species))
# length(unique(DATA_STECF$species_code))

# here a brief check of the number of species in each year in the FDI data set VS STECF data set 

# DATA_FDI   # 2014
# DATA_STECF # 2008 - 2016
# 
# speciesFDI<-sort(unique(DATA_FDI$species))          # 121
# speciesSTECF<-sort(unique(DATA_STECF$species_code)) # 147
# 
# (DATA1<-DATA_STECF%>%filter(year=="2008" & species_code%in%unique(DATA_FDI$species)))
# (DATA2<-DATA_STECF%>%filter(year=="2009" & species_code%in%unique(DATA_FDI$species)))
# (DATA3<-DATA_STECF%>%filter(year=="2010" & species_code%in%unique(DATA_FDI$species)))
# (DATA4<-DATA_STECF%>%filter(year=="2011" & species_code%in%unique(DATA_FDI$species)))
# (DATA5<-DATA_STECF%>%filter(year=="2012" & species_code%in%unique(DATA_FDI$species)))
# (DATA6<-DATA_STECF%>%filter(year=="2013" & species_code%in%unique(DATA_FDI$species)))
# (DATA7<-DATA_STECF%>%filter(year=="2014" & species_code%in%unique(DATA_FDI$species)))
# 
# # number of species 
# species1<-unique(DATA1$species_code) #117
# species2<-unique(DATA2$species_code) #117
# species3<-unique(DATA3$species_code) #113
# species4<-unique(DATA4$species_code) #112
# species5<-unique(DATA5$species_code) #114
# species6<-unique(DATA6$species_code) #113
# species7<-unique(DATA7$species_code) #121

(spec<-"MUT")

# below the total landing and total revenue by gsa and by LOA
(DATA_STECF_2<-DATA_STECF%>%
    filter(species_code%in%spec)%>%
             group_by(sub_reg,country_code,year,fishing_tech,vessel_length,variable_code,unit)%>%
             summarise(value=sum(as.numeric(value))))

 ################### ################### ################### ################### ################### ################### ################### ################### ###################
######################## TOTAL REVENUE ###################  ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################
(DATA_STECF_2_totrevenue<-DATA_STECF_2%>%filter(variable_code=="totvallandg"))
colnames(DATA_STECF_2_totrevenue)[8]<-"totrevenue"
(DATA_STECF_2_totrevenue<-DATA_STECF_2_totrevenue[,c(1,2,3,4,5,8)])

# below the filter split and duplication of the LOA that should be divided by METIERS 
###  DTS
(DATA_STECF_2_totrevenueDTS<-DATA_STECF_2_totrevenue%>%filter(fishing_tech%in%"DTS"))

(DATA_STECF_2_totrevenueDTS_NOTDUP<-DATA_STECF_2_totrevenueDTS%>%
  filter(vessel_length=="VL0612"))
DATA_STECF_2_totrevenueDTS_NOTDUP$metier<-"DEF"
DATA_STECF_2_totrevenueDTS_NOTDUP$OTB<-"OTB"
DATA_STECF_2_totrevenueDTS_NOTDUP$sub_reg<-"GSA9"

(DATA_STECF_2_totrevenueDTS_1218<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL1218"))

(DATA_STECF_2_totrevenueDTS_1824<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL1824"))

(DATA_STECF_2_totrevenueDTS_2440<-DATA_STECF_2_totrevenueDTS%>%filter(vessel_length=="VL2440"))

(DATA_STECF_2_totrevenueDTS_2440<-rbind(DATA_STECF_2_totrevenueDTS_2440[1,],DATA_STECF_2_totrevenueDTS_2440))
(DATA_STECF_2_totrevenueDTS_2440[1,3]<-2008)

(DATA_STECF_2_totrevenueDTS_DUPPLIC1218<-rbind(DATA_STECF_2_totrevenueDTS_1218,DATA_STECF_2_totrevenueDTS_1218,DATA_STECF_2_totrevenueDTS_1218))

(DATA_STECF_2_totrevenueDTS_DUPPLIC1824<-rbind(DATA_STECF_2_totrevenueDTS_1824,DATA_STECF_2_totrevenueDTS_1824,DATA_STECF_2_totrevenueDTS_1824))

(DATA_STECF_2_totrevenueDTS_DUPPLIC2440<-rbind(DATA_STECF_2_totrevenueDTS_2440,DATA_STECF_2_totrevenueDTS_2440,DATA_STECF_2_totrevenueDTS_2440))

(FULLDF_FINAL_DUPLIC<-rbind(DATA_STECF_2_totrevenueDTS_DUPPLIC1218,DATA_STECF_2_totrevenueDTS_DUPPLIC1824,DATA_STECF_2_totrevenueDTS_DUPPLIC2440))
FULLDF_FINAL_DUPLIC$sub_reg<-"GSA9"
(FULLDF_FINAL_DUPLIC<-FULLDF_FINAL_DUPLIC%>%arrange(year,vessel_length))
(FULLDF_FINAL_DUPLIC$metier<-rep(c("DEF","DWS","MDD"), 3*6))

(FULLDF_FINAL_DUPLIC$OTB<-"OTB")

(FULLDF_DUP_FINAL_FINAL<-rbind(DATA_STECF_2_totrevenueDTS_NOTDUP,FULLDF_FINAL_DUPLIC))
(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%arrange(year,vessel_length))

(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL[,c(1,4,5,8,7,3,6)])

(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%unite("FS",c(sub_reg:metier), remove = T))
(FULLDF_DUP_FINAL_FINAL<-FULLDF_DUP_FINAL_FINAL%>%arrange(year,FS))

### PGP 
DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenue%>%filter(fishing_tech%in%"PGP")
(DATA_STECF_2_totrevenuePGP_NOTDUP<-DATA_STECF_2_totrevenuePGP%>%
  filter(vessel_length%in%c("VL0612","VL0006"))%>%
    group_by(sub_reg,country_code,fishing_tech,year)%>%
    summarise(totrevenue=sum(as.numeric(totrevenue))))

(DATA_STECF_2_totrevenuePGP_NOTDUP$vessel_length<-"VL0012")

(DATA_STECF_2_totrevenuePGP_NOTDUP_2<-DATA_STECF_2_totrevenuePGP%>%filter(vessel_length%in%"VL1218"))
(DATA_STECF_2_totrevenuePGP<-rbind(DATA_STECF_2_totrevenuePGP_NOTDUP,DATA_STECF_2_totrevenuePGP_NOTDUP_2))
DATA_STECF_2_totrevenuePGP$sub_reg<-"GSA9"
(DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenuePGP[,c(1,3,6,4,5)])
(DATA_STECF_2_totrevenuePGP<-DATA_STECF_2_totrevenuePGP%>%unite("FS",c(sub_reg:vessel_length), remove = T))

(FINALOLDDF<-rbind( FULLDF_DUP_FINAL_FINAL,DATA_STECF_2_totrevenuePGP))
(FINALOLDDF%>%arrange(year,FS))
(FINALOLDDF<-FINALOLDDF%>%filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))
 FINALOLDDF<-rbind(FINALOLDDF,FINALOLDDF[65,]) # the pgp of 2013 are missing so I duplicated the 2012 data
 (FINALOLDDF[66,2]<-2013)

# now we can multiply the DF with the available proportion by metier in 2014

(FINALOLDDF$splittedvaluer<-FINALOLDDF$totrevenue*rep(FULLDF_2014_A_REV$PROP,6))

(FINALOLDDF<-FINALOLDDF[,c(1,2,4)]) # THE final old DF frame ready and splitted for metier for REVENUES

(REV<-FULLDF_totland_totrev[,c(1,2,4)])
colnames(REV)[3]<-"REV_EURO"
colnames(FINALOLDDF)[3]<-"REV_EURO"
 
(REV_TOTAL_DF<-rbind(FINALOLDDF,REV)) 
(REV_TOTAL_DF_MUT<-REV_TOTAL_DF%>%arrange(year,FS))
#this is ready for the file time series

################## ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################
######################## TOTAL LANDINGS ######################## ################### ################### ################### ################### ################### ################### ################### ################### ################### ###################

(DATA_STECF_2_totlandings<-DATA_STECF_2%>%filter(variable_code=="totwghtlandg"))
colnames(DATA_STECF_2_totlandings)[8]<-"totlandings"
(DATA_STECF_2_totlandings<-DATA_STECF_2_totlandings[,c(1,2,3,4,5,8)])

# below the fileter split and duplication of the LOA that should be divided by METIERS 
###  DTS
(DATA_STECF_2_totlandingsDTS<-DATA_STECF_2_totlandings%>%filter(fishing_tech%in%"DTS"))

(DATA_STECF_2_totlandingsDTS_NOTDUP<-DATA_STECF_2_totlandingsDTS%>%
  filter(vessel_length=="VL0612"))
DATA_STECF_2_totlandingsDTS_NOTDUP$metier<-"DEF"
DATA_STECF_2_totlandingsDTS_NOTDUP$OTB<-"OTB"
DATA_STECF_2_totlandingsDTS_NOTDUP$sub_reg<-"GSA9"

(DATA_STECF_2_totlandingsDTS_1218<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL1218"))

(DATA_STECF_2_totlandingsDTS_1824<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL1824"))

(DATA_STECF_2_totlandingsDTS_2440<-DATA_STECF_2_totlandingsDTS%>%filter(vessel_length=="VL2440"))
(DATA_STECF_2_totlandingsDTS_2440<-rbind(DATA_STECF_2_totlandingsDTS_2440[1,],DATA_STECF_2_totlandingsDTS_2440))
(DATA_STECF_2_totlandingsDTS_2440[1,3]<-2008)

(DATA_STECF_2_totlandingsDTS_DUPPLIC1218<-rbind(DATA_STECF_2_totlandingsDTS_1218,DATA_STECF_2_totlandingsDTS_1218,DATA_STECF_2_totlandingsDTS_1218))

(DATA_STECF_2_totlandingsDTS_DUPPLIC1824<-rbind(DATA_STECF_2_totlandingsDTS_1824,DATA_STECF_2_totlandingsDTS_1824,DATA_STECF_2_totlandingsDTS_1824))

(DATA_STECF_2_totlandingsDTS_DUPPLIC2440<-rbind(DATA_STECF_2_totlandingsDTS_2440,DATA_STECF_2_totlandingsDTS_2440,DATA_STECF_2_totlandingsDTS_2440))

(FULLDF_FINAL_DUPLIC<-rbind(DATA_STECF_2_totlandingsDTS_DUPPLIC1218,DATA_STECF_2_totlandingsDTS_DUPPLIC1824,DATA_STECF_2_totlandingsDTS_DUPPLIC2440))
FULLDF_FINAL_DUPLIC$sub_reg<-"GSA9"
(FULLDF_FINAL_DUPLIC<-FULLDF_FINAL_DUPLIC%>%arrange(year,vessel_length))
(FULLDF_FINAL_DUPLIC$metier<-rep(c("DEF","DWS","MDD"),3*6))

FULLDF_FINAL_DUPLIC$OTB<-"OTB"

FULLDF_DUP_FINAL_FINALX<-rbind(DATA_STECF_2_totlandingsDTS_NOTDUP,FULLDF_FINAL_DUPLIC)
(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%arrange(year,vessel_length))

(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX[,c(1,4,5,8,7,3,6)])

(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%unite("FS",c(sub_reg:metier), remove = T))
(FULLDF_DUP_FINAL_FINALX<-FULLDF_DUP_FINAL_FINALX%>%arrange(year,FS))

### PGP 
DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandings%>%filter(fishing_tech%in%"PGP")
(DATA_STECF_2_totlandingsPGPP_NOTDUP<-DATA_STECF_2_totlandingsPGP%>%
  filter(vessel_length%in%c("VL0612","VL0006"))%>%
    group_by(sub_reg,country_code,fishing_tech,year)%>%
    summarise(totlandings=sum(as.numeric(totlandings))))

(DATA_STECF_2_totlandingsPGPP_NOTDUP$vessel_length<-"VL0012")

(DATA_STECF_2_totlandingsPGP_NOTDUP_2<-DATA_STECF_2_totlandingsPGP%>%filter(vessel_length%in%"VL1218"))

(DATA_STECF_2_totlandingsPGP<-rbind(DATA_STECF_2_totlandingsPGPP_NOTDUP,DATA_STECF_2_totlandingsPGP_NOTDUP_2))

DATA_STECF_2_totlandingsPGP$sub_reg<-"GSA9"

(DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandingsPGP[,c(1,3,6,4,5)])
(DATA_STECF_2_totlandingsPGP<-DATA_STECF_2_totlandingsPGP%>%unite("FS",c(sub_reg:vessel_length), remove = T))

(FINALOLDDFX<-rbind( FULLDF_DUP_FINAL_FINALX,DATA_STECF_2_totlandingsPGP))
(FINALOLDDFX%>%arrange(year,FS))
(FINALOLDDFX<-FINALOLDDFX%>%filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))

 FINALOLDDFX<-rbind(FINALOLDDFX,FINALOLDDFX[65,]) # the pgp of 2013 are missing so I duplicated the 2012 data
 (FINALOLDDFX[66,2]<-2013)

# now we can multiply the DF with the available proportion by metier in 2014

(FINALOLDDFX$splittedvaluer<-FINALOLDDFX$totlandings*rep(FULLDF_2014_B_LANDINGS$PROP,6))
(FINALOLDDFX<-FINALOLDDFX[,c(1,2,4)])

(FINALOLDDFX<-FINALOLDDFX%>%arrange(year,FS)) # this is the file ready for the old data for landings
#NOW sum old plus new 

(LANDX<-FULLDF_totland_totrev[,c(1,2,3)])
colnames(LANDX)[3]<-"Landing_Kg"
colnames(FINALOLDDFX)[3]<-"Landing_Kg"
(LAND_TOTAL_DF_MUT<-rbind(FINALOLDDFX,LANDX)) # this is ready for the file time series

# the final step is to sum up old landings with the new DF
##################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################
 ################### ################### ################### ###################  ################### ###################  ################### ################### ######## ################### ###################################### FUEL COSTS; labourcosts; maintenancecosts; othercosts  ################### ################### ################### ################### ################### ################### ################### ################### ###################  ################### ################### ################### ###################

# Input needed: use the templates in the package distributed

#Costs_or = read.table("D:/Andrea/Desktop/NEW_BEMTool/Costs_by_FS.csv",sep=",",header=T)  # The times series of the costs by fleet segment
(key_table_or=read.table("C:/Users/andre/OneDrive/Desktop/COISPA/BEMTOOL/Last_scripts/FS_MET.csv", sep=",", header=T)) # The results of the GLMs chosen for each type of cost and each fleet segment
(key_table_or<-key_table_or[c(1:18),])
(key_table_or$Fleet_segment<-c(rep("GSA9_DTS_VL1218_OTB",6),rep("GSA9_DTS_VL1824_OTB",6),rep("GSA9_DTS_VL2440_OTB",6)))
key_table_or$Type_of_cost[key_table_or$Type_of_cost=="fuel_costs"]<-"fuelcosts"
key_table_or$Type_of_cost[key_table_or$Type_of_cost=="labour_costs"]<-"labourcosts"
key_table_or$Type_of_cost[key_table_or$Type_of_cost=="other_costs"]<-"othervariablecosts"


#Eff=read.table("D:/Andrea/Desktop/NEW_BEMTool/Effort_Rev_metier.csv",header=T, sep=",") # The effort time series for each fleet segment, associated to the metier used by everyone
#-------------------------------------------------------------------------------
# creating the "Costs_or" data frame 
# fuelcosts

(year<-c(2008:2020))
# Select your fleet segment.
(Fleet_segment1<-rep("GSA9_DTS_VL1218_OTB",length(year)))
(Fleet_segment2<-rep("GSA9_DTS_VL1824_OTB",length(year)))
(Fleet_segment3<-rep("GSA9_DTS_VL2440_OTB",length(year)))
(Fleet_segment<-c(Fleet_segment1,Fleet_segment2,Fleet_segment3))
(variable_name<-rep("fuelcosts",length(Fleet_segment)))
VL1218value<-1
VL1824value<-2
VL2440value<-3
(fuel_costs<-c(VL1218value,VL1824value,VL2440value)) # insert here the specific costs for each fleet segments that should be desegregated for example VL1218, VL1824 and VL2440
(value<-c(rep(VL1218value,length(year)),rep(VL1824value,length(year)),rep(VL2440value,length(year)))) # if the costs change by year add those manually
(fishing_tech<-rep("DTS",length(Fleet_segment)))
(vessel_length<-c(rep("VL1218",length(year)),rep("VL1824",length(year)),rep("VL2440",length(year))))
(DF_fuel<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))

# 2 labour_costs

(variable_name<-rep("labourcosts",length(Fleet_segment)))
VL1218value<-1
VL1824value<-2
VL2440value<-3
(labour_costs<-c(VL1218value,VL1824value,VL2440value)) # insert here the specific costs for each fleet segments that should be desegregated for example VL1218, VL1824 and VL2440
(value<-c(rep(VL1218value,length(year)),rep(VL1824value,length(year)),rep(VL2440value,length(year)))) # if the costs change by year add those manually
(fishing_tech<-rep("DTS",length(Fleet_segment)))
(vessel_length<-c(rep("VL1218",length(year)),rep("VL1824",length(year)),rep("VL2440",length(year))))


(DF_labour_costs<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))
  
# 3 othervariablecosts

(variable_name<-rep("othervariablecosts",length(Fleet_segment)))
VL1218value<-1
VL1824value<-2
VL2440value<-3
(other_costs<-c(VL1218value,VL1824value,VL2440value)) # insert here the specific costs for each fleet segments that should be desegregated for example VL1218, VL1824 and VL2440
(value<-c(rep(VL1218value,length(year)),rep(VL1824value,length(year)),rep(VL2440value,length(year)))) # if the costs change by year add those manually

(fishing_tech<-rep("DTS",length(Fleet_segment)))
(vessel_length<-c(rep("VL1218",length(year)),rep("VL1824",length(year)),rep("VL2440",length(year))))



(DF_other_costs<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))


(FINAL_NEW_DF<-rbind(DF_fuel,DF_labour_costs,DF_other_costs))
Costs_or<-FINAL_NEW_DF

#-------------------------------------------------------------------------------
# Creating the "Effort_Rev_metier.csv" data frame


(year<-c(2008:2020))
# Select your fleet segment.
(Fleet_segment1<-rep("GSA9_DTS_VL1218_OTB",length(year)))
(Fleet_segment2<-rep("GSA9_DTS_VL1824_OTB",length(year)))
(Fleet_segment3<-rep("GSA9_DTS_VL2440_OTB",length(year)))
(Fleet_segment<-c(Fleet_segment1,Fleet_segment2,Fleet_segment3))
(Fleet_segmentBIG<-c(Fleet_segment,Fleet_segment,Fleet_segment))
(Metier<-c(rep(rep("OTB_DES_>=40_0_0",length(year)),3),rep(rep("OTB_DWS_>=40_0_0",length(year)),3), rep(rep("OTB_MDD_>=40_0_0",length(year)),3)))
(FD_KW<-rep(rep(1:13,3),3)) # these numbers are just some example please insert your available data
(Lab_expl_var<-rep(rep(1:13,3),3)) # these numbers are just some example insert your available data
(vessel_length<-c(rep("VL1218",length(year)),rep("VL1824",length(year)), rep("VL2440",length(year))))
(vessel_length<-rep(vessel_length,3))
(year<-rep(year,3))
(year<-rep(year,3))
(gear<-rep("OTB",length(year)))
(DF_EFF<-data.frame(gear,vessel_length,year,Fleet_segmentBIG,Metier,FD_KW,Lab_expl_var))

Eff<-DF_EFF

# ------------------------------------------------------------------------------

(TC=unique(as.character(Costs_or$variable_name)))
for (ii in 1:length(TC)){
print(TC[ii])
  key_table=key_table_or[key_table_or$Type_of_cost==TC[ii],]  
  Costs=Costs_or[Costs_or$variable_name==TC[ii],]
  # check if the number of coefficients is correct
  
  fs=unique(key_table$Fleet_segment)
Costs_disag_total=Eff[1,]
Costs_disag_total$variable_name=Costs$variable_name[1]
Costs_disag_total$value=999
Costs_disag_total=Costs_disag_total[,c(1:5,8,9)]
Costs_disag_total1=Eff[1,]
Costs_disag_total1$variable_name=Costs$variable_name[1]
Costs_disag_total1$value=999
Costs_disag_total1=Costs_disag_total1[,c(1:5,8,9)]

#Costs_disag_total[1,]<-NA
  
  for (flee in 1:length(fs)){
    
    Costs_temp=Costs[Costs$ Fleet_segment==fs[flee],]
    Eff_temp=Eff[Eff$Fleet_segment==fs[flee],]
    key_table=key_table_or[key_table_or$Fleet_segment==fs[flee] & key_table_or$Type_of_cost==TC[ii],]
    # CHECKS
    YEARS_COSTS=unique(Costs_temp$year)
    YEARS_EFF= unique(Eff_temp$year)
    
    if(all(YEARS_COSTS)==all(YEARS_EFF))
    {
      print(fs[flee])
      print("All the years in Costs.csv file can be disaggregated",quote=F)
    } else {
      print(fs[flee])  
      print("The years in Costs.csv and in Effort.csv do not match. Only the data of the years present in both files will be disaggregated.",quote=F)
    }
    
    option=key_table[key_table$Fleet_segment==fs[flee],]$Option[1]  
    met1=unique(Eff[Eff$Fleet_segment==fs[flee],]$Metier)
    met_key=unique(key_table[key_table$Fleet_segment==fs[flee],])
    
    met_key=met_key[met_key$Explanatory_variable!="FD_KW",]$Explanatory_variable
    
    if((option == 1 | option == 2 ) & all(met1 %in% met_key)) {
      print(fs[flee],quote=F)
      print(paste("The disaggregation is possible with the provided data for",fs[flee]),quote=F)
    } else if (option == 3 & (length(met1)>=1)){
      print(fs[flee],quote=F)
      print(paste("The disaggregation is possible with the provided data for",fs[flee]),quote=F)
    } else {
      print(paste("The disaggregation is not possible with the provided data for",fs[flee]),". Please check if in the effort data all  years for each metier are provided.",quote=F)  
    }
    
  Costs_disag= Eff_temp[-c(ncol(Eff_temp)-1,ncol(Eff_temp))]
  Costs_disag$variable_name=Costs$variable_name[1]
  Costs_disag$value=999

  #metier=unique(Effort$Metier)
  
  if (Costs$variable_name[1]!="labourcosts"){
    
    for (i in 1:nrow(Costs_disag)){
      
      if (key_table$Option[1]==1){
        
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$FD_KW) ) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="FD_KW" & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient) )
        
      } else if (key_table$Option[1] ==2 & nrow(key_table[as.character(key_table$Explanatory_variable) ==paste("FD_KW*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),])==1) {
        
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i])& as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$FD_KW)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="FD_KW" & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient) ) +  as.numeric(as.character(Eff_temp[i,]$FD_KW)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) ==paste("FD_KW*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient))
        
      } else if ( (key_table$Option[1] ==2 & nrow(key_table[as.character(key_table$Explanatory_variable) ==paste("FD_KW*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),])==0) ) {
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$FD_KW)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="FD_KW",]$Coefficient))
      } else if ( key_table$Option[1] ==3){
        Costs_disag$value[i]= Eff_temp[i,]$FD_KW *  key_table[as.character(key_table$Explanatory_variable) =="FD_KW" & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient
      }
    }
  } else if (Costs_temp$variable_name[1]=="labourcosts"){
    
    for (i in 1:nrow(Costs_disag)){
      
      if (key_table$Option[1]==1){
        
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="Lab_expl_var" & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient))
        
      } else if (key_table$Option[1] ==2 & nrow(key_table[as.character(key_table$Explanatory_variable) ==paste("Lab_expl_var*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),])==1) {
        
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="Lab_expl_var" & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient))  +  as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) ==paste("Lab_expl_var*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient) )
        
      } else if ( (key_table$Option[1] ==2 & nrow(key_table[as.character(key_table$Explanatory_variable) ==paste("Lab_expl_var*",Costs_disag$Metier[i],sep="") & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),])==0) ) {
        Costs_disag$value[i]= as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient)) + as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable) =="Lab_expl_var",]$Coefficient))
      } else if ( key_table$Option[1] ==3){
        Costs_disag$value[i]= as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[ as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient))
        #Costs_disag$value[i]= as.numeric(as.character(Eff_temp[i,]$Lab_expl_var)) *  as.numeric(as.character(key_table[as.character(key_table$Explanatory_variable)==as.character(Costs_disag$Metier[i]) & as.character(key_table$Fleet_segment)==as.character(Costs_disag$Fleet_segment[i]),]$Coefficient))
        
        }
    }
  }
  Costs_disag_total= rbind(Costs_disag_total,Costs_disag)
  
  
  } 
            # "for" cycling on the fleet segment
  
  if(ii>=2){   
  Costs_disag_total=rbind(bkp,Costs_disag_total[-1,])
  
  }  else {
  Costs_disag_total=rbind(Costs_disag_total[-1,])
  }
   bkp=Costs_disag_total
# 
 

}  # close the type of costs "for"

write.table(Costs_disag_total,"Costs_disaggregated.csv",sep=";",row.names=F)
 print("Disaggregation executed.",quote=F)
```


```{r}
# now we need to run a check of the disaggregation 
library(tidyverse)
library(data.table)
library(readxl)
#Costs_FS = read.table("Costs_by_FS.csv",sep=",",header=T)
#Costs_MET = read.table("Costs_disaggregated.csv",sep=";",header=T)
Costs_MET<-Costs_disag_total
Costs_FS<-Costs_or
# Comparison between the costs by fleet segment and the sum of the costs disaggregated by metier

Costs_sum= aggregate(Costs_MET$value,by=list(Costs_MET$year, Costs_MET$Fleet_segment,Costs_MET$variable_name ),FUN="sum")
colnames(Costs_sum)=c("year","Fleet_segment","variable_name","Sum_costs_by_metier")

Merge=merge(Costs_sum,Costs_FS,by=c("year","Fleet_segment","variable_name") )[,c(1,2,3,4,7)]
colnames(Merge)=c("year","Fleet_segment","variable_name","Sum_costs_by_metier","Costs_by_fleet_segment")

Merge$DIFF= round((Merge$Sum_costs_by_metier -  Merge$Costs_by_fleet_segment)/ Merge$Costs_by_fleet_segment*100,1)

print(Merge)

write.table(Merge,"Consistency_checks.csv",sep=";",row.names=F)

# if the check is ok you can add the fleet segments that do not need disaggregation such as VL0612 and all PGP 
(year<-c(2008:2020))
# Select your fleet segment.
(Fleet_segment<-c( rep("GSA9_DTS_VL0612_OTB_DEF",length(year)),rep("GSA9_PGP_VL0012",length(year)),rep("GSA9_PGP_VL1218",length(year))))
(variable_name<-rep("fuelcosts",length(Fleet_segment)))
VL0612value<-1
VL0012PGPvalue<-2
VL1218PGPvalue<-3
(value<-c(rep(VL0612value,length(year)),rep(VL0012PGPvalue,length(year)) ,rep(VL1218PGPvalue,length(year)) )) # if the costs change by year add those manually
(fishing_tech<-c(rep("DTS",length(year)),rep("PGP",length(year)) ,rep("PGP",length(year))))
(vessel_length<-c(rep("VL0612",length(year)),rep("VL0012",length(year)) ,rep("VL1218",length(year)) )) 
(DF_fuel<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))

# 2 labour_costs

(variable_name<-rep("labourcosts",length(Fleet_segment)))
VL0612value<-1
VL0012PGPvalue<-2
VL1218PGPvalue<-3
(value<-c(rep(VL0612value,length(year)),rep(VL0012PGPvalue,length(year)),rep(VL1218PGPvalue,length(year)))) # if the costs change by year add those manually
(fishing_tech<-c(rep("DTS",length(year)),rep("PGP",length(year)),rep("PGP",length(year))    ))
(vessel_length<-c(rep("VL0612",length(year)),rep("VL0012",length(year)),rep("VL1218",length(year)) ) )
(DF_labour_costs<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))

# 3 other_variable costs

(variable_name<-rep("othervariablecosts",length(Fleet_segment)))
VL0612value<-1
VL0012PGPvalue<-2
VL1218PGPvalue<-3
(value<-c(rep(VL0612value,length(year)),rep(VL0012PGPvalue,length(year)), rep(VL1218PGPvalue,length(year)))) # if the costs change by year add those manually

(fishing_tech<-c(rep("DTS",length(year)),rep("PGP",length(year)) ,rep("PGP",length(year)) ))
(vessel_length<-c(rep("VL0612",length(year)),rep("VL0012",length(year)) ,rep("VL1218",length(year)) ))
(DF_other_costs<-data.frame(Fleet_segment,fishing_tech,vessel_length,year,variable_name,value))

(FINAL_NEW_DF_NO_DUP<-rbind(DF_fuel,DF_labour_costs,DF_other_costs))
FINAL_NEW_DF_NO_DUP$gear<-NA
FINAL_NEW_DF_NO_DUP$Metier<-NA
(FINAL_NEW_DF_NO_DUP<-FINAL_NEW_DF_NO_DUP[,c(1,3,4,5,6,7,8)])

# the following line are used for organizing the Fleet segments name + Metier lable 
#-----------------
(AAA<-separate(Costs_disag_total, col=Fleet_segmentBIG, into=c("A","B","C","D"), sep="_"))
(BBB<-separate(AAA, col=Metier, into=c("E","FF","G","H","I"), sep="_"))
BBB$FF[BBB$FF=="DES"]<-"DEF"
(BBB<-BBB[,c(1,2,3,4,5,6,7,9:14)])
(CCC<-BBB%>%unite("FS",c(A:FF), remove = F))
(CCC<-CCC[,c(1,2,3,4,8:14)])
(DDD<-CCC%>%unite("Metier",c(D:I), remove = T))
colnames(DDD)[4]<-"Fleet_segment"
(BIG_FINAL_UNITED<-rbind(DDD,FINAL_NEW_DF_NO_DUP))
(BIG_FINAL_UNITED<-BIG_FINAL_UNITED%>%arrange(year,Fleet_segment))
#-------------------


# the following lines are for the totalvariablecosts = fuelcosts + othervariablecost

(totalvariablecosts<-BIG_FINAL_UNITED%>%filter(variable_name%in%c("fuelcosts","othervariablecosts")))
(totalvariablecosts<-totalvariablecosts%>%
  group_by(gear,Fleet_segment,year,vessel_length,Metier)%>%
  summarise(value=sum(value)))
(totalvariablecosts$variable_name<-"totalvariablecosts")


# the following lines are for the revenues.discards.S1 normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("revenues.discards.S1",length(year)))
(value<-rep(0,length(year)))
(revenues.discards.S1<-data.frame(Fleet_segment,year,variable_name,value))


# the following lines are for the commercialcosts normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("commercialcosts",length(year)))
(value<-rep(0,length(year)))
(commercialcosts<-data.frame(Fleet_segment,year,variable_name,value))


# the following lines are for the essentialcosts normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("essentialcosts",length(year)))
(value<-rep(0,length(year)))
(essentialcosts<-data.frame(Fleet_segment,year,variable_name,value))

# the following lines are for the avoidablemaintenancecosts normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("avoidablemaintenancecosts",length(year)))
(value<-rep(0,length(year)))
(avoidablemaintenancecosts<-data.frame(Fleet_segment,year,variable_name,value))


# the following lines are for the unavoidablemaintenancecosts normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("unavoidablemaintenancecosts",length(year)))
(value<-rep(0,length(year)))
(unavoidablemaintenancecosts<-data.frame(Fleet_segment,year,variable_name,value))


# the following lines are for the otherincome normally = 0 
(year<-(2008:2020))
(Fleet_segment_uni<-unique(BIG_FINAL_UNITED$Fleet_segment))
(Fleet_segment<-rep(Fleet_segment_uni,length(year)))
(year<-rep(year,length(Fleet_segment_uni)))
(variable_name<-rep("otherincome",length(year)))
(value<-rep(0,length(year)))
(otherincome<-data.frame(Fleet_segment,year,variable_name,value))
(bigDF_of_0<-rbind(unavoidablemaintenancecosts,avoidablemaintenancecosts,essentialcosts,commercialcosts,revenues.discards.S1,otherincome))
```


```{r}
# The following lines are for the mantainance costs; otherfixedcosts; depreciationcosts; opportunitycosts; employment and capitalvalue extraction
 dir<-"D:/Andrea/Desktop/NEW_BEMTool/MapFS_2008_2018_Italy.xlsx" #this for data from 2008 to 2018

(data_2008<-read_xlsx(dir, sheet = 2)) 
(data_2009<-read_xlsx(dir, sheet = 3)) 
(data_2010<-read_xlsx(dir, sheet = 4)) 
(data_2011<-read_xlsx(dir, sheet = 5)) 
(data_2012<-read_xlsx(dir, sheet = 6)) 
(data_2013<-read_xlsx(dir, sheet = 7)) 
(data_2014<-read_xlsx(dir, sheet = 8))
(data_2015<-read_xlsx(dir, sheet = 9)) 
(data_2016<-read_xlsx(dir, sheet = 10)) 
(data_2017<-read_xlsx(dir, sheet = 11)) 
(data_2018<-read_xlsx(dir, sheet = 12)) 

(data_big<-rbind(data_2008,data_2009,data_2010,data_2011,data_2012,data_2013,data_2014,data_2015,data_2016,data_2017,data_2018))

###############################################################################
# GLOSSARY 
##############################################################################
# [Type of costs]	     [AER label]
#
# depreciation costs	totdepcost X
# other fixed costs	  totnovarcost X
# maintenance costs	  totrepcost X
# capital value	      totdeprep X
# opportunity costs	  capital value*(1+interest rate)/(1+inflation rate) -1
# employement	        totjob 
# other income	      tototherinc
# fuel costs	        totenercost
###############################################################################

```

```{r}
# With the following line we will extract the "depreciationcosts" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS
(depreciationcostDTS_NNDUP<-data_big%>%filter(ACRONYM=="totdepcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH=="VL0612"))
(depreciationcostDTS_NNDUP$metier<-"DEF")
(depreciationcostDTS_DUP<-data_big%>%filter(ACRONYM=="totdepcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH%in%c("VL1218","VL1824","VL2440")))

(depreciationcostDTS_DUP_DEF<-depreciationcostDTS_DUP)
(depreciationcostDTS_DUP_DEF$metier<-"DEF")

(depreciationcostDTS_DUP_DWS<-depreciationcostDTS_DUP)
(depreciationcostDTS_DUP_DWS$VALUE<-0)
(depreciationcostDTS_DUP_DWS$metier<-"DWS")

(depreciationcostDTS_DUP_MDD<-depreciationcostDTS_DUP)
(depreciationcostDTS_DUP_MDD$VALUE<-0)
(depreciationcostDTS_DUP_MDD$metier<-"MDD")

(depreciationcostDTS<-rbind(depreciationcostDTS_NNDUP,depreciationcostDTS_DUP_DEF,depreciationcostDTS_DUP_DWS,depreciationcostDTS_DUP_MDD))

depreciationcostDTS$GSA<-"GSA9"
depreciationcostDTS$OTB<-"OTB"
(depreciationcostDTS<-depreciationcostDTS[,c(5,7,8,10,9,4,1,2,3,6)])
(depreciationcostDTS<-unite(depreciationcostDTS,col="FS",c(GSA:metier), remove = T))


#PGP
(depreciationcostPGP_NNDUP1<-data_big%>%filter(ACRONYM=="totdepcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH%in%c("VL0006","VL0612")))
(depreciationcostPGP_NNDUP1<-depreciationcostPGP_NNDUP1%>%
    group_by(ACRONYM,UNIT,YEAR,GSA,SUPRA_REGION,FISHING_TECH)%>%
    summarise(VALUE=sum(VALUE)))
  
(depreciationcostPGP_NNDUP1$VESSEL_LENGTH<-"VL0012")
(depreciationcostPGP_NNDUP2<-data_big%>%filter(ACRONYM=="totdepcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH=="VL1218"))
(depreciationcostPGP_NNDUP<-rbind(depreciationcostPGP_NNDUP1,depreciationcostPGP_NNDUP2))
(depreciationcostPGP_NNDUP<-depreciationcostPGP_NNDUP[,c(4,6,8,3,1,2,5,7)])
depreciationcostPGP_NNDUP$GSA<-"GSA9"
(depreciationcostPGP_NNDUP<-unite(depreciationcostPGP_NNDUP, col="FS",c(GSA:VESSEL_LENGTH), remove = T))


(depreciationcost<-rbind(depreciationcostDTS,depreciationcostPGP_NNDUP))
(depreciationcost<-depreciationcost%>%arrange(YEAR,FS))

# please check if something is missing. In this case for examples the VL2440 in 2008 is missing and we duplicate the 2009 values
(depreciationcostX<-
  depreciationcost%>%
    filter(YEAR==2009 & FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_DWS","GSA9_DTS_VL2440_OTB_MDD")))
depreciationcostX$YEAR<-2008
(depreciationcost<-rbind(depreciationcostX,depreciationcost))
depreciationcost$ACRONYM<-"depreciationcosts"


# With the following line we will extract the "other fixed costs" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS
(other_fixed_costsDTS_NNDUP<-data_big%>%filter(ACRONYM=="totnovarcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH=="VL0612"))
(other_fixed_costsDTS_NNDUP$metier<-"DEF")
(other_fixed_costsDTS_DUP<-data_big%>%filter(ACRONYM=="totnovarcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH%in%c("VL1218","VL1824","VL2440")))

(other_fixed_costsDTS_DUP_DEF<-other_fixed_costsDTS_DUP)
(other_fixed_costsDTS_DUP_DEF$metier<-"DEF")

(other_fixed_costsDTS_DUP_DWS<-other_fixed_costsDTS_DUP)
(other_fixed_costsDTS_DUP_DWS$VALUE<-0)
(other_fixed_costsDTS_DUP_DWS$metier<-"DWS")

(other_fixed_costsDTS_DUP_MDD<-other_fixed_costsDTS_DUP)
(other_fixed_costsDTS_DUP_MDD$VALUE<-0)
(other_fixed_costsDTS_DUP_MDD$metier<-"MDD")

(other_fixed_costsDTS<-rbind(other_fixed_costsDTS_NNDUP,other_fixed_costsDTS_DUP_DEF,other_fixed_costsDTS_DUP_DWS,other_fixed_costsDTS_DUP_MDD))

other_fixed_costsDTS$GSA<-"GSA9"
other_fixed_costsDTS$OTB<-"OTB"
(other_fixed_costsDTS<-other_fixed_costsDTS[,c(5,7,8,10,9,4,1,2,3,6)])
(other_fixed_costsDTS<-unite(other_fixed_costsDTS,col="FS",c(GSA:metier), remove = T))


#PGP
(other_fixed_costsPGP_NNDUP1<-data_big%>%filter(ACRONYM=="totnovarcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH%in%c("VL0006","VL0612")))
(other_fixed_costsPGP_NNDUP1<-other_fixed_costsPGP_NNDUP1%>%
    group_by(ACRONYM,UNIT,YEAR,GSA,SUPRA_REGION,FISHING_TECH)%>%
    summarise(VALUE=sum(VALUE)))
  
(other_fixed_costsPGP_NNDUP1$VESSEL_LENGTH<-"VL0012")
(other_fixed_costsPGP_NNDUP2<-data_big%>%filter(ACRONYM=="totnovarcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH=="VL1218"))
(other_fixed_costsPGP_NNDUP<-rbind(other_fixed_costsPGP_NNDUP1,other_fixed_costsPGP_NNDUP2))
(other_fixed_costsPGP_NNDUP<-other_fixed_costsPGP_NNDUP[,c(4,6,8,3,1,2,5,7)])
other_fixed_costsPGP_NNDUP$GSA<-"GSA9"
(other_fixed_costsPGP_NNDUP<-unite(other_fixed_costsPGP_NNDUP, col="FS",c(GSA:VESSEL_LENGTH), remove = T))


(other_fixed_costs<-rbind(other_fixed_costsDTS,other_fixed_costsPGP_NNDUP))
(other_fixed_costs<-other_fixed_costs%>%arrange(YEAR,FS))

# please check if something is missing. In this case for examples the VL2440 in 2008 is missing and we duplicate the 2009 values
(other_fixed_costsX<-
  other_fixed_costs%>%
    filter(YEAR==2009 & FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_DWS","GSA9_DTS_VL2440_OTB_MDD")))
other_fixed_costsX$YEAR<-2008
(other_fixed_costs<-rbind(other_fixed_costsX,other_fixed_costs))
(other_fixed_costs<-other_fixed_costs%>%arrange(YEAR,FS))
other_fixed_costs$ACRONYM<-"otherfixedcosts"


# With the following line we will extract the "maintenance costs" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS

(maintenance_costsDTS_NNDUP<-data_big%>%filter(ACRONYM=="totrepcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH=="VL0612"))
(maintenance_costsDTS_NNDUP$metier<-"DEF")
(maintenance_costsDTS_DUP<-data_big%>%filter(ACRONYM=="totrepcost" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH%in%c("VL1218","VL1824","VL2440")))

(maintenance_costsDTS_DUP_DEF<-maintenance_costsDTS_DUP)
(maintenance_costsDTS_DUP_DEF$metier<-"DEF")

(maintenance_costsDTS_DUP_DWS<-maintenance_costsDTS_DUP)
(maintenance_costsDTS_DUP_DWS$VALUE<-0)
(maintenance_costsDTS_DUP_DWS$metier<-"DWS")

(maintenance_costsDTS_DUP_MDD<-maintenance_costsDTS_DUP)
(maintenance_costsDTS_DUP_MDD$VALUE<-0)
(maintenance_costsDTS_DUP_MDD$metier<-"MDD")

(maintenance_costsDTS<-rbind(maintenance_costsDTS_NNDUP,maintenance_costsDTS_DUP_DEF,maintenance_costsDTS_DUP_DWS,maintenance_costsDTS_DUP_MDD))

maintenance_costsDTS$GSA<-"GSA9"
maintenance_costsDTS$OTB<-"OTB"
(maintenance_costsDTS<-maintenance_costsDTS[,c(5,7,8,10,9,4,1,2,3,6)])
(maintenance_costsDTS<-unite(maintenance_costsDTS,col="FS",c(GSA:metier), remove = T))


#PGP
(maintenance_costsPGP_NNDUP1<-data_big%>%filter(ACRONYM=="totrepcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH%in%c("VL0006","VL0612")))
(maintenance_costsPGP_NNDUP1<-maintenance_costsPGP_NNDUP1%>%
    group_by(ACRONYM,UNIT,YEAR,GSA,SUPRA_REGION,FISHING_TECH)%>%
    summarise(VALUE=sum(VALUE)))
  
(maintenance_costsPGP_NNDUP1$VESSEL_LENGTH<-"VL0012")
(maintenance_costsPGP_NNDUP2<-data_big%>%filter(ACRONYM=="totrepcost" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH=="VL1218"))
(maintenance_costsPGP_NNDUP<-rbind(maintenance_costsPGP_NNDUP1,maintenance_costsPGP_NNDUP2))
(maintenance_costsPGP_NNDUP<-maintenance_costsPGP_NNDUP[,c(4,6,8,3,1,2,5,7)])
maintenance_costsPGP_NNDUP$GSA<-"GSA9"
(maintenance_costsPGP_NNDUP<-unite(maintenance_costsPGP_NNDUP, col="FS",c(GSA:VESSEL_LENGTH), remove = T))


(maintenance_costs<-rbind(maintenance_costsDTS,maintenance_costsPGP_NNDUP))
(maintenance_costs<-maintenance_costs%>%arrange(YEAR,FS))

# please check if something is missing. In this case for examples the VL2440 in 2008 is missing and we duplicate the 2009 values
(maintenance_costsX<-
  maintenance_costs%>%
    filter(YEAR==2009 & FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_DWS","GSA9_DTS_VL2440_OTB_MDD")))
maintenance_costsX$YEAR<-2008
(maintenance_costs<-rbind(maintenance_costsX,maintenance_costs))
(maintenance_costs<-maintenance_costs%>%arrange(YEAR,FS))
maintenance_costs$ACRONYM<-"maintenancecosts"

# With the following line we will extract the "Capital value" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS

(Capital_valueDTS_NNDUP<-data_big%>%filter(ACRONYM=="totdeprep" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH=="VL0612"))
(Capital_valueDTS_NNDUP$metier<-"DEF")
(Capital_valueDTS_DUP<-data_big%>%filter(ACRONYM=="totdeprep" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH%in%c("VL1218","VL1824","VL2440")))

(Capital_valueDTS_DUP_DEF<-Capital_valueDTS_DUP)
(Capital_valueDTS_DUP_DEF$metier<-"DEF")

(Capital_valueDTS_DUP_DWS<-Capital_valueDTS_DUP)
(Capital_valueDTS_DUP_DWS$VALUE<-0)
(Capital_valueDTS_DUP_DWS$metier<-"DWS")

(Capital_valueDTS_DUP_MDD<-Capital_valueDTS_DUP)
(Capital_valueDTS_DUP_MDD$VALUE<-0)
(Capital_valueDTS_DUP_MDD$metier<-"MDD")

(Capital_valueDTS<-rbind(Capital_valueDTS_NNDUP,Capital_valueDTS_DUP_DEF,Capital_valueDTS_DUP_DWS,Capital_valueDTS_DUP_MDD))

Capital_valueDTS$GSA<-"GSA9"
Capital_valueDTS$OTB<-"OTB"
(Capital_valueDTS<-Capital_valueDTS[,c(5,7,8,10,9,4,1,2,3,6)])
(Capital_valueDTS<-unite(Capital_valueDTS,col="FS",c(GSA:metier), remove = T))


#PGP
(Capital_valuePGP_NNDUP1<-data_big%>%filter(ACRONYM=="totdeprep" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH%in%c("VL0006","VL0612")))
(Capital_valuePGP_NNDUP1<-Capital_valuePGP_NNDUP1%>%
    group_by(ACRONYM,UNIT,YEAR,GSA,SUPRA_REGION,FISHING_TECH)%>%
    summarise(VALUE=sum(VALUE)))
  
(Capital_valuePGP_NNDUP1$VESSEL_LENGTH<-"VL0012")
(Capital_valuePGP_NNDUP2<-data_big%>%filter(ACRONYM=="totdeprep" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH=="VL1218"))
(Capital_valuePGP_NNDUP<-rbind(Capital_valuePGP_NNDUP1,Capital_valuePGP_NNDUP2))
(Capital_valuePGP_NNDUP<-Capital_valuePGP_NNDUP[,c(4,6,8,3,1,2,5,7)])
Capital_valuePGP_NNDUP$GSA<-"GSA9"
(Capital_valuePGP_NNDUP<-unite(Capital_valuePGP_NNDUP, col="FS",c(GSA:VESSEL_LENGTH), remove = T))


(Capital_value<-rbind(Capital_valueDTS,Capital_valuePGP_NNDUP))
(Capital_value<-Capital_value%>%arrange(YEAR,FS))

# please check if something is missing. In this case for examples the VL2440 in 2008 is missing and we duplicate the 2009 values
(Capital_valueX<-Capital_value%>%
    filter(YEAR==2009 & FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_DWS","GSA9_DTS_VL2440_OTB_MDD")))
Capital_valueX$YEAR<-2008
(Capital_value<-rbind(Capital_valueX,Capital_value))
(Capital_value<-Capital_value%>%arrange(YEAR,FS))
Capital_value$ACRONYM<-"capitalvalue"

# With the following line we will extract the "opportunity costs == capital value*(1+interest rate)/(1+inflation rate) -1" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS

###############################################################################################
# please insert below the inflation and interest rate of the country you are dealing with. 

#-------------- I T A L Y --------------

#interest rate ITA 2008- 2020 FROM https://data.worldbank.org/indicator/FR.INR.RINR?locations=IT
intr<-c(4.33,	 3.03,	3.58,	2.94,	3.62,	3.95,	3.92,	3.17,	2.34,	2.26,	1.59)/100  #,	1.67,	1.15 = ( 2019, 2020)
intr = as.data.frame(intr)
intr$year = c(2008:2018)

# inflation rate ITA 2008-2021 FROM https://data.worldbank.org/indicator/FP.CPI.TOTL.ZG?locations=IT

inflr<-c(3.35,	0.77,	1.53,	2.78,	3.04,	1.22,	0.24,	0.04,	-0.09,	1.23,	1.14)/100 #,	0.61,	-0.14,	1.87 = ( 2019, 2020, 2021)
inflr = as.data.frame(inflr)
inflr$year = c(2008:2018)
# ------------------------------------
#########################################################

 DF<-data.frame( 
                FS=Capital_value$FS,
                YEAR=Capital_value$YEAR,
                ACRONYM=Capital_value$ACRONYM,
                VALUE=integer(length(Capital_value)),
                UNIT=Capital_value$UNIT,
                SUPRA_REGION=Capital_value$SUPRA_REGION,
                stringsAsFactors = FALSE)

               a=1 
   for (a in 1:nrow(DF)){
    DF$VALUE[a]<- Capital_value$VALUE[a]*(1+intr[intr$year==DF[a,"YEAR"],"year"])/(1+inflr[inflr$year==DF[a,"YEAR"],"year"]) - 1
    
   }
DF$ACRONYM<-"opportunity_costs"

opportunity_costs<-DF
opportunity_costs$ACRONYM<-"opportunitycosts"

# With the following line we will extract the "employement" ad split it by Metier. All the value is assigned to DEF, DWS and MDD will be = 0.
#DTS

(employementDTS_NNDUP<-data_big%>%filter(ACRONYM=="totjob" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH=="VL0612"))
(employementDTS_NNDUP$metier<-"DEF")
(employementDTS_DUP<-data_big%>%filter(ACRONYM=="totjob" & GSA=="9" & FISHING_TECH=="DTS" & VESSEL_LENGTH%in%c("VL1218","VL1824","VL2440")))

(employementDTS_DUP_DEF<-employementDTS_DUP)
(employementDTS_DUP_DEF$metier<-"DEF")

(employementDTS_DUP_DWS<-employementDTS_DUP)
(employementDTS_DUP_DWS$VALUE<-0)
(employementDTS_DUP_DWS$metier<-"DWS")

(employementDTS_DUP_MDD<-employementDTS_DUP)
(employementDTS_DUP_MDD$VALUE<-0)
(employementDTS_DUP_MDD$metier<-"MDD")

(employementDTS<-rbind(employementDTS_NNDUP,employementDTS_DUP_DEF,employementDTS_DUP_DWS,employementDTS_DUP_MDD))

employementDTS$GSA<-"GSA9"
employementDTS$OTB<-"OTB"
(employementDTS<-employementDTS[,c(5,7,8,10,9,4,1,2,3,6)])
(employementDTS<-unite(employementDTS,col="FS",c(GSA:metier), remove = T))


#PGP
(employementPGP_NNDUP1<-data_big%>%filter(ACRONYM=="totjob" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH%in%c("VL0006","VL0612")))
(employementPGP_NNDUP1<-employementPGP_NNDUP1%>%
    group_by(ACRONYM,UNIT,YEAR,GSA,SUPRA_REGION,FISHING_TECH)%>%
    summarise(VALUE=sum(VALUE)))
  
(employementPGP_NNDUP1$VESSEL_LENGTH<-"VL0012")
(employementPGP_NNDUP2<-data_big%>%filter(ACRONYM=="totjob" & GSA=="9" & FISHING_TECH=="PGP" & VESSEL_LENGTH=="VL1218"))
(employementPGP_NNDUP<-rbind(employementPGP_NNDUP1,employementPGP_NNDUP2))
(employementPGP_NNDUP<-employementPGP_NNDUP[,c(4,6,8,3,1,2,5,7)])
employementPGP_NNDUP$GSA<-"GSA9"
(employementPGP_NNDUP<-unite(employementPGP_NNDUP, col="FS",c(GSA:VESSEL_LENGTH), remove = T))


(employement<-rbind(employementDTS,employementPGP_NNDUP))
(employement<-employement%>%arrange(YEAR,FS))

# please check if something is missing. In this case for examples the VL2440 in 2008 is missing and we duplicate the 2009 values
(employementX<-
  employement%>%
    filter(YEAR==2009 & FS%in%c("GSA9_DTS_VL2440_OTB_DEF","GSA9_DTS_VL2440_OTB_DWS","GSA9_DTS_VL2440_OTB_MDD")))
employementX$YEAR<-2008
(employement<-rbind(employementX,employement))
(employement<-employement%>%arrange(YEAR,FS))
employement$ACRONYM<-"employement"

# With the following line we will extract the "total fixed costs" which are equal to otherfixedcosts 

total_fixed_costs<-other_fixed_costs
total_fixed_costs$ACRONYM<-"totalfixedcosts"

# With the following line we will extract the "totalcapitalcosts"
(total_capital_costs<-rbind(opportunity_costs,depreciationcost))
(total_capital_costs<-total_capital_costs%>%group_by(FS,YEAR,UNIT,SUPRA_REGION)%>%
  summarise(VALUE=sum(VALUE)))
total_capital_costs$ACRONYM<-"totalcapitalcosts"


#### Now you can add all the costs DFs(ALLDATAFD,LAND_TOTAL_DF_ALLSPEC,REV_TOTAL_DF_ALLSPEC,REV_TOTAL_DF_MUT,BIG_FINAL_UNITED,totalvariablecosts) in a single Big One 
 unique(ALLDATAFD$FS)
 unique(LAND_TOTAL_DF_ALLSPEC$FS)
 unique(REV_TOTAL_DF_ALLSPEC$FS)
 unique(REV_TOTAL_DF_MUT$FS)
 
 
 unique(BIG_FINAL_UNITED$Fleet_segment)
 colnames(BIG_FINAL_UNITED)[4]<-"FS"
 unique(totalvariablecosts$Fleet_segment)
 colnames(totalvariablecosts)[2]<-"FS"

(DF6costs<-bigDF_of_0)
colnames(DF6costs)[1]<-"FS"
#unique(DF6costs$Fleet_segment)

#
(DF8costs<-rbind(depreciationcost, other_fixed_costs, maintenance_costs, Capital_value, opportunity_costs,employement,total_fixed_costs,total_capital_costs))

unique(DF8costs$FS)

DF8costs<-DF8costs[,c(1:4)]
colnames(DF8costs)[2]<-"year"
colnames(DF8costs)[3]<-"variable_name"
colnames(DF8costs)[4]<-"value"

COST1<-rbind(DF6costs,DF8costs) # THE BIG ONE 

(totalvariablecosts2<-totalvariablecosts[,c(2,3,6,7)])
COST1<-rbind(COST1,totalvariablecosts2)
(BIG_FINAL_UNITED2<-BIG_FINAL_UNITED[,c(4,3,6,7)])
COST2<-rbind(COST1,BIG_FINAL_UNITED2)
REV_TOTAL_DF_MUT$variable_name<-"totalrevenues_S1"
colnames(REV_TOTAL_DF_MUT)[3]<-"value"
COST3<-rbind(COST2,REV_TOTAL_DF_MUT)
REV_TOTAL_DF_ALLSPEC$variable_name<-"totalrevenues"
colnames(REV_TOTAL_DF_ALLSPEC)[3]<-"value"
COST4<-rbind(COST3,REV_TOTAL_DF_ALLSPEC)
colnames(LAND_TOTAL_DF_ALLSPEC)[3]<-"value"
LAND_TOTAL_DF_ALLSPEC$variable_name<-"totallandings"
COST5<-rbind(COST4,LAND_TOTAL_DF_ALLSPEC)
ALLDATAFD$variable_name<-"maxseadays"
COST6<-rbind(COST5,ALLDATAFD)


(COST6<-COST6%>%
  filter(FS!="GSA9_DTS_VL2440_OTB_DWS"))

unique(COST6$variable_name) # should be 22
unique(COST6$FS)

rm(list=setdiff(ls(), "COST6"))
COST6

colnames(COST6)[3]<-"variable_code"

(COST6A<-COST6%>%filter(variable_code%in%c("revenues.discards.S1","totalrevenues_S1")))
COST6A$species<-"MUT"
(COST6B<-COST6%>%filter(!variable_code%in%c("revenues.discards.S1","totalrevenues_S1")))
COST6B$species<-"ALL"
(COST6<-rbind(COST6A,COST6B))
(COST6<-COST6%>%arrange(year,FS))


(Fleet_segments <- sort(unique(COST6$FS)))

FS_ready <- Fleet_segments 

ts<-c(2008:2020)

trans_year=c(2020,2021)

#data_frame <- COST6



FirstColumn= c("casestudy.maxavgseadays",
             "casestudy.totallandings", # DA FDI
             "casestudy.revenues.S1",# DA FDI
             "casestudy.totalrevenues",# DA FDI
             "casestudy.revenues.discard.S1",
             "casestudy.fuelcosts",
             "casestudy.commercialcosts",
             "casestudy.othervariablecosts",
             "casestudy.totalvariablecosts",
             "casestudy.maintenancecosts",
             "casestudy.otherfixedcosts",
             "casestudy.essentialcosts",
             "casestudy.avoidablemaintenancecosts",
             "casestudy.unavoidablemaintenancecosts",
             "casestudy.totalfixedcosts",
             "casestudy.labourcosts",
             "casestudy.depreciationcosts",
             "casestudy.opportunitycosts",
             "casestudy.totalcapitalcosts",
             "casestudy.otherincome",
             "casestudy.employment",
             "casestudy.capitalvalue")



stks=c("MUT")
(nb_stk=length(stks))

DFTOT<-list()
rm(x)
x=2
for (x in 1:length(FS_ready)){

{

   (DF0=as.data.frame(matrix(0,nrow=(20+2*nb_stk),ncol=length(ts))))
   (colnames(DF0)=ts)
   (data_frame1=COST6[COST6$FS==FS_ready[x],])

ty=1
#------------------------------
#maxseadays
(data_frame=data_frame1[data_frame1$variable_code=="maxseadays",] )

if (nrow(data_frame)>0){
  (data_frame=data_frame[as.character(data_frame$value)!="NULL",])
  
  for (rr in 1:nrow(data_frame)){
    
   ( year=data_frame$year[rr] )
   ( DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
    
  }
  
} else {
  DF0[ty,]=0  
}

ty=2
#------------------------------
#total landing
(data_frame=data_frame1[data_frame1$variable_code=="totallandings",] )

if (nrow(data_frame)>0){
    (data_frame=data_frame[as.character(data_frame$value)!="NULL",])

  for (rr in 1:nrow(data_frame)){
    
    (year=data_frame$year[rr] )
    (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
    DF0[ty,]<-round(as.numeric(DF0[ty,],0))
  }

} else {
  DF0[ty,]=0  
  
}
##----------------------------
for (st in 1:nb_stk) {
ty=3 + (st-1) 
#revenues by stock

(data_frame<-data_frame1%>%filter(variable_code=="totalrevenues_S1" & species==stks[st]))

if (nrow(data_frame)>0){
  data_frame=data_frame[as.character(data_frame$value)!="NULL",]
  
 # (FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
  
  #(colnames(FDI_data_temp)=c("FS","year","value"))
  
  for (rr in 1:nrow(data_frame)){
    
   ( year=data_frame$year[rr] )
   ( DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
     DF0[ty,]<-round(as.numeric(DF0[ty,],0))
  }
  
} else {
  DF0[ty,]=0  
}

}

#------------------------------
  ty=3 + st
  #total revenues by stock all species
  (data_frame<-data_frame1%>%filter(variable_code=="totalrevenues" ))


  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------
  ty=4 + st
  # revenues.discards.S1 

  (data_frame<-data_frame1%>%filter(variable_code=="revenues.discards.S1" & species==stks[st]))


  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#----------------------------------------------------------
  ty=5 + st
  # fuelcosts

  (data_frame<-data_frame1%>%filter(variable_code=="fuelcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }

#------------------------------
  ty=6 + st
  # commercialcosts

  (data_frame<-data_frame1%>%filter(variable_code=="commercialcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
# --------------------------------------
  ty=7 + st
  # othervariablecosts

  (data_frame<-data_frame1%>%filter(variable_code=="othervariablecosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=8 + st
  # totalvariablecosts

  (data_frame<-data_frame1%>%filter(variable_code=="totalvariablecosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=9 + st
  # maintenancecosts

  (data_frame<-data_frame1%>%filter(variable_code=="maintenancecosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------


  ty=10 + st
  # otherfixedcosts

  (data_frame<-data_frame1%>%filter(variable_code=="otherfixedcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------


  ty=11 + st
  # essentialcosts

  (data_frame<-data_frame1%>%filter(variable_code=="essentialcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }

#------------------------------

  ty=12 + st
  # avoidablemaintenancecosts

  (data_frame<-data_frame1%>%filter(variable_code=="avoidablemaintenancecosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }

#------------------------------


  ty=13 + st
  # unavoidablemaintenancecosts

  (data_frame<-data_frame1%>%filter(variable_code=="unavoidablemaintenancecosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------


  ty=14 + st
  # totalfixedcosts 

  (data_frame<-data_frame1%>%filter(variable_code=="totalfixedcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }


#------------------------------

  ty=15 + st
  # labourcosts 

  (data_frame<-data_frame1%>%filter(variable_code=="labourcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }

#------------------------------
  ty=16 + st
  # depreciationcosts 

  (data_frame<-data_frame1%>%filter(variable_code=="depreciationcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=17 + st
  # opportunitycosts 

  (data_frame<-data_frame1%>%filter(variable_code=="opportunitycosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }

#------------------------------

  ty=18 + st
  # totalcapitalcosts 

  (data_frame<-data_frame1%>%filter(variable_code=="totalcapitalcosts" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=19 + st
  # otherincome 

  (data_frame<-data_frame1%>%filter(variable_code=="otherincome" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=20 + st
  # employment 

  (data_frame<-data_frame1%>%filter(variable_code=="employment" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
#------------------------------

  ty=21 + st
  # capitalvalue 

  (data_frame<-data_frame1%>%filter(variable_code=="capitalvalue" ))

  if (nrow(data_frame)>0){
    
   #( FDI_data_temp=aggregate(as.numeric(FDI_data_temp$totvallandg),by=list(FDI_data_temp$FS,FDI_data_temp$year),FUN="sum"))
    
    #colnames(FDI_data_temp)=c("FS","year","value")
    
    for (rr in 1:nrow(data_frame)){
      
      (year=data_frame$year[rr] )
      (DF0[ty,colnames(DF0)==year]=data_frame$value[rr])
       DF0[ty,]<-round(as.numeric(DF0[ty,],0))
    }
    
  } else {
    DF0[ty,]=0  
    
  }
DFTOT[[x]]<-DF0
}
  
}

FINALDF<-do.call(cbind, DFTOT)
(rownames(FINALDF)<-FirstColumn)


(DFhead=as.data.frame(matrix(NA, nrow=4, ncol=length(FINALDF))))
(colnames(DFhead)=colnames(FINALDF))
(rownames(DFhead)<-c("Units: days","casestudy.fleetsegmentcode","casestudy.fishingtechnique","casestudy.loa"))
DFhead[1,]<-colnames(FINALDF)
DFhead[2,]<-rep(FS_ready,each=length(ts))

(TIME_SERIES<-rbind(DFhead,FINALDF))


(dir1="C:/INPUT")
write.table(TIME_SERIES,paste(dir1,"/TS.csv",sep=""),sep=";",row.names=T, col.names = F) 


```



\textbf{bmt-config-Forecast.csv}
1) we need a script for coefficient calculation at metier level (to utse date from BEMTool Economic Output)

Note: I created this file manually 



```{r}
library(tidyverse)
library(data.table)
library(readxl)

#TS=read.table(paste(dir4,"/",SCENARIO_1,"/Economic output/",SCENARIO_1,".csv",sep=""),sep=";",row.names=F)  

# data input you need 
(data_start<-read.csv("C:/OUTPUT/Diagnosis/GSA171819 - Economic output.csv",sep=";", header=T))
(data2020<-data_start%>%filter(Year=="2020" ))
data<-data2020
############################### prepare your vessel Data Frame #############################
#now you can select your sub Country, sub region and Fishing technique. If you like you cold also add a filter of specific years such us year==c(2017:2019)

data[is.na(data)] <- 0
data["Value"][data["Value"]=="NK"] <- 0
data["Value"][data["Value"]=="Inf"] <- 0
data["Value"][data["Value"]=="NaN"] <- 0
data["Value"][data["Value"]=="N"] <- 0
data<-data%>%filter(Fleet_segment!="ALL")

data$Value<-as.numeric(data$Value)

(vessels<-data%>%
    filter(Variable=="VESSELS.annual")%>%
    group_by(Fleet_segment,Variable)%>%
    summarise(N_vessels=mean(as.numeric((Value)))))


############################### prepare your GT #############################
(GT<-data%>%
  filter(Variable=="GT.annual")%>%
  group_by(Fleet_segment,Variable)%>%
  summarise(GT=mean(as.numeric(Value))))

unique(data$Variable)


############################### prepare your days at sea #############################
(days_at_sea<-data%>%
  filter(Variable=="DAYS.annual")%>%
  group_by(Fleet_segment,Variable)%>%
  summarise(days_at_sea=mean(as.numeric(Value))))



```


```{r}
# Here i need to specify the tot_landing and revenues by each species S1 S2 S3 S4 etc in the correct order
# check the BTconfig for the species number order

#  LANDINGS
dataA<-data %>%
  filter(!Variable%in%c("landing.weight","revenues.landing"))

dataB<-data %>%
  filter(Variable=="landing.weight" )


(dataB2<-unite(dataB, col="landing_weight_X",c(Variable,Species), remove = F))

dataB2[dataB2=="landing.weight_S. sol17" ]<- "tot_landing_S1"
dataB2[dataB2=="landing.weight_M. mer1718"  ]<- "tot_landing_S2"
dataB2[dataB2=="landing.weight_M. bar_1718" ]<- "tot_landing_S3"
dataB2[dataB2=="landing.weight_N. nor1718" ]<- "tot_landing_S4"
dataB2[dataB2=="landing.weight_P. lon171819" ]<- "tot_landing_S5"
unique(dataB2$landing_weight_X)

(dataB2<-dataB2[,c(1:7,9:11)])
colnames(dataB2)[5]<-"Variable"

# REVENUES

dataC<-data %>%
  filter(Variable=="revenues.landing" )


(dataC2<-unite(dataC, col="revenues.landing_X",c(Variable,Species), remove = F))
unique(dataC2$revenues.landing_X)

dataC2[dataC2=="revenues.landing_S. sol17" ]<- "revenues_S1"
dataC2[dataC2=="revenues.landing_M. mer1718"  ]<- "revenues_S2"
dataC2[dataC2=="revenues.landing_M. bar_1718" ]<- "revenues_S3"
dataC2[dataC2=="revenues.landing_N. nor1718" ]<- "revenues_S4"
dataC2[dataC2=="revenues.landing_P. lon171819" ]<- "revenues_S5"
unique(dataC2$revenues.landing_X)

(dataC2<-dataC2[,c(1:7,9:11)])
colnames(dataC2)[5]<-"Variable"


(data<-rbind(dataA,dataB2,dataC2))


# select the period/single years of your economic values that will be used for the forecast

(years<-c(2004:2020)) # I need this amount of year to be sure I got all the variables I need

unique(data$Year)

(data1<-data%>%
  filter(Year%in%years)%>%
  spread(Variable,Value))
colnames(data1)

```
```{r}
# the name should be corrected and spaces removed
# pay attention and check if the connection by names is correct

colnames(data1)[10]<-"depreciation_costs"
colnames(data1)[11]<-"opportunity_cost"
colnames(data1)[13]<-"capital_value"
colnames(data1)[14]<-"max_days_at_sea" 
colnames(data1)[35]<-"maintenance_costs"
colnames(data1)[36]<-"other_fix_cost"
colnames(data1)[42]<-"GT"
colnames(data1)[50]<-"labour_cost"
colnames(data1)[75]<-"tot_landing"
colnames(data1)[77]<-"total_revenues_discard"
colnames(data1)[78]<-"tot_revenues_landing"
colnames(data1)[80]<-"fuel_cost"
colnames(data1)[81]<-"other_var_cost"
colnames(data1)[82]<-"tot_var_cost"
colnames(data1)[32]<-"employment"


# capital.cost[depreciation] = depreciation_costs
# capital.cost[interest]     = opportunity_cost
# capital.value              = capital_value
# DAYS.annual                = max_days_at_sea

```


```{r}
# here select the values you need only. 
(data2<-data1[,c(4,6,7,10,11,13,14,35,36,42,50,58:64,75,67:71,77,78,80,81,82,32)])

data2[is.na(data2)] <- 0

data2$opportunity_cost<-as.numeric(data2$opportunity_cost)
data2$depreciation_costs<-as.numeric(data2$depreciation_costs)
data2$capital_value<-as.numeric(data2$capital_value)
data2$max_days_at_sea<-as.numeric(data2$max_days_at_sea)
data2$maintenance_costs<-as.numeric(data2$maintenance_costs)
data2$other_fix_cost<-as.numeric(data2$other_fix_cost)
data2$GT<-as.numeric(data2$GT)
data2$labour_cost<-as.numeric(data2$labour_cost)

```
```{r}

data2$tot_landing_S1<-as.numeric(data2$tot_landing_S1)
data2$tot_landing_S2<-as.numeric(data2$tot_landing_S2)
data2$tot_landing_S3<-as.numeric(data2$tot_landing_S3)
data2$tot_landing_S4<-as.numeric(data2$tot_landing_S4)
data2$tot_landing_S5<-as.numeric(data2$tot_landing_S5)

```
```{r}

data2$revenues_S1<-as.numeric(data2$revenues_S1)
data2$revenues_S2<-as.numeric(data2$revenues_S2)
data2$revenues_S3<-as.numeric(data2$revenues_S3)
data2$revenues_S4<-as.numeric(data2$revenues_S4)
data2$revenues_S5<-as.numeric(data2$revenues_S5)

data2$tot_landing<-as.numeric(data2$tot_landing)

data2$tot_revenues_landing<-as.numeric(data2$tot_revenues_landing)
data2$total_revenues_discard<-as.numeric(data2$total_revenues_discard)

data2$fuel_cost<-as.numeric(data2$fuel_cost)
data2$other_var_cost<-as.numeric(data2$other_var_cost)
data2$tot_var_cost<-as.numeric(data2$tot_var_cost)
data2$employment<-as.numeric(data2$employment)

# if you like you could also add a filter by specific year such as : %>%(filter(year==c(2007:2019)))%>%group_by...

# calculate the meand values you need 

(data3<-data2%>%group_by(Fleet_segment)%>%summarise(opportunity_cost=mean(opportunity_cost),
                                                    depreciation_costs=mean(depreciation_costs),
                                                    capital_value=mean(capital_value),
                                                    max_days_at_sea=mean(max_days_at_sea),
                                                    maintenance_costs=mean(maintenance_costs),
                                                    other_fix_cost=mean(other_fix_cost),
                                                    GT=mean(GT),
                                                    labour_cost=mean(labour_cost),
                                                    
                                                    tot_landing_S1=mean(tot_landing_S1),
                                                    tot_landing_S2=mean(tot_landing_S2),
                                                    tot_landing_S3=mean(tot_landing_S3),
                                                    tot_landing_S4=mean(tot_landing_S4),
                                                    tot_landing_S5=mean(tot_landing_S5),
                                                    
                                                    
                                                    revenues_S1=mean(revenues_S1),
                                                    revenues_S2=mean(revenues_S2),
                                                    revenues_S3=mean(revenues_S3),
                                                    revenues_S4=mean(revenues_S4),
                                                    revenues_S5=mean(revenues_S5),
                                                    
                                                    tot_revenues_landing=mean(tot_revenues_landing),
                                                    total_revenues_discard=mean(total_revenues_discard),
                                                    
                                                    fuel_cost=mean(fuel_cost),
                                                    other_var_cost=mean(other_var_cost),
                                                    tot_var_cost=mean(tot_var_cost),
                                                    tot_landing=mean(tot_landing),
                                                    employment=mean(employment)))
```


```{r}
# data3<-data3[-1,]
# data3<-data3[c(2:16,1),]                                               

(fleet_segments <-c(unique(data$Fleet_segment)))
```
```{r}
(economic_values = c("coeff_fuel_cost",
                     "othervariablecosts_coeff",
                     "maintenancecosts_coeff",
                     "otherfixed_cost",
                     "depreciationcosts_coeff",
                     "opportunitycosts_coeff",
                     "correc_factor_for_land",
                     "correc_factor_for_rev",
                     "value_of_single_vessel",
                     "average_employees_per_vessel",
                     "crew_share"))


 (DF0=matrix(0,nrow=length(economic_values),ncol=length(fleet_segments)))
 (colnames(DF0)=fleet_segments)
 (rownames(DF0)=economic_values)
  DF0<-as.data.frame(DF0)
  
  #fuel_cost
 (DF0[1,1]<-data3[1,22]/(vessels[1,3]*days_at_sea[1,3]))
 (DF0[1,2]<-data3[2,22]/(vessels[2,3]*days_at_sea[2,3]))
 (DF0[1,3]<-data3[3,22]/(vessels[3,3]*days_at_sea[3,3]))
 (DF0[1,4]<-data3[4,22]/(vessels[4,3]*days_at_sea[4,3]))
 (DF0[1,5]<-data3[5,22]/(vessels[5,3]*days_at_sea[5,3]))
 (DF0[1,6]<-data3[6,22]/(vessels[6,3]*days_at_sea[6,3]))
 (DF0[1,7]<-data3[7,22]/(vessels[7,3]*days_at_sea[7,3]))
 (DF0[1,8]<-data3[8,22]/(vessels[8,3]*days_at_sea[8,3]))
 (DF0[1,9]<-data3[9,22]/(vessels[9,3]*days_at_sea[9,3]))
 (DF0[1,10]<-data3[10,22]/(vessels[10,3]*days_at_sea[10,3]))
 (DF0[1,11]<-data3[11,22]/(vessels[11,3]*days_at_sea[11,3]))
 (DF0[1,12]<-data3[12,22]/(vessels[12,3]*days_at_sea[12,3]))
 (DF0[1,13]<-data3[13,22]/(vessels[13,3]*days_at_sea[13,3]))
 (DF0[1,14]<-data3[14,22]/(vessels[14,3]*days_at_sea[14,3]))
 (DF0[1,15]<-data3[15,22]/(vessels[15,3]*days_at_sea[15,3]))
 (DF0[1,16]<-data3[16,22]/(vessels[16,3]*days_at_sea[16,3]))
 (DF0[1,17]<-data3[17,22]/(vessels[17,3]*days_at_sea[17,3]))
 (DF0[1,18]<-data3[18,22]/(vessels[18,3]*days_at_sea[18,3]))
 (DF0[1,19]<-data3[19,22]/(vessels[19,3]*days_at_sea[19,3])) 
 (DF0[1,20]<-data3[20,22]/(vessels[20,3]*days_at_sea[20,3])) 
 (DF0[1,21]<-data3[21,22]/(vessels[21,3]*days_at_sea[21,3]))
 (DF0[1,22]<-data3[22,22]/(vessels[22,3]*days_at_sea[22,3]))
 (DF0[1,23]<-data3[23,22]/(vessels[23,3]*days_at_sea[23,3]))
 (DF0[1,24]<-data3[24,22]/(vessels[24,3]*days_at_sea[24,3]))
```

```{r}
  #othervariablecosts_coeff
 (DF0[2,1]<-data3[1,23]/(vessels[1,3]*days_at_sea[1,3]))
 (DF0[2,2]<-data3[2,23]/(vessels[2,3]*days_at_sea[2,3]))
 (DF0[2,3]<-data3[3,23]/(vessels[3,3]*days_at_sea[3,3]))
 (DF0[2,4]<-data3[4,23]/(vessels[4,3]*days_at_sea[4,3]))
 (DF0[2,5]<-data3[5,23]/(vessels[5,3]*days_at_sea[5,3]))
 (DF0[2,6]<-data3[6,23]/(vessels[6,3]*days_at_sea[6,3]))
 (DF0[2,7]<-data3[7,23]/(vessels[7,3]*days_at_sea[7,3]))
 (DF0[2,8]<-data3[8,23]/(vessels[8,3]*days_at_sea[8,3]))
 (DF0[2,9]<-data3[9,23]/(vessels[9,3]*days_at_sea[9,3]))
 (DF0[2,10]<-data3[10,23]/(vessels[10,3]*days_at_sea[10,3]))
 (DF0[2,11]<-data3[11,23]/(vessels[11,3]*days_at_sea[11,3]))
  (DF0[2,12]<-data3[12,23]/(vessels[12,3]*days_at_sea[12,3]))
  (DF0[2,13]<-data3[13,23]/(vessels[13,3]*days_at_sea[13,3]))
  (DF0[2,14]<-data3[14,23]/(vessels[14,3]*days_at_sea[14,3]))
  (DF0[2,15]<-data3[15,23]/(vessels[15,3]*days_at_sea[15,3]))
  (DF0[2,16]<-data3[16,23]/(vessels[16,3]*days_at_sea[16,3]))
  (DF0[2,17]<-data3[17,23]/(vessels[17,3]*days_at_sea[17,3]))
  (DF0[2,18]<-data3[18,23]/(vessels[18,3]*days_at_sea[18,3]))
  (DF0[2,19]<-data3[19,23]/(vessels[19,3]*days_at_sea[19,3]))
  (DF0[2,20]<-data3[20,23]/(vessels[20,3]*days_at_sea[20,3]))
  (DF0[2,21]<-data3[21,23]/(vessels[21,3]*days_at_sea[21,3]))
  (DF0[2,22]<-data3[22,23]/(vessels[22,3]*days_at_sea[22,3]))
  (DF0[2,23]<-data3[23,23]/(vessels[23,3]*days_at_sea[23,3]))
  (DF0[2,24]<-data3[24,23]/(vessels[24,3]*days_at_sea[24,3]))

```


```{r}




  #maintenancecosts_coeff
  (DF0[3,1]<-data3[1,6]/GT[1,3])
  (DF0[3,2]<-data3[2,6]/GT[2,3])
  (DF0[3,3]<-data3[3,6]/GT[3,3])
  (DF0[3,4]<-data3[4,6]/GT[4,3])
  (DF0[3,5]<-data3[5,6]/GT[5,3])
  (DF0[3,6]<-data3[6,6]/GT[6,3])
  (DF0[3,7]<-data3[7,6]/GT[7,3])
  (DF0[3,8]<-data3[8,6]/GT[8,3])
  (DF0[3,9]<-data3[9,6]/GT[9,3])
  (DF0[3,10]<-data3[10,6]/GT[10,3])
  (DF0[3,11]<-data3[11,6]/GT[11,3])
  (DF0[3,12]<-data3[12,6]/GT[12,3])
  (DF0[3,13]<-data3[13,6]/GT[13,3])
  (DF0[3,14]<-data3[14,6]/GT[14,3])
  (DF0[3,15]<-data3[15,6]/GT[15,3])
  (DF0[3,16]<-data3[16,6]/GT[16,3])
  (DF0[3,17]<-data3[17,6]/GT[17,3])
  (DF0[3,18]<-data3[18,6]/GT[18,3])
  (DF0[3,19]<-data3[19,6]/GT[19,3])
  (DF0[3,20]<-data3[20,6]/GT[20,3])
  (DF0[3,21]<-data3[21,6]/GT[21,3])
  (DF0[3,22]<-data3[22,6]/GT[22,3])
  (DF0[3,23]<-data3[23,6]/GT[23,3])
  (DF0[3,24]<-data3[24,6]/GT[24,3])


```

```{r}


  #otherfixed_cost
  (DF0[4,1]<-data3[1,7]/GT[1,3])
  (DF0[4,2]<-data3[2,7]/GT[2,3])
  (DF0[4,3]<-data3[3,7]/GT[3,3])
  (DF0[4,4]<-data3[4,7]/GT[4,3])
  (DF0[4,5]<-data3[5,7]/GT[5,3])
  (DF0[4,6]<-data3[6,7]/GT[6,3])
  (DF0[4,7]<-data3[7,7]/GT[7,3])
  (DF0[4,8]<-data3[8,7]/GT[8,3])
  (DF0[4,9]<-data3[9,7]/GT[9,3])
  (DF0[4,10]<-data3[10,7]/GT[10,3])
  (DF0[4,11]<-data3[11,7]/GT[11,3])
  (DF0[4,12]<-data3[12,7]/GT[12,3])
(DF0[4,13]<-data3[13,7]/GT[13,3])
(DF0[4,14]<-data3[14,7]/GT[14,3])
(DF0[4,15]<-data3[15,7]/GT[15,3])
(DF0[4,16]<-data3[16,7]/GT[16,3])
(DF0[4,17]<-data3[17,7]/GT[17,3])
(DF0[4,18]<-data3[18,7]/GT[18,3])
(DF0[4,19]<-data3[19,7]/GT[19,3])
(DF0[4,20]<-data3[20,7]/GT[20,3])
(DF0[4,21]<-data3[21,7]/GT[21,3])
(DF0[4,22]<-data3[22,7]/GT[22,3])
(DF0[4,23]<-data3[23,7]/GT[23,3])
(DF0[4,24]<-data3[24,7]/GT[24,3])
```

```{r}
  
  #depreciationcosts_coeff
  (DF0[5,1]<-data3[1,3]/GT[1,3])
  (DF0[5,2]<-data3[2,3]/GT[2,3])
  (DF0[5,3]<-data3[3,3]/GT[3,3])
  (DF0[5,4]<-data3[4,3]/GT[4,3])
  (DF0[5,5]<-data3[5,3]/GT[5,3])
  (DF0[5,6]<-data3[6,3]/GT[6,3])
  (DF0[5,7]<-data3[7,3]/GT[7,3])
  (DF0[5,8]<-data3[8,3]/GT[8,3])
  (DF0[5,9]<-data3[9,3]/GT[9,3])
  (DF0[5,10]<-data3[10,3]/GT[10,3])
  (DF0[5,11]<-data3[11,3]/GT[11,3])
(DF0[5,12]<-data3[12,3]/GT[12,3])
(DF0[5,13]<-data3[13,3]/GT[13,3])
(DF0[5,14]<-data3[14,3]/GT[14,3])
(DF0[5,15]<-data3[15,3]/GT[15,3])
(DF0[5,16]<-data3[16,3]/GT[16,3])
(DF0[5,17]<-data3[17,3]/GT[17,3])
(DF0[5,18]<-data3[18,3]/GT[18,3])
(DF0[5,19]<-data3[19,3]/GT[19,3])
(DF0[5,20]<-data3[20,3]/GT[20,3])
(DF0[5,21]<-data3[21,3]/GT[21,3])
(DF0[5,22]<-data3[22,3]/GT[22,3])
(DF0[5,23]<-data3[23,3]/GT[23,3])
(DF0[5,24]<-data3[24,3]/GT[24,3])


```

```{r}
  #opportunitycosts_coeff
  (DF0[6,1]<-data3[1,2]/GT[1,3])
  (DF0[6,2]<-data3[2,2]/GT[2,3])
  (DF0[6,3]<-data3[3,2]/GT[3,3])
  (DF0[6,4]<-data3[4,2]/GT[4,3])
  (DF0[6,5]<-data3[5,2]/GT[5,3])
  (DF0[6,6]<-data3[6,2]/GT[6,3])
  (DF0[6,7]<-data3[7,2]/GT[7,3])
  (DF0[6,8]<-data3[8,2]/GT[8,3])
  (DF0[6,9]<-data3[9,2]/GT[9,3])
  (DF0[6,10]<-data3[10,2]/GT[10,3])
  (DF0[6,11]<-data3[11,2]/GT[11,3])
  (DF0[6,12]<-data3[12,2]/GT[12,3])
(DF0[6,13]<-data3[13,2]/GT[13,3])
(DF0[6,14]<-data3[14,2]/GT[14,3])
(DF0[6,15]<-data3[15,2]/GT[15,3])
(DF0[6,16]<-data3[16,2]/GT[16,3])
(DF0[6,17]<-data3[17,2]/GT[17,3])
(DF0[6,18]<-data3[18,2]/GT[18,3])
(DF0[6,19]<-data3[19,2]/GT[19,3])
(DF0[6,20]<-data3[20,2]/GT[20,3])
(DF0[6,21]<-data3[21,2]/GT[21,3])
(DF0[6,22]<-data3[22,2]/GT[22,3])
(DF0[6,23]<-data3[23,2]/GT[23,3])
(DF0[6,24]<-data3[24,2]/GT[24,3])

```

```{r}

  #correc_factor_for_land = tot_landing /  sum( tot_landing_S1 + tot_landing_S2 + tot_landing_S3 ...)
  (DF0[7,1]<-data3[1,25]/sum(data3[1,10],data3[1,11],data3[1,12],data3[1,13],data3[1,14]))
  (DF0[7,2]<-data3[2,25]/sum(data3[2,10],data3[2,11],data3[2,12],data3[2,13],data3[2,14]))
  (DF0[7,3]<-data3[3,25]/sum(data3[3,10],data3[3,11],data3[3,12],data3[3,13],data3[3,14]))
  (DF0[7,4]<-data3[4,25]/sum(data3[4,10],data3[4,11],data3[4,12],data3[4,13],data3[4,14]))
  (DF0[7,5]<-data3[5,25]/sum(data3[5,10],data3[5,11],data3[5,12],data3[5,13],data3[5,14]))
  (DF0[7,6]<-data3[6,25]/sum(data3[6,10],data3[6,11],data3[6,12],data3[6,13],data3[6,14]))
  (DF0[7,7]<-data3[7,25]/sum(data3[7,10],data3[7,11],data3[7,12],data3[7,13],data3[7,14]))
  (DF0[7,8]<-data3[8,25]/sum(data3[8,10],data3[8,11],data3[8,12],data3[8,13],data3[8,14]))
  (DF0[7,9]<-data3[9,25]/sum(data3[9,10],data3[9,11],data3[9,12],data3[9,13],data3[9,14]))
  (DF0[7,10]<-data3[10,25]/sum(data3[10,10],data3[10,11],data3[10,12],data3[10,13],data3[10,14]))
  (DF0[7,11]<-data3[11,25]/sum(data3[11,10],data3[11,11],data3[11,12],data3[11,13],data3[11,14]))
  (DF0[7,12]<-data3[12,25]/sum(data3[12,10],data3[12,11],data3[12,12],data3[12,13],data3[12,14]))
  (DF0[7,13]<-data3[13,25]/sum(data3[13,10],data3[13,11],data3[13,12],data3[13,13],data3[13,14]))
  (DF0[7,14]<-data3[14,25]/sum(data3[14,10],data3[14,11],data3[14,12],data3[14,13],data3[14,14]))
  (DF0[7,15]<-data3[15,25]/sum(data3[15,10],data3[15,11],data3[15,12],data3[15,13],data3[15,14]))
  (DF0[7,16]<-data3[16,25]/sum(data3[16,10],data3[16,11],data3[16,12],data3[16,13],data3[16,14]))
  (DF0[7,17]<-data3[17,25]/sum(data3[17,10],data3[17,11],data3[17,12],data3[17,13],data3[17,14]))
  (DF0[7,18]<-data3[18,25]/sum(data3[18,10],data3[18,11],data3[18,12],data3[18,13],data3[18,14]))
  (DF0[7,19]<-data3[19,25]/sum(data3[19,10],data3[19,11],data3[19,12],data3[19,13],data3[19,14]))
  (DF0[7,20]<-data3[20,25]/sum(data3[20,10],data3[20,11],data3[20,12],data3[20,13],data3[20,14]))
  (DF0[7,21]<-data3[21,25]/sum(data3[21,10],data3[21,11],data3[21,12],data3[21,13],data3[21,14]))
  (DF0[7,22]<-data3[22,25]/sum(data3[22,10],data3[22,11],data3[22,12],data3[22,13],data3[22,14]))
  (DF0[7,23]<-data3[23,25]/sum(data3[23,10],data3[23,11],data3[23,12],data3[23,13],data3[23,14]))
  (DF0[7,24]<-data3[24,25]/sum(data3[24,10],data3[24,11],data3[24,12],data3[24,13],data3[24,14]))
```

```{r}
  #correc_factor_for_rev = tot_revenues_landing / sum(revenues_S1 + revenues_S2 + revenues_S3 ...)

  (DF0[8,1]<-data3[1,20]/sum(data3[1,15],data3[1,16],data3[1,17],data3[1,18],data3[1,19]))
  (DF0[8,2]<-data3[2,20]/sum(data3[2,15],data3[2,16],data3[2,17],data3[2,18],data3[2,19]))
  (DF0[8,3]<-data3[3,20]/sum(data3[3,15],data3[3,16],data3[3,17],data3[3,18],data3[3,19]))
  (DF0[8,4]<-data3[4,20]/sum(data3[4,15],data3[4,16],data3[4,17],data3[4,18],data3[4,19]))
  (DF0[8,5]<-data3[5,20]/sum(data3[5,15],data3[5,16],data3[5,17],data3[5,18],data3[5,19]))
  (DF0[8,6]<-data3[6,20]/sum(data3[6,15],data3[6,16],data3[6,17],data3[6,18],data3[6,19]))
  (DF0[8,7]<-data3[7,20]/sum(data3[7,15],data3[7,16],data3[7,17],data3[7,18],data3[7,19]))
  (DF0[8,8]<-data3[8,20]/sum(data3[8,15],data3[8,16],data3[8,17],data3[8,18],data3[8,19]))
  (DF0[8,9]<-data3[9,20]/sum(data3[9,15],data3[9,16],data3[9,17],data3[9,18],data3[9,19]))
  (DF0[8,10]<-data3[10,20]/sum(data3[10,15],data3[10,16],data3[10,17],data3[10,18],data3[10,19]))
  (DF0[8,11]<-data3[11,20]/sum(data3[11,15],data3[11,16],data3[11,17],data3[11,18],data3[11,19]))
  (DF0[8,12]<-data3[12,20]/sum(data3[12,15],data3[12,16],data3[12,17],data3[12,18],data3[12,19]))
  (DF0[8,13]<-data3[13,20]/sum(data3[13,15],data3[13,16],data3[13,17],data3[13,18],data3[13,19]))
  (DF0[8,14]<-data3[14,20]/sum(data3[14,15],data3[14,16],data3[14,17],data3[14,18],data3[14,19]))
  (DF0[8,15]<-data3[15,20]/sum(data3[15,15],data3[15,16],data3[15,17],data3[15,18],data3[15,19]))
  (DF0[8,16]<-data3[16,20]/sum(data3[16,15],data3[16,16],data3[16,17],data3[16,18],data3[16,19]))
  (DF0[8,17]<-data3[17,20]/sum(data3[17,15],data3[17,16],data3[17,17],data3[17,18],data3[17,19]))
  (DF0[8,18]<-data3[18,20]/sum(data3[18,15],data3[18,16],data3[18,17],data3[18,18],data3[18,19]))
  (DF0[8,19]<-data3[19,20]/sum(data3[19,15],data3[19,16],data3[19,17],data3[19,18],data3[19,19]))
  (DF0[8,20]<-data3[20,20]/sum(data3[20,15],data3[20,16],data3[20,17],data3[20,18],data3[20,19]))
  (DF0[8,21]<-data3[21,20]/sum(data3[21,15],data3[21,16],data3[21,17],data3[21,18],data3[21,19]))
  (DF0[8,22]<-data3[22,20]/sum(data3[22,15],data3[22,16],data3[22,17],data3[22,18],data3[22,19]))
  (DF0[8,23]<-data3[23,20]/sum(data3[23,15],data3[23,16],data3[23,17],data3[23,18],data3[23,19]))
  (DF0[8,24]<-data3[24,20]/sum(data3[24,15],data3[24,16],data3[24,17],data3[24,18],data3[24,19]))

```

```{r}
  #value_of_single_vessel = capital_value / N_vessels
  (DF0[9,1]<-data3[1,4]/vessels[1,3])
  (DF0[9,2]<-data3[2,4]/vessels[2,3])
  (DF0[9,3]<-data3[3,4]/vessels[3,3])
  (DF0[9,4]<-data3[4,4]/vessels[4,3])
  (DF0[9,5]<-data3[5,4]/vessels[5,3])
  (DF0[9,6]<-data3[6,4]/vessels[6,3])
  (DF0[9,7]<-data3[7,4]/vessels[7,3])
  (DF0[9,8]<-data3[8,4]/vessels[8,3])
  (DF0[9,9]<-data3[9,4]/vessels[9,3])
  (DF0[9,10]<-data3[10,4]/vessels[10,3])
  (DF0[9,11]<-data3[11,4]/vessels[11,3])
  (DF0[9,12]<-data3[12,4]/vessels[12,3])
  (DF0[9,13]<-data3[13,4]/vessels[13,3])
  (DF0[9,14]<-data3[14,4]/vessels[14,3])
  (DF0[9,15]<-data3[15,4]/vessels[15,3])
  (DF0[9,16]<-data3[16,4]/vessels[16,3])
  (DF0[9,17]<-data3[17,4]/vessels[17,3])
  (DF0[9,18]<-data3[18,4]/vessels[18,3])
  (DF0[9,19]<-data3[19,4]/vessels[19,3])
  (DF0[9,20]<-data3[20,4]/vessels[20,3])
  (DF0[9,21]<-data3[21,4]/vessels[21,3])
  (DF0[9,22]<-data3[22,4]/vessels[22,3])
  (DF0[9,23]<-data3[23,4]/vessels[23,3])
  (DF0[9,24]<-data3[24,4]/vessels[24,3])

```

```{r}
  #average_employees_per_vessel = employment / N_vessels
  (DF0[10,1]<-data3[1,26]/vessels[1,3])
  (DF0[10,2]<-data3[2,26]/vessels[2,3])
  (DF0[10,3]<-data3[3,26]/vessels[3,3])
  (DF0[10,4]<-data3[4,26]/vessels[4,3])
  (DF0[10,5]<-data3[5,26]/vessels[5,3])
  (DF0[10,6]<-data3[6,26]/vessels[6,3])
  (DF0[10,7]<-data3[7,26]/vessels[7,3])
  (DF0[10,8]<-data3[8,26]/vessels[8,3])
  (DF0[10,9]<-data3[9,26]/vessels[9,3])
  (DF0[10,10]<-data3[10,26]/vessels[10,3])
  (DF0[10,11]<-data3[11,26]/vessels[11,3])
  (DF0[10,12]<-data3[12,26]/vessels[12,3])
  (DF0[10,13]<-data3[13,26]/vessels[13,3])
  (DF0[10,14]<-data3[14,26]/vessels[14,3])
  (DF0[10,15]<-data3[15,26]/vessels[15,3])
  (DF0[10,16]<-data3[16,26]/vessels[16,3])
  (DF0[10,17]<-data3[17,26]/vessels[17,3])
  (DF0[10,18]<-data3[18,26]/vessels[18,3])
  (DF0[10,19]<-data3[19,26]/vessels[19,3])
  (DF0[10,20]<-data3[20,26]/vessels[20,3])
  (DF0[10,21]<-data3[21,26]/vessels[21,3])
  (DF0[10,22]<-data3[22,26]/vessels[22,3])
  (DF0[10,23]<-data3[23,26]/vessels[23,3])
  (DF0[10,24]<-data3[24,26]/vessels[24,3])

```
```{r}

  #crew_share = labour_cost / (tot_revenues_landing - tot_var_cost)

  (DF0[11,1]<-data3[1,9]/(data3[1,20]-data3[1,24]))
  (DF0[11,2]<-data3[2,9]/(data3[2,20]-data3[2,24]))
  (DF0[11,3]<-data3[3,9]/(data3[3,20]-data3[3,24]))
  (DF0[11,4]<-data3[4,9]/(data3[4,20]-data3[4,24]))
  (DF0[11,5]<-data3[5,9]/(data3[5,20]-data3[5,24]))
  (DF0[11,6]<-data3[6,9]/(data3[6,20]-data3[6,24]))
  (DF0[11,7]<-data3[7,9]/(data3[7,20]-data3[7,24]))
  (DF0[11,8]<-data3[8,9]/(data3[8,20]-data3[8,24]))
  (DF0[11,9]<-data3[9,9]/(data3[9,20]-data3[9,24]))
  (DF0[11,10]<-data3[10,9]/(data3[10,20]-data3[10,24]))
  (DF0[11,11]<-data3[11,9]/(data3[11,20]-data3[11,24]))
  (DF0[11,12]<-data3[12,9]/(data3[12,20]-data3[12,24]))
  (DF0[11,13]<-data3[13,9]/(data3[13,20]-data3[13,24]))
  (DF0[11,14]<-data3[14,9]/(data3[14,20]-data3[14,24]))
  (DF0[11,15]<-data3[15,9]/(data3[15,20]-data3[15,24]))
  (DF0[11,16]<-data3[16,9]/(data3[16,20]-data3[16,24]))
  (DF0[11,17]<-data3[17,9]/(data3[17,20]-data3[17,24]))
  (DF0[11,18]<-data3[18,9]/(data3[18,20]-data3[18,24]))
  (DF0[11,19]<-data3[19,9]/(data3[19,20]-data3[19,24]))
  (DF0[11,20]<-data3[20,9]/(data3[20,20]-data3[20,24]))
  (DF0[11,21]<-data3[21,9]/(data3[21,20]-data3[21,24]))
  (DF0[11,22]<-data3[22,9]/(data3[22,20]-data3[22,24]))
  (DF0[11,23]<-data3[23,9]/(data3[23,20]-data3[23,24]))
  (DF0[11,24]<-data3[24,9]/(data3[24,20]-data3[24,24]))

  write.csv2(DF0,"C:/OUTPUT/economic_values.csv")
  
```

\textbf{SCENARIO-2} 

same as above

\textbf{bmt-config-Simulation.csv}

(unique file manually)
             






